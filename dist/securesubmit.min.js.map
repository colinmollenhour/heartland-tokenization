{"version":3,"file":null,"sources":["../src/Ajax.ts","../src/vars/cardTypes.ts","../src/Formatter/CardNumber.ts","../src/Formatter/Expiration.ts","../src/Validator/CardNumber.ts","../src/Validator/Cvv.ts","../src/Validator/Expiration.ts","../src/DOM.ts","../src/formatter/Expiration.ts","../src/Events.ts","../src/Card.ts","../src/Formatter/index.ts","../src/Styles.ts","../src/vars/defaults.ts","../src/vars/fields.ts","../src/vars/urls.ts","../src/Messages.ts","../src/Frames.ts","../src/Util.ts","../src/TokenService/HeartlandTokenService.ts","../src/HPS.ts","../src/Validator/index.ts","../src/index.ts"],"sourcesContent":["import {TokenizationResponse} from \"./types/TokenizationResponse\";\n\nexport interface Request {\n    type: string;\n    url?: string;\n    payload?: string;\n}\n\nexport class CorsRequest implements Request {\n    public type = \"cors\";\n    constructor(public url = \"\", public payload = \"\") {}\n}\n\nexport class JsonpRequest implements Request {\n    public type = \"jsonp\";\n    constructor(public url = \"\", public payload = \"\") {}\n}\n\n/**\n * @namespace Heartland.Ajax\n */\nexport class Ajax {\n  /**\n   * Heartland.Ajax.jsonp\n   *\n   * Creates a new DOM node containing a created JSONP callback handler for an\n   * impending Ajax JSONP request. Removes need for `XMLHttpRequest`.\n   *\n   * @param {string} url\n   * @param {function} callback\n   */\n  public static jsonp(request: JsonpRequest, callback: (data: TokenizationResponse) => void) {\n    const script = document.createElement('script');\n    const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());\n    (<any>window)[callbackName] = function (data: TokenizationResponse): void {\n      (<any>window)[callbackName] = undefined;\n      document.body.removeChild(script);\n      callback(data);\n    };\n\n    script.src = request.url + (request.url.indexOf('?') >= 0 ? '&' : '?') + 'callback=' + callbackName\n        + '&' + request.payload;\n    document.body.appendChild(script);\n  }\n\n  /**\n   * Heartland.Ajax.cors\n   *\n   * Creates a new `XMLHttpRequest` object for a POST request to the given `url`.\n   *\n   * @param {string} url\n   * @param {function} callback\n   */\n  public static cors(request: CorsRequest, callback: (data: TokenizationResponse) => void) {\n    let xhr: any;\n    let method = 'POST';\n    let timeout: number;\n\n    if ((new XMLHttpRequest()).withCredentials === undefined) {\n      xhr = new (<any>window).XDomainRequest();\n      method = 'GET';\n      request.url = request.url.split('?')[0];\n      request.url = request.url + '?' + request.payload;\n      xhr.open(method, request.url);\n    } else {\n      xhr = new XMLHttpRequest();\n      xhr.open(method, request.url);\n      xhr.setRequestHeader(\n        'Content-Type',\n        'application/x-www-form-urlencoded'\n      );\n    }\n    const cb = function (e: Event) {\n      clearTimeout(timeout);\n\n      if (e.type === 'error') {\n        callback({error: {message: 'communication error'}});\n        return;\n      }\n\n      if (xhr.readyState === 4 || (xhr.readyState !== 4 && xhr.responseText !== '')) {\n        const data = JSON.parse(xhr.responseText);\n        callback(data);\n      } else {\n        callback({error: {message: 'no data'}});\n      }\n    };\n\n    xhr.onload = cb;\n    xhr.onerror = cb;\n    xhr.send(request.payload);\n    timeout = setTimeout(function () {\n      xhr.abort();\n      callback({error: {message: 'timeout'}});\n    }, 5000);\n  }\n}\n","import {CardType} from \"../types/CardType\";\n\nexport const cardTypes: CardType[] = [\n  {\n    code: 'visa',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^4/\n  },\n  {\n    code: 'mastercard',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^(5[1-5]|2[2-7])/\n  },\n  {\n    code: 'amex',\n    format: /(\\d{1,4})(\\d{1,6})?(\\d{1,5})?/,\n    length: 15,\n    regex: /^3[47]/\n  },\n  {\n    code: 'diners',\n    format: /(\\d{1,4})(\\d{1,6})?(\\d{1,4})?/,\n    length: 14,\n    regex: /^3[0689]/\n  },\n  {\n    code: 'discover',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^6([045]|22)/\n  },\n  {\n    code: 'jcb',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^35/\n  }\n];\n","import {Formatter} from \"../types/Formatter\";\nimport {Card} from \"../Card\";\n\nexport class CardNumber implements Formatter {\n  format(number: string): string {\n    number = number.replace(/\\D/g, '');\n    const type = Card.typeByNumber(number);\n\n    if (!type) { return number; }\n\n    const matches = number.match(type.format);\n\n    if (!matches) { return number; }\n\n    if (!type.format.global) {\n      matches.shift();\n    }\n    return matches.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n}\n","import {Formatter} from \"../types/Formatter\";\n\nexport class Expiration implements Formatter {\n  format(exp: string, final = false): string {\n    const pat = /^\\D*(\\d{1,2})(\\D+)?(\\d{1,4})?/;\n    const groups = exp.match(pat);\n    let month: string;\n    let del: string;\n    let year: string;\n\n    if (!groups) {\n      return '';\n    }\n\n    month = groups[1] || '';\n    del = groups[2] || '';\n    year = groups[3] || '';\n\n    if (year.length > 0) {\n      del = ' / ';\n    } else if (month.length === 2 || del.length > 0) {\n      del = ' / ';\n    } else if (month.length === 1 && (month !== '0' && month !== '1')) {\n      del = ' / ';\n    }\n\n    if (month.length === 1 && del !== '') {\n      month = '0' + month;\n    }\n\n    if (final && year.length === 2) {\n      year = (new Date).getFullYear().toString().slice(0, 2) + year;\n    }\n\n    return month + del + year;\n  }\n}\n","import {Validator} from \"../types/Validator\";\nimport {Card} from \"../Card\";\n\nexport class CardNumber implements Validator {\n  validate(number: string): boolean {\n    if (!number) {\n      return false;\n    }\n\n    number = number.replace(/[-\\s]/g, '');\n    const type = Card.typeByNumber(number);\n\n    if (!type) {\n      return false;\n    }\n    return Card.luhnCheck(number)\n      && number.length === type.length;\n  }\n}\n","import {Validator} from \"../types/Validator\";\n\nexport class Cvv implements Validator {\n  validate(cvv: string): boolean {\n    if (!cvv) {\n      return false;\n    }\n\n    cvv = cvv.replace(/^\\s+|\\s+$/g, '');\n\n    if (!/^\\d+$/.test(cvv)) {\n      return false;\n    }\n    return 3 <= cvv.length && cvv.length <= 4;\n  }\n}\n","import {Validator} from \"../types/Validator\";\n\nexport class Expiration implements Validator {\n  validate(exp: string): boolean {\n    let m: string, y: string;\n\n    if (!exp) {\n      return false;\n    }\n\n    const split = exp.split('/');\n    [m, y] = split;\n\n    if (!m || !y) {\n      return false;\n    }\n\n    m = m.replace(/^\\s+|\\s+$/g, '');\n    y = y.replace(/^\\s+|\\s+$/g, '');\n\n    if (!/^\\d+$/.test(m)) {\n      return false;\n    }\n    if (!/^\\d+$/.test(y)) {\n      return false;\n    }\n\n    if (y.length === 2) {\n      y = (new Date).getFullYear().toString().slice(0, 2) + y;\n    }\n\n    const month = parseInt(m, 10);\n    const year = parseInt(y, 10);\n\n    if (!(1 <= month && month <= 12)) {\n      return false;\n    }\n\n    // creates date as 1 day past end of\n    // expiration month since JS months\n    // are 0 indexed\n    return (new Date(year, month, 1)) > (new Date);\n  }\n}\n","import {HPS} from \"./HPS\";\n\n/**\n * @namespace Heartland.DOM\n */\nexport class DOM {\n  /**\n   * Heartland.DOM.configureField\n   *\n   * Configures an input field in a single field iFrame.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static configureField(hps: HPS) {\n    document.getElementById('heartland-field').setAttribute('name', hps.field);\n  }\n\n  /**\n   * Heartland.DOM.makeFrame\n   *\n   * Creates a single iFrame element with the appropriate defaults.\n   *\n   * @param {string} name\n   * @returns {HTMLIframeElement}\n   */\n  public static makeFrame(name: string) {\n    const frame = document.createElement('iframe');\n    frame.id = 'heartland-frame-' + name;\n    frame.name = name;\n    frame.style.border = '0';\n    frame.frameBorder = '0';\n    frame.scrolling = 'no';\n    return frame;\n  }\n\n  /**\n   * Heartland.DOM.addField\n   *\n   * Adds a DOM `input` node to `formParent` with type `fieldType`, name\n   * `fieldName`, and value `fieldValue`.\n   *\n   * @param {string} formParent\n   * @param {string} fieldType\n   * @param {string} fieldName\n   * @param {string} fieldValue\n   */\n  public static addField(formParent: string, fieldType: string, fieldName: string, fieldValue: string) {\n    const input = document.createElement('input');\n\n    input.setAttribute('type', fieldType);\n    input.setAttribute('name', fieldName);\n    input.setAttribute('value', fieldValue);\n\n    document.getElementById(formParent).appendChild(input);\n  }\n\n  /**\n   * Heartland.DOM.setStyle\n   *\n   * Sets an element's style attribute within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {string} htmlstyle\n   */\n  public static setStyle(elementid: string, htmlstyle: string) {\n    const el = document.getElementById(elementid);\n    if (el) {\n      el.setAttribute('style', DOM.encodeEntities(htmlstyle));\n    }\n  }\n\n  /**\n   * Heartland.DOM.appendStyle\n   *\n   * Appends an element's style attribute within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {String} htmlstyle\n   */\n  public static appendStyle(elementid: string, htmlstyle: string) {\n    const el = document.getElementById(elementid);\n    if (el) {\n      const currstyle = el.getAttribute('style');\n      const newstyle = (currstyle ? currstyle : '') + htmlstyle;\n      el.setAttribute('style', DOM.encodeEntities(newstyle));\n    }\n  }\n\n  /**\n   * Heartland.DOM.setText\n   *\n   * Sets an element's inner text within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {string} text\n   */\n  public static setText(elementid: string, text: string) {\n    const el = document.getElementById(elementid);\n    if (el) {\n      el.textContent = DOM.encodeEntities(text);\n    }\n  }\n\n  /**\n   * Heartland.DOM.setPlaceholder\n   *\n   * Sets an element's placeholder attribute within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {string} text\n   */\n  public static setPlaceholder(elementid: string, text: string) {\n    const el = document.getElementById(elementid);\n    if (el) {\n      if (text === '•••• •••• •••• ••••' || text === '••••' || text === '•••'\n        || text === '···· ···· ···· ····') {\n        el.setAttribute('placeholder', text);\n      } else {\n        el.setAttribute('placeholder', DOM.encodeEntities(text));\n      }\n    }\n  }\n\n  /**\n   * Heartland.DOM.resizeFrame\n   *\n   * Alerts a parent window to resize the iframe.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static resizeFrame(hps: HPS) {\n    const docHeight = document.body.offsetHeight + 1; // off by one error\n    hps.Messages.post({ action: 'resize', height: docHeight }, 'parent');\n  }\n\n  /**\n   * Heartland.DOM.setFieldData\n   *\n   * Receives a field value from another frame prior to the tokenization process.\n   *\n   * @param {string} elementid\n   * @param {string} value\n   */\n  public static setFieldData(elementid: string, value: string) {\n    let el = document.getElementById(elementid);\n    if (!el && document.getElementById('heartland-field')) {\n      el = document.createElement('input');\n      el.setAttribute('id', DOM.encodeEntities(elementid));\n      el.setAttribute('type', 'hidden');\n      document.getElementById('heartland-field-wrapper').appendChild(el);\n    }\n\n    if (el) {\n      el.setAttribute('value', DOM.encodeEntities(value));\n    }\n  }\n\n  /**\n   * Heartland.DOM.getFieldData\n   *\n   * Retrieves a field value for another frame prior to the tokenization process.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} elementid\n   */\n  public static getFieldData(hps: HPS, elementid: string) {\n    const el: HTMLInputElement = <HTMLInputElement>document.getElementById(elementid);\n    if (el) {\n      hps.Messages.post({ action: 'passData', value: el.value }, 'parent');\n    }\n  }\n\n  /**\n   * Heartland.DOM.addStylesheet\n   *\n   * Creates a `style` node in the DOM with the given `css`.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} elementid\n   */\n  public static addStylesheet(css: string) {\n    const el = document.createElement('style');\n    const elements = document.getElementsByTagName('head');\n    el.type = 'text/css';\n    el.appendChild(document.createTextNode(css));\n    if (elements && elements[0]) {\n      elements[0].appendChild(el);\n    }\n  }\n\n  /**\n   * Heartland.DOM.json2css\n   *\n   * Converts a JSON node to text representing CSS.\n   *\n   * @param {string} json\n   * @returns {string}\n   */\n  public static json2css(json: Object): string {\n    let css = '';\n    let attributes: string[];\n    let children: Object[];\n    let i: number, j: number;\n    let key: any, value: any;\n\n    if (attributes = DOM.jsonAttributes(json)) {\n      const attributesLength = attributes.length;\n      for (i = 0; i < attributesLength; i++) {\n        key = attributes[i];\n        value = (<any>json)[key];\n        if (DOM.isArray(value)) {\n          const arrLength = value.length;\n          for (j = 0; j < arrLength; j++) {\n            css += key + ':' + value[j] + ';';\n          }\n        } else {\n          css += key + ':' + value + ';';\n        }\n      }\n    }\n\n    if (children = DOM.jsonChildren(json)) {\n      const childrenLength = children.length;\n      for (i = 0; i < childrenLength; i++) {\n        key = children[i];\n        value = (<any>json)[key];\n        css += key + '{' + DOM.json2css(value) + '}';\n      }\n    }\n\n    return css;\n  }\n\n  /**\n   * Heartland.DOM.setFocus\n   *\n   * Sets the focus on an iframe's field.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} elementid\n   */\n  public static setFocus() {\n    const el = document.getElementById('heartland-field');\n    if (el) {\n      el.focus();\n    }\n  }\n\n  /***********\n   * Helpers *\n   ***********/\n\n  /**\n   * Escapes all potentially dangerous characters, so that the\n   * resulting string can be safely inserted into attribute or\n   * element text.\n   *\n   * @param value\n   * @returns {string} escaped text\n   */\n  private static encodeEntities(value: string) {\n    return value.\n      replace(/&/g, '&amp;').\n      replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, function (v) {\n        const hi = v.charCodeAt(0);\n        const low = v.charCodeAt(1);\n        return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\n      }).\n      replace(/([^\\#-~| |!])/g, function (v) {\n        return '&#' + v.charCodeAt(0) + ';';\n      }).\n      replace(/</g, '&lt;').\n      replace(/>/g, '&gt;');\n  }\n\n  private static isArray(obj: any): boolean {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n  }\n\n  private static jsonAttributes(json: Object): string[] {\n    const set: string[] = [];\n    for (const i in json) {\n      if (json.hasOwnProperty(i)\n        && (typeof (<any>json)[i] === 'string' || DOM.isArray((<any>json)[i]))) {\n        set.push(i);\n      }\n    }\n    return set;\n  }\n\n  private static jsonChildren(json: Object): Object[] {\n    const set: Object[] = [];\n    for (const i in json) {\n      if (json.hasOwnProperty(i)\n        && (Object.prototype.toString.call((<any>json)[i]) === '[object Object]')) {\n        set.push(i);\n      }\n    }\n    return set;\n  }\n}\n","import {Formatter} from \"../types/Formatter\";\n\nexport class Expiration implements Formatter {\n  format(exp: string, final = false): string {\n    const pat = /^\\D*(\\d{1,2})(\\D+)?(\\d{1,4})?/;\n    const groups = exp.match(pat);\n    let month: string;\n    let del: string;\n    let year: string;\n\n    if (!groups) {\n      return '';\n    }\n\n    month = groups[1] || '';\n    del = groups[2] || '';\n    year = groups[3] || '';\n\n    if (year.length > 0) {\n      del = ' / ';\n    } else if (month.length === 2 || del.length > 0) {\n      del = ' / ';\n    } else if (month.length === 1 && (month !== '0' && month !== '1')) {\n      del = ' / ';\n    }\n\n    if (month.length === 1 && del !== '') {\n      month = '0' + month;\n    }\n\n    if (final && year.length === 2) {\n      year = (new Date).getFullYear().toString().slice(0, 2) + year;\n    }\n\n    return month + del + year;\n  }\n}\n","import {DOM} from \"./DOM\";\nimport {HPS} from \"./HPS\";\nimport {CardData} from \"./types/CardData\";\nimport {TokenizationResponse} from \"./types/TokenizationResponse\";\nimport {Expiration as ExpirationFormatter} from \"./formatter/Expiration\";\n\nclass Ev {\n  public static listen(node: EventTarget, eventName: string, callback: EventListener) {\n    if (document.addEventListener) {\n      node.addEventListener(eventName, callback, false);\n    } else {\n      if (node === document) {\n        (<any>document.documentElement).attachEvent('onpropertychange', function (e: Event) {\n          if ((<any>e).propertyName === eventName) {\n            callback(e);\n          }\n        });\n      } else {\n        (<any>node).attachEvent('on' + eventName, callback);\n      }\n    }\n  }\n  public static trigger(node: EventTarget, eventName: string) {\n    if (document.createEvent) {\n      const event = document.createEvent('Event');\n      event.initEvent(eventName, true, true);\n      node.dispatchEvent(event);\n    } else {\n      (<any>document.documentElement)[eventName]++;\n    }\n  }\n  public static ignore(eventName: string, callback: EventListener) {\n    if (document.removeEventListener) {\n      document.removeEventListener(eventName, callback, false);\n    } else {\n      (<any>document.documentElement).detachEvent('onpropertychange', function (e: Event) {\n        if ((<any>e).propertyName === eventName) {\n          callback(e);\n        }\n      });\n    }\n  }\n}\n\n/**\n * @namespace Heartland.Events\n */\nexport class Events {\n  /**\n   * Heartland.Events.addHandler\n   *\n   * Adds an `event` handler for a given `target` element.\n   *\n   * @param {string | EventTarget} target\n   * @param {string} event\n   * @param {EventListener} callback\n   */\n  public static addHandler(target: string | EventTarget, event: string, callback: EventListener) {\n    let node: EventTarget;\n    if (typeof target === 'string') {\n      node = document.getElementById(<string>target);\n    } else {\n      node = target;\n    }\n\n    if (document.addEventListener) {\n      node.addEventListener(event, callback, false);\n    } else {\n      Ev.listen(node, event, callback);\n    }\n  }\n\n  /**\n   * Heartland.Events.removeHandler\n   *\n   * Removes an `event` handler for a given `target` element.\n   *\n   * @param {string | EventTarget} target\n   * @param {string} event\n   * @param {EventListener} callback\n   */\n  public static removeHandler(target: string | EventTarget, event: string, callback: EventListener) {\n    let node: EventTarget;\n    if (typeof target === 'string') {\n      node = document.getElementById(<string>target);\n    } else {\n      node = target;\n    }\n\n    if (document.removeEventListener) {\n      node.removeEventListener(event, callback, false);\n    } else {\n      Ev.ignore(event, callback);\n    }\n  }\n\n  /**\n   * Heartland.Events.trigger\n   *\n   * Fires off an `event` for a given `target` element.\n   *\n   * @param {string} name\n   * @param {any} target\n   * @param {any} data [optional]\n   */\n  public static trigger(name: string, target: any, data?: any, bubble = false) {\n    if (document.createEvent) {\n      const event = document.createEvent('Event');\n      event.initEvent(name, true, true);\n      target.dispatchEvent(event);\n    } else {\n      Ev.trigger(target, name);\n    }\n  }\n\n  /**\n   * Heartland.Events.frameHandleWith\n   *\n   * Wraps `hps` state in a closure to provide a `Heartland.Messages.receive`\n   * callback handler for iFrame children.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static frameHandleWith(hps: HPS): (m: any) => void {\n    return function (data) {\n      switch (data.action) {\n        case 'tokenize':\n          if (data.accumulateData) {\n            hps.Messages.post(\n              {\n                action: 'accumulateData'\n              },\n              'parent'\n            );\n            const el = document.createElement('input');\n            el.id = 'publicKey';\n            el.type = 'hidden';\n            el.value = data.message;\n            document\n              .getElementById('heartland-field-wrapper')\n              .appendChild(el);\n          } else {\n            Events.tokenizeIframe(hps, data.message);\n          }\n          break;\n        case 'setStyle':\n          DOM.setStyle(data.id, data.style);\n          DOM.resizeFrame(hps);\n          break;\n        case 'appendStyle':\n          DOM.appendStyle(data.id, data.style);\n          DOM.resizeFrame(hps);\n          break;\n        case 'setText':\n          DOM.setText(data.id, data.text);\n          DOM.resizeFrame(hps);\n          break;\n        case 'setPlaceholder':\n          DOM.setPlaceholder(data.id, data.text);\n          break;\n        case 'setFieldData':\n          DOM.setFieldData(data.id, data.value);\n          if (document.getElementById('heartland-field') &&\n            document.getElementById('cardCvv') &&\n            document.getElementById('cardExpiration')) {\n            const pkey = document.getElementById('publicKey');\n            Events.tokenizeIframe(hps, (pkey ? pkey.getAttribute('value') : ''));\n          }\n          break;\n        case 'getFieldData':\n          DOM.getFieldData(hps, data.id);\n          break;\n        case 'addStylesheet':\n          DOM.addStylesheet(data.data);\n          DOM.resizeFrame(hps);\n          break;\n        case 'setFocus':\n          DOM.setFocus();\n          break;\n      }\n    };\n  }\n\n  /**\n   * tokenizeIframe\n   *\n   * Tokenizes card data. Used in iframe integrations to tokenize on Heartland's\n   * servers.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} publicKey\n   */\n  public static tokenizeIframe(hps: HPS, publicKey: string) {\n    const card: CardData = {};\n    const numberElement = <HTMLInputElement>(document.getElementById('heartland-field')\n      || document.getElementById('heartland-card-number'));\n    const cvvElement = <HTMLInputElement>(document.getElementById('cardCvv')\n      || document.getElementById('heartland-cvv'));\n    const expElement = document.getElementById('cardExpiration');\n    const tokenResponse = (action: string) => {\n      return (response: TokenizationResponse) => {\n        hps.Messages.post({ action: action, response: response }, 'parent');\n        if (cvvElement) {\n          if (cvvElement.parentNode) {\n            cvvElement.parentNode.removeChild(cvvElement);\n          } else {\n            cvvElement.remove();\n          }\n        }\n        if (expElement) {\n          if (expElement.parentNode) {\n            expElement.parentNode.removeChild(expElement);\n          } else {\n            expElement.remove();\n          }\n        }\n      };\n    };\n\n    card.number = numberElement ? numberElement.value : '';\n    card.cvv = cvvElement ? cvvElement.value : '';\n    card.exp = expElement;\n\n    if (card.exp) {\n      const formatter = new ExpirationFormatter();\n      const cardExpSplit = formatter.format((<HTMLInputElement>card.exp).value, true).split('/');\n      card.expMonth = cardExpSplit[0];\n      card.expYear = cardExpSplit[1];\n      card.exp = undefined;\n    } else {\n      card.expMonth = (<HTMLInputElement>document.getElementById('heartland-expiration-month')).value;\n      card.expYear = (<HTMLInputElement>document.getElementById('heartland-expiration-year')).value;\n    }\n\n    hps.tokenize({\n      cardCvv: card.cvv ? card.cvv : '',\n      cardExpMonth: card.expMonth ? card.expMonth : '',\n      cardExpYear: card.expYear ? card.expYear : '',\n      cardNumber: card.number ? card.number : '',\n      error: tokenResponse('onTokenError'),\n      publicKey: publicKey ? publicKey : '',\n      success: tokenResponse('onTokenSuccess'),\n      type: 'pan'\n    });\n  }\n}\n","import {CardType} from \"./types/CardType\";\nimport {cardTypes} from \"./vars/cardTypes\";\nimport {CardNumber as CardNumberFormatter} from \"./Formatter/CardNumber\";\nimport {Expiration as ExpirationFormatter} from \"./Formatter/Expiration\";\nimport {CardNumber as CardNumberValidator} from \"./Validator/CardNumber\";\nimport {Cvv as CvvValidator} from \"./Validator/Cvv\";\nimport {Expiration as ExpirationValidator} from \"./Validator/Expiration\";\nimport {Events} from \"./Events\";\n\n/**\n * @namespace Heartland.Card\n */\nexport class Card {\n  /**\n   * Heartland.Card.typeByNumber\n   *\n   * Helper function to grab the CardType for a given card number.\n   *\n   * @param {string} number - The card number\n   * @returns {Heartland.CardType}\n   */\n  public static typeByNumber(number: string): CardType {\n    let cardType: CardType;\n    let i: any;\n\n    if (!number) { return null; }\n    if (number.replace(/^\\s+|\\s+$/gm, '').length < 4) { return null; }\n\n    for (i in cardTypes) {\n      cardType = cardTypes[i];\n      if (cardType && cardType.regex && cardType.regex.test(number)) {\n        break;\n      }\n    }\n\n    return cardType;\n  }\n\n  /**\n   * Heartland.Card.typeByTrack\n   *\n   * @param {string} data - track data\n   * @param {boolean} isEncrypted - (default: false)\n   * @param {string} trackNumber\n   *\n   * @returns CardType\n   */\n  public static typeByTrack(data: string, isEncrypted = false, trackNumber?: string) {\n    let number: string;\n\n    if (isEncrypted && trackNumber && trackNumber === '02') {\n      number = data.split('=')[0];\n    } else {\n      let temp = data.split('%');\n      if (temp[1]) {\n        temp = temp[1].split('^');\n        if (temp[0]) {\n          number = temp[0].toString().substr(1);\n        }\n      }\n    }\n\n    return Card.typeByNumber(number);\n  }\n\n  /**\n   * Heartland.Card.luhnCheck\n   *\n   * Runs a mod 10 check on a given card number.\n   *\n   * @param {string} number - The card number\n   * @returns {boolean}\n   */\n  public static luhnCheck(number: string): boolean {\n    let odd = true;\n    let i = 0;\n    let sum = 0;\n    let digit: number;\n\n    if (!number) {\n      return false;\n    }\n\n    const digits = number.split('').reverse();\n    const length = digits.length;\n\n    for (i; i < length; i++) {\n      digit = parseInt(digits[i], 10);\n      if (odd = !odd) {\n        digit *= 2;\n      }\n      if (digit > 9) {\n        digit -= 9;\n      }\n      sum += digit;\n    }\n\n    return sum % 10 === 0;\n  }\n\n  /**\n   * Heartland.Card.addType\n   *\n   * Adds a class to the target element with the card type\n   * inferred from the target's current value.\n   *\n   * @param {Event} e\n   */\n  public static addType(e: Event) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const type = Card.typeByNumber(target.value);\n    const classList = target.className.split(' ');\n    const length = classList.length;\n    let i = 0;\n    let c = '';\n\n    for (i; i < length; i++) {\n      c = classList[i];\n      if (c && c.indexOf('card-type-') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if (type) {\n      classList.push('card-type-' + type.code);\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.formatNumber\n   *\n   * Formats a target element's value based on the\n   * inferred card type's formatting regex.\n   *\n   * @param {Event} e\n   */\n  public static formatNumber(e: Event) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n\n    if (value.length === 0) { return; }\n\n    const formatted = (new CardNumberFormatter).format(value);\n    target.value = formatted;\n\n    if (!target.setSelectionRange) { return; }\n\n    let cursor = target.selectionStart;\n\n    // copy and paste, space inserted on formatter\n    if (value.length < formatted.length) {\n      cursor += formatted.length - value.length;\n    }\n\n    // check if before new inserted digit is a space\n    if (value.charAt(cursor) === ' ' &&\n      formatted.charAt(cursor - 1) === ' ') {\n      cursor += 1;\n    }\n\n    target.setSelectionRange(cursor, cursor);\n  }\n\n  /**\n   * Heartland.Card.formatExpiration\n   *\n   * Formats a target element's value.\n   *\n   * @param {KeyboardEvent} e\n   */\n  public static formatExpiration(e: KeyboardEvent) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n    // allow: delete, backspace\n    if ([46, 8].indexOf(e.keyCode) !== -1 ||\n      // allow: home, end, left, right\n      (e.keyCode >= 35 && e.keyCode <= 39)) {\n      return;\n    }\n    target.value = (new ExpirationFormatter)\n      .format(value, e.type === 'blur');\n  }\n\n  /**\n   * Heartland.Card.restrictLength\n   *\n   * Restricts input in a target element to a\n   * certain length data.\n   *\n   * @param {number} length\n   *\n   * @returns {(e: KeyboardEvent) => ()}\n   */\n  public static restrictLength(length: number) {\n    return function (e: KeyboardEvent) {\n      const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n      const value = target.value;\n      // allow: backspace, delete, tab, escape and enter\n      if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||\n        // allow: Ctrl+A\n        (e.keyCode === 65 && e.ctrlKey === true) ||\n        // allow: home, end, left, right\n        (e.keyCode >= 35 && e.keyCode <= 39)) {\n        // let it happen, don't do anything\n        return;\n      }\n      if (value.length >= length) {\n        e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n      }\n    };\n  }\n\n  /**\n   * Heartland.Card.restrictNumeric\n   *\n   * Restricts input in a target element to only\n   * numeric data.\n   *\n   * @param {KeyboardEvent} e\n   */\n  public static restrictNumeric(e: KeyboardEvent) {\n    // allow: backspace, delete, tab, escape and enter\n    if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||\n      // allow: Ctrl+A\n      (e.keyCode === 65 && e.ctrlKey === true) ||\n      // allow: home, end, left, right\n      (e.keyCode >= 35 && e.keyCode <= 39) ||\n      // allow: weird Android/Chrome issue\n      (e.keyCode === 229)) {\n      // let it happen, don't do anything\n      return;\n    }\n    // ensure that it is a number and stop the keypress\n    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {\n      e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n    }\n  }\n\n  /**\n   * Heartland.Card.deleteProperly\n   *\n   * Places cursor on the correct position to\n   * let the browser delete the digit instead\n   * of the space.\n   *\n   * @param {KeyboardEvent} e\n   */\n  public static deleteProperly(e: KeyboardEvent) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n\n    if (!target.setSelectionRange) { return; }\n\n    const cursor = target.selectionStart;\n\n    // allow: delete, backspace\n    if ([46, 8].indexOf(e.keyCode) !== -1 &&\n      // if space to be deleted\n      (value.charAt(cursor - 1) === ' ')) {\n      // placing cursor before space to delete digit instead\n      target.setSelectionRange(cursor - 1, cursor - 1);\n    }\n  }\n\n  /**\n   * Heartland.Card.validateNumber\n   *\n   * Validates a target element's value based on the\n   * inferred card type's validation regex. Adds a\n   * class to the target element to note `valid` or\n   * `invalid`.\n   *\n   * @param {Event} e\n   */\n  public static validateNumber(e: Event) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n    const classList = target.className.split(' ');\n    const length = classList.length;\n    let c = '';\n\n    for (let i = 0; i < length; i++) {\n      c = classList[i];\n      if (c.indexOf('valid') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if ((new CardNumberValidator).validate(value)) {\n      classList.push('valid');\n    } else {\n      classList.push('invalid');\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.validateCvv\n   *\n   * Validates a target element's value based on the\n   * possible CVV lengths. Adds a class to the target\n   * element to note `valid` or `invalid`.\n   *\n   * @param {Event} e\n   */\n  public static validateCvv(e: Event) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n    const classList = target.className.split(' ');\n    const length = classList.length;\n    let c = '';\n\n    for (let i = 0; i < length; i++) {\n      c = classList[i];\n      if (c.indexOf('valid') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if ((new CvvValidator).validate(value)) {\n      classList.push('valid');\n    } else {\n      classList.push('invalid');\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.validateExpiration\n   *\n   * Validates a target element's value based on the\n   * current date. Adds a class to the target element\n   * to note `valid` or `invalid`.\n   *\n   * @param {Event} e\n   */\n  public static validateExpiration(e: Event) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n    const classList = target.className.split(' ');\n    const length = classList.length;\n    let c = '';\n\n    for (let i = 0; i < length; i++) {\n      c = classList[i];\n      if (c.indexOf('valid') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if ((new ExpirationValidator).validate(value)) {\n      classList.push('valid');\n    } else {\n      classList.push('invalid');\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.attachNumberEvents\n   *\n   * @param {string} selector\n   */\n  public static attachNumberEvents(selector: string) {\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(19));\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.deleteProperly);\n    Events.addHandler(document.querySelector(selector), 'input', Card.formatNumber);\n    Events.addHandler(document.querySelector(selector), 'input', Card.validateNumber);\n    Events.addHandler(document.querySelector(selector), 'input', Card.addType);\n  }\n\n  /**\n   * Heartland.Card.attachExpirationEvents\n   *\n   * @param {string} selector\n   */\n  public static attachExpirationEvents(selector: string) {\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(9));\n    Events.addHandler(document.querySelector(selector), 'keyup', Card.formatExpiration);\n    Events.addHandler(document.querySelector(selector), 'blur', Card.formatExpiration);\n    Events.addHandler(document.querySelector(selector), 'input', Card.validateExpiration);\n    Events.addHandler(document.querySelector(selector), 'blur', Card.validateExpiration);\n  }\n\n  /**\n   * Heartland.Card.attachCvvEvents\n   *\n   * @param {string} selector\n   */\n  public static attachCvvEvents(selector: string) {\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(4));\n    Events.addHandler(document.querySelector(selector), 'input', Card.validateCvv);\n  }\n}\n\nif (!Array.prototype.indexOf) {\n  Array.prototype.indexOf = function (obj, start) {\n    for (let i = (start || 0), j = this.length; i < j; i++) {\n      if (this[i] === obj) { return i; }\n    }\n    return -1;\n  };\n}\n","import {CardNumber} from \"./CardNumber\";\nimport {Expiration} from \"./Expiration\";\n\nexport default {\n    CardNumber: CardNumber,\n    Expiration: Expiration\n}\n","import {HPS} from \"./HPS\";\n\n/**\n * @namespace Heartland.Styles\n */\nexport module Styles {\n  /**\n   * Heartland.Styles.Defaults\n   *\n   * Collection of helper functions for applying default styles to a child\n   * window's fields. Serves as an example of these methods' use in merchant\n   * modifications. Each function expects a `Heartland.HPS` object to be passed\n   * as an argument.\n   */\n  export const Defaults = {\n    body: function (hps: HPS) {\n      hps.setStyle('heartland-body',\n        'margin: 0;' +\n        'font-family: Arial, \\'Helvetica Neue\\', Helvetica, sans-serif;' +\n        'color: #666;'\n      );\n    },\n    cvv: function (hps: HPS) {\n      hps.appendStyle('heartland-cvv', 'width: 110px;');\n    },\n    cvvContainer: function (hps: HPS) {\n      hps.setStyle('heartland-cvv-container',\n        'width: 110px;' +\n        'display: inline-block;' +\n        'float: left;'\n      );\n    },\n    fieldset: function (hps: HPS) {\n      hps.setStyle('heartland-expiration-date-container',\n        'border: 0;' +\n        'margin: 0 25px 0px 1px;' +\n        'padding: 0;' +\n        'width: 173px;' +\n        'display: inline-block;' +\n        'float:  left;'\n      );\n    },\n    inputsAndSelects: function (hps: HPS) {\n      const ids = [\n        'heartland-card-number',\n        'heartland-expiration-month',\n        'heartland-expiration-year',\n        'heartland-cvv'\n      ];\n      const length = ids.length;\n      let i = 0;\n      for (i; i < length; i++) {\n        hps.setStyle(ids[i],\n          'width: 309px;' +\n          'padding: 5px;' +\n          'font-size: 14px;' +\n          'margin: 3px 0px 15px 0px;' +\n          'border: 1px #ccc solid;' +\n          /* IE10 Consumer Preview */\n          'background-image: -ms-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* Mozilla Firefox */\n          'background-image: -moz-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* Opera */\n          'background-image: -o-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* Webkit (Safari/Chrome 10) */\n          'background-image: -webkit-gradient(linear, left bottom, left top, color-stop(0, #F7F7F7), color-stop(1, #EFEFEF));' +\n          /* Webkit (Chrome 11+) */\n          'background-image: -webkit-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* W3C Markup, IE10 Release Preview */\n          'background-image: linear-gradient(to top, #F7F7F7 0%, #EFEFEF 100%);'\n        );\n      }\n    },\n    labelsAndLegend: function (hps: HPS) {\n      const ids = [\n        'heartland-card-number-label',\n        'heartland-expiration-date-legend',\n        'heartland-expiration-month-label',\n        'heartland-expiration-year-label',\n        'heartland-cvv-label'\n      ];\n      const length = ids.length;\n      let i = 0;\n      for (i; i < length; i++) {\n        hps.setStyle(ids[i],\n          'font-size: 13px;' +\n          'text-transform: uppercase;' +\n          'font-weight: bold;' +\n          'display: block;' +\n          'width: 100%;' +\n          'clear: both;'\n        );\n      }\n    },\n    selectLabels: function (hps: HPS) {\n      const ids = ['heartland-expiration-month-label', 'heartland-expiration-year-label'];\n      const length = ids.length;\n      let i = 0;\n      for (i; i < length; i++) {\n        hps.setStyle(ids[i],\n          'position:absolute;' +\n          'width:1px;' +\n          'height:1px;' +\n          'padding:0;' +\n          'margin:-1px;' +\n          'overflow:hidden;' +\n          'clip:rect(0,0,0,0);' +\n          'border:0;'\n        );\n      }\n    },\n    selects: function (hps: HPS) {\n      const ids = ['heartland-expiration-month', 'heartland-expiration-year'];\n      const length = ids.length;\n      let i = 0;\n      for (i; i < length; i++) {\n        hps.appendStyle(ids[i],\n          'border: 0;' +\n          'outline: 1px solid #ccc;' +\n          'height: 28px;' +\n          'width: 80px;' +\n          '-webkit-appearance: none;' +\n          '-moz-appearance: none;' +\n          '-webkit-border-radius: 0px;' +\n          /* tslint:disable:max-line-length */\n          'background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzA5MTZFN0RFMDY2MTFFNEIyODZFMURFRTA3REUxMjciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzA5MTZFN0VFMDY2MTFFNEIyODZFMURFRTA3REUxMjciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDMDkxNkU3QkUwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDMDkxNkU3Q0UwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvMrdUAAAABiSURBVHjaYkxLS3vNwMAgwoAfvGUCEjkMhEE285kzZ65u2bLlJ5DjgkNRxUwgYPz//z+Yl56ePhNIpaEpAqnJADGYkASzgHgnEn8HyEoYB24i1FReILUPynUEmvYFJgcQYACYah+uDhpKGAAAAABJRU5ErkJggg==);' +\n          /* tslint:enable:max-line-length */\n          'background-position: 65px 12px;' +\n          'background-repeat: no-repeat;' +\n          'background-color:  #F7F7F7;' +\n          'float: left;' +\n          'margin-right: 6px'\n        );\n      }\n    }\n  };\n}\n","import {Options} from \"../types/Options\";\n\nexport const defaults: Options = {\n  _method: 'post',\n  buttonTarget: '',\n  cardCvv: '',\n  cardExpMonth: '',\n  cardExpYear: '',\n  cardNumber: '',\n  cardType: '',\n  env: 'prod',\n  error: null,\n  fields: {},\n  formId: '',\n  gatewayUrl: '',\n  iframeTarget: '',\n  ktb: '',\n  object: 'token',\n  onEvent: null,\n  onTokenError: null,\n  onTokenSuccess: null,\n  pinBlock: '',\n  publicKey: '',\n  success: null,\n  targetType: '',\n  tokenType: 'supt',\n  track: '',\n  trackNumber: '',\n  type: 'pan',\n  useDefaultStyles: true\n};\n","export const fields = [\n  'cardNumber',\n  'cardCvv',\n  'cardExpiration',\n  'submit'\n];\n","export const urls = {\n  CERT: 'https://cert.api2.heartlandportico.com/Hps.Exchange.PosGateway.Hpf.v1/api/token',\n  PROD: 'https://api.heartlandportico.com/SecureSubmit.v1/api/token',\n  iframeCERT: 'https://hps.github.io/token/2.1/',\n  iframePROD: 'https://api.heartlandportico.com/SecureSubmit.v1/token/2.1/'\n};\n","import {Events} from \"./Events\";\nimport {HPS} from \"./HPS\";\n\n/**\n * Heartland.Messages\n *\n * Initializes a new object for wrapping `window.postMessage` and a fallback\n * method for legacy browsers.\n */\nexport class Messages {\n  hps: HPS;\n  intervalId: number;\n  lastHash: string;\n  pushIntervalStarted: boolean;\n  private callback: (m: any) => any;\n\n  /**\n   * Heartland.Messages (constructor)\n   *\n   * @constructor\n   * @param {Heartland.HPS} hps\n   * @returns {Heartland.Messages}\n   */\n  constructor(hps: HPS) {\n    this.hps = hps;\n    this.intervalId = null;\n    this.lastHash = '';\n    this.pushIntervalStarted = false;\n  }\n\n  /**\n   * Heartland.Messages.pushMessages\n   *\n   * For legacy browsers, a mailbox (buffer) must be used to ensure all messages\n   * are sent between parent and child windows. When ready, this function builds\n   * the final message, encodes it, sends it, and resets the mailbox to `[]`.\n   *\n   * @param {Heartland.HPS} hps\n   * @returns {function}\n   */\n  pushMessages(hps: HPS): () => void {\n    return function () {\n      const data: Array<any> = [];\n      const messageArr: Array<any> = [];\n      let i = 0;\n      let targetUrl = '';\n      let current: any;\n      let targetNode: Window;\n      const re = /^#?\\d+&/;\n\n      const length = hps.mailbox.length;\n      if (!length) {\n        return;\n      }\n\n      for (i = 0; i < length; i++) {\n        current = hps.mailbox.shift();\n        if (!targetUrl) {\n          targetUrl = current.targetUrl;\n          targetNode = current.targetNode;\n        }\n        messageArr.push(current.message);\n      }\n\n      current = null;\n      if (re.test(window.location.hash)) {\n        current = JSON.parse(decodeURIComponent(window.location.hash.replace(re, '')));\n        data.concat(current);\n      }\n\n      if (messageArr !== []) {\n        hps.cacheBust = hps.cacheBust || 1;\n        data.push({ data: messageArr, source: { name: hps.field || 'parent' } });\n        const message = JSON.stringify(data);\n        const url = targetUrl.replace(/#.*$/, '') + '#' +\n          (+new Date()) + (hps.cacheBust++) + '&' +\n          encodeURIComponent(message);\n        if (targetNode.location) {\n          targetNode.location.href = url;\n        } else {\n          (<any>targetNode).src = url;\n        }\n      }\n\n      messageArr.length = 0;\n      hps.mailbox.length = 0;\n    };\n  }\n\n  /**\n   * Heartland.Messages.post\n   *\n   * When present, wraps the built-in `window.postMessage`. When not present,\n   * pushes the message onto the mailbox for eventual sending, and on first use,\n   * starts the interval for `Messages.pushMessages`.\n   *\n   * @param {Object | string} message\n   * @param {string} target\n   */\n  post(message: Object | string, target: string): void {\n    let  targetNode: Window;\n\n    (<any>message).source = (<any>message).source || {};\n    (<any>message).source.name = window.name;\n\n    if (!this.hps.frames) {\n      return;\n    }\n\n    const frame = (<any>this.hps.frames)[target] || (<any>this.hps)[target];\n\n    if (!frame) {\n      return;\n    }\n\n    const targetUrl = (<any>this.hps.frames)[target].url;\n\n    try {\n      if (typeof frame.targetNode !== 'undefined') {\n        targetNode = frame.targetNode;\n      } else if (typeof frame.frame !== 'undefined') {\n        targetNode = frame.frame;\n      }\n    } catch (e) {\n      targetNode = frame;\n    }\n\n    if (window.postMessage) {\n      targetNode.postMessage(\n        JSON.stringify(message),\n        targetUrl\n      );\n    } else {\n      this.hps.mailbox = this.hps.mailbox || [];\n      this.hps.mailbox.push({\n        message: message,\n        targetNode: targetNode,\n        targetUrl: targetUrl\n      });\n      if (!this.pushIntervalStarted) {\n        setInterval(this.pushMessages(this.hps), 10);\n      }\n    }\n  }\n\n  /**\n   * Heartland.Messages.receive\n   *\n   * When present, wraps the built-in `window.postMesage`'s `message` or\n   * `onmessage` window events. When not present, uses a single interval to\n   * check for changes to `window.location.hash` when the other window sends a\n   * message and will decode the JSON and URI encoded hash.\n   *\n   * @param {Function} callback\n   * @param {string} sourceOrigin\n   */\n  receive(callback: Function, sourceOrigin: string): void {\n    if (window.postMessage) {\n      this.callback = function (m) {\n        callback(JSON.parse(m.data));\n      };\n      if (window.addEventListener) {\n        window.addEventListener('message', this.callback, !1);\n      } else {\n        (<any>window).attachEvent('onmessage', this.callback);\n      }\n    } else {\n      if (this.intervalId) {\n        clearInterval(this.intervalId);\n      }\n      this.intervalId = null;\n\n      if (callback) {\n        this.intervalId = setInterval(function () {\n          const hash = document.location.hash,\n            re = /^#?\\d+&/;\n          if (hash !== this.lastHash && re.test(hash)) {\n            const data = JSON.parse(decodeURIComponent(hash.replace(re, '')));\n            this.lastHash = hash;\n\n            for (const i in data) {\n              const m = data[i];\n              if (Object.prototype.toString.call(m.data) !== '[object Array]') {\n                callback(m);\n                continue;\n              }\n\n              for (const j in m.data) {\n                callback({ data: m.data[j], source: m.source });\n              }\n            }\n          }\n        }, 100);\n      }\n    }\n    Events.trigger('receiveMessageHandlerAdded', document);\n  }\n\n  /**\n   * Heartland.Messages.removeReceiver\n   *\n   * Removes active `message` event handler function.\n   */\n  removeReceiver() {\n    if (window.addEventListener) {\n      window.removeEventListener('message', this.callback, !1);\n    } else {\n      (<any>window).detachEvent('onmessage', this.callback);\n    }\n  }\n\n  /**\n   * Heartland.Messages.dispose\n   *\n   * Removes active `message` event handler function and any\n   * active intervals.\n   */\n  dispose(): void {\n    this.removeReceiver();\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n    }\n  }\n}\n","import {defaults} from \"./vars/defaults\";\nimport {fields} from \"./vars/fields\";\nimport {urls} from \"./vars/urls\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport {HPS} from \"./HPS\";\nimport {Messages} from \"./Messages\";\nimport {Styles} from \"./Styles\";\n\n/**\n * @namespace Heartland.Frames\n */\nexport class Frames {\n  /**\n   * Heartland.Frames.configureIframe\n   *\n   * Prepares the pages iFrames for communication with the parent window.\n   *\n   * @param {Heartland.HPS} hps\n   * @listens click\n   * @listens message\n   */\n  public static configureIframe(hps: HPS) {\n    let frame: any;\n    let options = hps.options;\n    let target: HTMLElement;\n    let useDefaultStyles = true;\n    hps.Messages = hps.Messages || new Messages(hps);\n\n    if (options.env === 'cert') {\n      hps.iframe_url = urls.iframeCERT;\n    } else {\n      hps.iframe_url = urls.iframePROD;\n    }\n\n    if (options.fields !== defaults.fields) {\n      Frames.makeFieldsAndLink(hps);\n    }\n\n    if (options.fields === defaults.fields && options.iframeTarget) {\n      target = document.getElementById(options.iframeTarget);\n      if (options.targetType === 'myframe') {\n        frame = target;\n        hps.iframe_url = frame.src;\n      } else {\n        frame = DOM.makeFrame('heartland-frame-securesubmit');\n        target.appendChild(frame);\n      }\n\n      hps.iframe_url = hps.iframe_url + '#' + encodeURIComponent(document.location.href.split('#')[0]);\n      frame.src = hps.iframe_url;\n\n      hps.frames.child = {\n        frame: window.postMessage ? frame.contentWindow : frame,\n        name: 'child',\n        url: hps.iframe_url\n      };\n    }\n\n    if (options.useDefaultStyles === false) {\n      useDefaultStyles = false;\n    }\n\n    if (options.buttonTarget) {\n      hps.clickHandler = function (e) {\n        e.preventDefault();\n        hps.Messages.post(\n          {\n            accumulateData: !!hps.frames.cardNumber,\n            action: 'tokenize',\n            message: options.publicKey\n          },\n          hps.frames.cardNumber ? 'cardNumber' : 'child'\n        );\n        return false;\n      };\n      Events.addHandler(options.buttonTarget, 'click', hps.clickHandler);\n    }\n\n    hps.Messages.receive(function (data: any) {\n      let fieldFrame: any;\n\n      try {\n        fieldFrame = (<any>hps.frames)[data.source.name === 'heartland-frame-securesubmit' ? 'parent' : data.source.name];\n      } catch (e) { return; }\n\n      switch (data.action) {\n        case 'requestTokenize':\n          hps.Messages.post(\n            {\n              accumulateData: !!hps.frames.cardNumber,\n              action: 'tokenize',\n              message: options.publicKey\n            },\n            hps.frames.cardNumber ? 'cardNumber' : 'child'\n          );\n          break;\n        case 'onTokenSuccess':\n          options.onTokenSuccess(data.response);\n          break;\n        case 'onTokenError':\n          options.onTokenError(data.response);\n          break;\n        case 'resize':\n          if (fieldFrame) {\n            hps.resizeIFrame(fieldFrame.frame, data.height);\n          } else {\n            hps.resizeIFrame(frame, data.height);\n          }\n\n          break;\n        case 'receiveMessageHandlerAdded':\n          if (!options.fields && useDefaultStyles) {\n            Styles.Defaults.body(hps);\n            Styles.Defaults.labelsAndLegend(hps);\n            Styles.Defaults.inputsAndSelects(hps);\n            Styles.Defaults.fieldset(hps);\n            Styles.Defaults.selects(hps);\n            Styles.Defaults.selectLabels(hps);\n            Styles.Defaults.cvvContainer(hps);\n            Styles.Defaults.cvv(hps);\n          }\n\n          if (fieldFrame && fieldFrame.options.placeholder) {\n            hps.Messages.post(\n              {\n                action: 'setPlaceholder',\n                id: 'heartland-field',\n                text: fieldFrame.options.placeholder\n              },\n              fieldFrame.name\n            );\n          }\n\n          if (options.style) {\n            const css = options.styleString\n              || (options.styleString = DOM.json2css(options.style));\n            hps.Messages.post(\n              {\n                action: 'addStylesheet',\n                data: css\n              },\n              fieldFrame.name\n            );\n          }\n\n          Events.trigger('securesubmitIframeReady', document);\n          break;\n        case 'accumulateData':\n          for (const i in hps.frames) {\n            if ('submit' === i || 'cardNumber' === i) {\n              continue;\n            }\n            const field = (<any>hps.frames)[i];\n            hps.Messages.post(\n              {\n                action: 'getFieldData',\n                id: 'heartland-field'\n              },\n              field.name\n            );\n          }\n          break;\n        case 'passData':\n          const cardNumberFieldFrame = hps.frames.cardNumber;\n          if (!cardNumberFieldFrame) {\n            break;\n          }\n\n          hps.Messages.post(\n            {\n              action: 'setFieldData',\n              id: fieldFrame.name,\n              value: data.value\n            },\n            cardNumberFieldFrame.name\n          );\n          break;\n        case 'fieldEvent':\n          if (!options.onEvent) {\n            break;\n          }\n          options.onEvent(data.event);\n          break;\n        case 'error':\n          if (!options.onError) {\n            break;\n          }\n          options.onError(data);\n          break;\n      }\n    }, '*');\n\n\n    // monitorFieldEvents(hps, )\n  }\n\n  /**\n   * Heartland.Frames.makeFieldsAndLink\n   *\n   * Creates a set of single field iFrames and stores a reference to\n   * them in the parent window's state.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static makeFieldsAndLink(hps: HPS) {\n    const options = hps.options;\n    const fieldsLength = fields.length;\n    const baseUrl = hps.iframe_url.replace('index.html', '');\n\n    for (let i = 0; i < fieldsLength; i++) {\n      const field = fields[i];\n      const fieldOptions = options.fields[field];\n\n      if (!fieldOptions) { return; }\n\n      const frame = DOM.makeFrame(field);\n      let url = baseUrl;\n      if (field === 'submit') {\n        url = url + 'button.html';\n      } else {\n        url = url + 'field.html';\n      }\n      url = url + '#' + field + ':' + encodeURIComponent(document.location.href.split('#')[0]);\n      frame.src = url;\n\n      document\n        .getElementById(fieldOptions.target)\n        .appendChild(frame);\n\n      (<any>hps.frames)[field] = {\n        frame: frame,\n        name: field,\n        options: fieldOptions,\n        target: fieldOptions.target,\n        targetNode: window.postMessage ? frame.contentWindow : frame,\n        url: url\n      };\n    }\n  }\n\n  /**\n   * Heartland.Frames.monitorFieldEvents\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string | EventTarget} target\n   */\n  public static monitorFieldEvents(hps: HPS, target: string | EventTarget) {\n    const events = ['click', 'blur', 'focus', 'change', 'keypress', 'keydown', 'keyup'];\n    let i = 0, length = events.length;\n\n    for (i; i < length; i++) {\n      const event = events[i];\n      Events.addHandler(target, event, function (e: Event) {\n        const field = document.getElementById('heartland-field');\n        let classes: string[] = [];\n        const data: any = {};\n\n        if (field.className !== '') {\n          classes = field.className.split(' ');\n        }\n\n        if ((<any>e).keyCode) {\n          data.keyCode = (<any>e).keyCode;\n        }\n\n        hps.Messages.post(\n          {\n            action: 'fieldEvent',\n            event: {\n              classes: classes,\n              data: data,\n              source: window.name,\n              type: e.type\n            }\n          },\n          'parent'\n        );\n      });\n    }\n  }\n}\n","import {Ajax} from \"./Ajax\";\nimport {Card} from \"./Card\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport {CardData} from \"./types/CardData\";\nimport {CardType} from \"./types/CardType\";\nimport {Options} from \"./types/Options\";\nimport {TokenizationResponse} from \"./types/TokenizationResponse\";\nimport {urls} from \"./vars/urls\";\n\n/**\n * @namespace Heartland.Util\n */\nexport class Util {\n  /**\n   * Heartland.Util.getCardType\n   *\n   * Parses a credit card number to obtain the card type/brand.\n   *\n   * @param {string} tokenizationType\n   * @param {Heartland.Options} options\n   */\n  public static getCardType(tokenizationType: string, options: Options) {\n    let cardType: CardType;\n    let data = '';\n    let type = 'unknown';\n\n    switch (tokenizationType) {\n      case 'swipe':\n        data = options.track;\n        cardType = Card.typeByTrack(data);\n        break;\n      case 'encrypted':\n        data = options.track;\n        cardType = Card.typeByTrack(data, true, options.trackNumber);\n        break;\n      default:\n        data = options.cardNumber;\n        cardType = Card.typeByNumber(data);\n        break;\n    }\n\n    if (cardType) {\n      type = cardType.code;\n    }\n\n    return type;\n  }\n\n  /**\n   * Heartland.Util.applyOptions\n   *\n   * Creates a single object by merging a `source` (default) and `properties`\n   * obtained elsewhere, e.g. a function argument in `HPS`. Any properties in\n   * `properties` will overwrite matching properties in `source`.\n   *\n   * @param {Heartland.Options} source\n   * @param {Heartland.Options} properties\n   * @returns {Heartland.Options}\n   */\n  public static applyOptions(source: Options, properties: Options) {\n    const destination: Options = {};\n\n    if (!source) {\n      source = {};\n    }\n\n    for (const property in source) {\n      if (source.hasOwnProperty(property)) {\n        (<any>destination)[property] = (<any>source)[property];\n      }\n    }\n\n    for (const property in properties) {\n      if (properties.hasOwnProperty(property)) {\n        (<any>destination)[property] = (<any>properties)[property];\n      }\n    }\n\n    return destination;\n  }\n\n  /**\n   * Heartland.Util.throwError\n   *\n   * Allows a merchant-defined error handler to be used in cases where the\n   * tokenization process fails. If not provided, we throw the message as a\n   * JS runtime error.\n   *\n   * @param {Heartland.Options} options\n   * @param {string | Heartland.TokenizationResponse} errorMessage\n   */\n  public static throwError(options: Options, errorMessage: string | TokenizationResponse) {\n    if (typeof (options.error) === 'function') {\n      options.error(errorMessage);\n    } else {\n      throw errorMessage;\n    }\n  }\n\n  /**\n   * Heartland.Util.getItemByPropertyValue\n   *\n   * Enumerates over a `collection` to retreive an item whose `property` is\n   * a given `value`.\n   *\n   * @param {any} collection\n   * @param {string} property\n   * @param {any} value\n   * @returns {any}\n   */\n  public static getItemByPropertyValue(collection: any, property: string, value: any) {\n    const length = collection.length;\n    let i = 0;\n\n    for (i; i < length; i++) {\n      if (collection[i][property] === value) {\n        return collection[i];\n      }\n    }\n  }\n\n  /**\n   * Heartland.Util.getParams\n   *\n   * Builds param list for a particular `type` from expected properties in\n   * `data`.\n   *\n   * @param {string} type - The tokenization type\n   * @param {Heartland.Options} data\n   * @returns {string}\n   */\n  public static getParams(type: string, data: Options) {\n    const params: Array<string> = [];\n    switch (type) {\n      case 'pan':\n        params.push(\n          'token_type=supt',\n          'object=token',\n          '_method=post',\n          'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Bnumber%5D=' + data.cardNumber.replace(/\\s/g, ''),\n          'card%5Bexp_month%5D=' + data.cardExpMonth.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Bexp_year%5D=' + data.cardExpYear.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Bcvc%5D=' + data.cardCvv.replace(/^\\s+|\\s+$/g, '')\n        );\n        break;\n      case 'swipe':\n        params.push(\n          'token_type=supt',\n          'object=token',\n          '_method=post',\n          'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Btrack_method%5D=swipe',\n          'card%5Btrack%5D=' + encodeURIComponent(data.track.replace(/^\\s+|\\s+$/g, ''))\n        );\n        break;\n      case 'encrypted':\n        params.push(\n          'token_type=supt',\n          'object=token',\n          '_method=post',\n          'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''),\n          'encryptedcard%5Btrack_method%5D=swipe',\n          'encryptedcard%5Btrack%5D=' + encodeURIComponent(data.track.replace(/^\\s+|\\s+$/g, '')),\n          'encryptedcard%5Btrack_number%5D=' + encodeURIComponent(data.trackNumber.replace(/^\\s+|\\s+$/g, '')),\n          'encryptedcard%5Bktb%5D=' + encodeURIComponent(data.ktb.replace(/^\\s+|\\s+$/g, '')),\n          'encryptedcard%5Bpin_block%5D=' + encodeURIComponent(data.pinBlock.replace(/^\\s+|\\s+$/g, ''))\n        );\n        break;\n      default:\n        Util.throwError(data, 'unknown params type');\n        break;\n    }\n    return params.join('&');\n  }\n\n  /**\n   * Heartland.Util.getUrlByEnv\n   *\n   * Selects the appropriate tokenization service URL for the\n   * active `publicKey`.\n   *\n   * @param {Heartland.Options} options\n   * @returns {string}\n   */\n  public static getUrlByEnv(options: Options) {\n    options.env = options.publicKey.split('_')[1];\n\n    if (options.env === 'cert') {\n      options.gatewayUrl = urls.CERT;\n    } else {\n      options.gatewayUrl = urls.PROD;\n    }\n\n    return options;\n  }\n\n  /**\n   * Heartland.Util.addFormHandler\n   *\n   * Creates and adds an event handler function for the submission for a given\n   * form (`options.form_id`).\n   *\n   * @param {Heartland.Options} options\n   * @listens submit\n   */\n  public static addFormHandler(options: Options) {\n    const payment_form = document.getElementById(options.formId);\n\n    const code = function (e: Event) {\n      if (e.preventDefault) {\n        e.preventDefault();\n      } else if (window.event) /* for ie */ {\n        window.event.returnValue = false;\n      }\n\n      const fields = Util.getFields(options.formId);\n      const cardType = Util.getCardType(fields.number, 'pan');\n\n      options.cardNumber = fields.number;\n      options.cardExpMonth = fields.expMonth;\n      options.cardExpYear = fields.expYear;\n      options.cardCvv = fields.cvv;\n      options.cardType = cardType;\n\n      Ajax.call('pan', options);\n    };\n\n    Events.addHandler(payment_form, 'submit', code);\n    DOM.addField(options.formId, 'hidden', 'publicKey', options.publicKey);\n  }\n\n  /**\n   * Heartland.Util.getFields\n   *\n   * Extracts card information from the fields with names `card_number`,\n   * `card_expiration_month`, `card_expiration_year`, and `card_cvc` and\n   * expects them to be present as children of `formParent`.\n   *\n   * @param {string} formParent\n   * @returns {Heartland.CardData}\n   */\n  public static getFields(formParent: string): CardData {\n    const form = document.getElementById(formParent);\n    const fields: CardData = {};\n    let i: number;\n    const length = form.childElementCount;\n\n    for (i = 0; i < length; i++) {\n      const element = <HTMLInputElement>form.children[i];\n      if (element.id === 'card_number') {\n        fields.number = element.value;\n      } else if (element.id === 'card_expiration_month') {\n        fields.expMonth = element.value;\n      } else if (element.id === 'card_expiration_year') {\n        fields.expYear = element.value;\n      } else if (element.id === 'card_cvc') {\n        fields.cvv = element.value;\n      }\n    }\n\n    return fields;\n  }\n}\n","import {Ajax, JsonpRequest} from \"../Ajax\";\nimport {Options} from \"../types/Options\";\nimport {Util} from \"../Util\";\nimport {TokenizationResponse} from \"../types/TokenizationResponse\";\nimport {TokenService} from \"./TokenService\";\n\nexport class HeartlandTokenService implements TokenService {\n  protected requestData: Options;\n  protected type: string;\n  protected url: string;\n\n  constructor(url: string, type = \"pan\") {\n    this.url = url;\n    this.type = type;\n  }\n\n  tokenize(data: Object, callback: (response: TokenizationResponse) => void) {\n    this.requestData = data;\n    Ajax.jsonp(this.buildRequest(data), (response) => {\n      callback(this.deserializeResponseData(response));\n    });\n  }\n\n  buildRequest(data: Object): JsonpRequest {\n    return new JsonpRequest(\n      this.url,\n      this.serializeRequestData(data)\n    );\n  }\n\n  serializeRequestData(data: Object): string {\n    return Util.getParams(this.type, data);\n  }\n\n  deserializeResponseData(data: any): TokenizationResponse {\n    if (data.error) {\n      return data;\n    }\n\n    const cardType = Util.getCardType(this.type, this.requestData);\n    const card = data.card || data.encryptedcard;\n    const lastfour = card.number.slice(-4);\n\n    data.last_four = lastfour;\n    data.card_type = cardType;\n    data.exp_month = this.requestData.cardExpMonth;\n    data.exp_year = this.requestData.cardExpYear;\n    return data;\n  }\n}\n","import {defaults} from \"./vars/defaults\";\n\nimport {Ajax} from \"./Ajax\";\nimport {Card} from \"./Card\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport {Frames} from \"./Frames\";\nimport {Messages} from \"./Messages\";\nimport {Util} from \"./Util\";\n\nimport {HeartlandTokenService} from \"./TokenService/HeartlandTokenService\";\n\nimport {Options} from \"./types/Options\";\n\ninterface Frame {\n  frame?: Window;\n  name?: string;\n  options?: any;\n  target?: string;\n  targetNode?: EventTarget;\n  url?: string;\n}\n\ninterface FrameCollection {\n  cardNumber?: Frame;\n  cardExpiration?: Frame;\n  cardCvv?: Frame;\n  submit?: Frame;\n  child?: Frame;\n  parent?: Frame;\n}\n\n/**\n * Heartland.HPS\n *\n * Initializes options and adds the default form handler if a `formId` is\n * passed as an option. This expects the default fields (see `getFields`) to\n * be present as children of `formId`.\n */\nexport class HPS {\n  options: Options;\n  frames: FrameCollection;\n  iframe_url: string;\n  Messages: Messages;\n  mailbox: any; // [];\n  cacheBust: number;\n  parent: Window;\n  field: string;\n  clickHandler: (e: Event) => void;\n  loadHandler: () => void;\n  receiveMessageHandlerAddedHandler: () => void;\n\n  /**\n   * Heartland.HPS (constructor)\n   *\n   * @constructor\n   * @param {Heartland.Options} options [optional]\n   * @returns {Heartland.HPS}\n   */\n  constructor(options?: Options) {\n    if (!options && window.parent) {\n      return;\n    }\n\n    this.options = Util.applyOptions(defaults, options);\n    this.options = Util.getUrlByEnv(this.options);\n\n    if (this.options.formId.length > 0) {\n      Util.addFormHandler(this.options);\n    }\n\n    this.frames = {};\n    if (this.options.type === 'iframe') {\n      this.iframe_url = '';\n\n      this.Messages = new Messages(this);\n      this.mailbox = [];\n      this.cacheBust = 1;\n      Frames.configureIframe(this);\n    }\n\n    return this;\n  }\n\n  /**\n   * Heartland.HPS.tokenize\n   *\n   * Tokenizes card data. Used in manual integrations where the merchant's\n   * credit card fields cannot/do not match the names expected in the default\n   * form handler (see `getFields`).\n   *\n   * @param {Heartland.Options} options [optional]\n   */\n  tokenize(options?: Options): void {\n    options = options || {};\n    if (options) {\n      this.options = Util.applyOptions(this.options, options);\n      this.options = Util.getUrlByEnv(this.options);\n    }\n    if (this.options.type === 'iframe') {\n      this.Messages.post(\n        {\n          action: 'tokenize',\n          message: this.options.publicKey\n        },\n        'child'\n      );\n      return;\n    }\n    (new HeartlandTokenService(this.options.gatewayUrl, this.options.type))\n      .tokenize(this.options, (response) => {\n        if (response.error) {\n            Util.throwError(this.options, response);\n        } else {\n            if (this.options.formId && this.options.formId.length > 0) {\n            DOM.addField(this.options.formId, 'hidden', 'token_value', response.token_value);\n            DOM.addField(this.options.formId, 'hidden', 'last_four', response.last_four);\n            DOM.addField(this.options.formId, 'hidden', 'card_exp_year', response.exp_year);\n            DOM.addField(this.options.formId, 'hidden', 'card_exp_month', response.exp_month);\n            DOM.addField(this.options.formId, 'hidden', 'card_type', response.card_type);\n            }\n\n            this.options.success(response);\n        }\n      });\n  };\n\n  /**\n   * Heartland.HPS.configureInternalIframe\n   *\n   * Sets up a child iframe window to prepare it for communication with the\n   * parent and for tokenization.\n   *\n   * @param {Heartland.Options} options\n   */\n  configureInternalIframe(options: Options): void {\n    this.Messages = new Messages(this);\n    this.parent = window.parent;\n    this.frames = this.frames || {};\n    this.frames.parent = {\n      frame: window.parent,\n      name: 'parent',\n      url: decodeURIComponent(document.location.hash.replace(/^#/, ''))\n    };\n\n    this.loadHandler = (function (hps: HPS) {\n      return function () {\n        DOM.resizeFrame(hps);\n      };\n    } (this));\n\n    this.receiveMessageHandlerAddedHandler = (function (hps: HPS) {\n      return function () {\n        hps.Messages.post({ action: 'receiveMessageHandlerAdded' }, 'parent');\n      };\n    } (this));\n\n    Events.addHandler(window, 'load', this.loadHandler);\n    Events.addHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n\n    this.Messages.receive(Events.frameHandleWith(this), '*');\n  };\n\n  /**\n   * Heartland.HPS.configureButtonFieldIframe\n   *\n   * Same as `Heartland.HPS.configureFieldIframe` excet the added click event\n   * handler for the button.\n   *\n   * @param {Heartland.Options} options\n   */\n  configureButtonFieldIframe(options: Options): void {\n    this.configureFieldIframe(options);\n    Events.addHandler('heartland-field', 'click', (function (hps: HPS) {\n      return function (e: Event) {\n        e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n        hps.Messages.post({ action: 'requestTokenize' }, 'parent');\n      };\n    } (this)));\n  }\n\n  /**\n   * Heartland.HPS.configureFieldIframe\n   *\n   * Sets up a child iframe window to prepare it for communication with the\n   * parent and for tokenization.\n   *\n   * @param {Heartland.Options} options\n   */\n  configureFieldIframe(options: Options): void {\n    const hash = document.location.hash.replace(/^#/, '');\n    const split = hash.split(':');\n    this.Messages = new Messages(this);\n    this.field = split.shift();\n    this.parent = window.parent;\n    this.frames = this.frames || {};\n    this.frames.parent = {\n      frame: window.parent,\n      name: 'parent',\n      url: decodeURIComponent(split.join(':').replace(/^:/, ''))\n    };\n\n    window.onerror = (function (hps: HPS) {\n      return function (errorMsg: string, url: string, lineNumber: number, column: number, errorObj: any) {\n        hps.Messages.post({\n          action: 'error',\n          data: {\n            column: column,\n            errorMsg: errorMsg,\n            lineNumber: lineNumber,\n            url: url\n          }\n        }, 'parent');\n        return true;\n      };\n    } (this));\n\n    this.loadHandler = (function (hps: HPS) {\n      return function () {\n        DOM.resizeFrame(hps);\n        DOM.configureField(hps);\n        const method = 'attach' + window.name.replace('card', '') + 'Events';\n        if ((<any>Card)[method]) {\n          (<any>Card)[method]('#heartland-field');\n        }\n      };\n    } (this));\n\n    this.receiveMessageHandlerAddedHandler = (function (hps: HPS) {\n      return function () {\n        hps.Messages.post({ action: 'receiveMessageHandlerAdded' }, 'parent');\n      };\n    } (this));\n\n    Events.addHandler(window, 'load', this.loadHandler);\n    Events.addHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n    Frames.monitorFieldEvents(this, 'heartland-field');\n\n    this.Messages.receive(Events.frameHandleWith(this), '*');\n  };\n\n  /**\n   * Heartland.HPS.resizeIFrame\n   *\n   * Called automatically when the child iframe window alerts the parent to\n   * resize.\n   *\n   * @param {HTMLIFrameElement} frame\n   * @param {string} height\n   */\n  resizeIFrame(frame: HTMLIFrameElement, height: string): void {\n    if (!frame) { return; }\n    frame.style.height = (parseInt(height, 10)) + 'px';\n  };\n\n  /**\n   * Heartland.HPS.setText\n   *\n   * Public API for setting an element's inner text.\n   *\n   * @param {string} elementid\n   * @param {string} elementtext\n   */\n  setText(elementid: string, elementtext: string): void {\n    this.Messages.post({ action: 'setText', id: elementid, text: elementtext }, 'child');\n  };\n\n  /**\n   * Heartland.HPS.setStyle\n   *\n   * Public API for setting an element's style.\n   *\n   * @param {string} elementid\n   * @param {string} elementstyle\n   */\n  setStyle(elementid: string, elementstyle: string): void {\n    this.Messages.post({ action: 'setStyle', id: elementid, style: elementstyle }, 'child');\n  };\n\n  /**\n   * Heartland.HPS.appendStyle\n   *\n   * Public API for appending to an element's style.\n   *\n   * @param {string} elementid\n   * @param {string} elementstyle\n   */\n  appendStyle(elementid: string, elementstyle: string): void {\n    this.Messages.post({ action: 'appendStyle', id: elementid, style: elementstyle }, 'child');\n  };\n\n  /**\n   * Heartland.HPS.setFocus\n   *\n   * Public API for appending to an element's style.\n   *\n   * @param {string} elementid\n   */\n  setFocus(elementid: string): void {\n    this.Messages.post({ action: 'setFocus' }, elementid);\n  };\n\n  /**\n   * Heartland.HPS.dispose\n   *\n   * Removes all iframes and event listeners from the DOM.\n   */\n  dispose(): void {\n    this.Messages.dispose();\n    this.Messages = null;\n    if (this.frames.cardNumber && this.frames.cardNumber.targetNode) {\n      (<any>this.frames.cardNumber.frame).remove();\n    }\n    if (this.frames.cardExpiration && this.frames.cardExpiration.frame) {\n      (<any>this.frames.cardExpiration.frame).remove();\n    }\n    if (this.frames.cardCvv && this.frames.cardCvv.frame) {\n      (<any>this.frames.cardCvv.frame).remove();\n    }\n    if (this.frames.child && this.frames.child.frame) {\n      (<any>this.frames.child.frame).remove();\n    }\n    if (this.clickHandler) {\n      Events.removeHandler(\n        this.options.buttonTarget,\n        'click',\n        this.clickHandler\n      );\n    }\n    if (this.loadHandler) {\n      Events.removeHandler(\n        window,\n        'load',\n        this.loadHandler\n      );\n    }\n    if (this.receiveMessageHandlerAddedHandler) {\n      Events.removeHandler(\n        document,\n        'receiveMessageHandlerAdded',\n        this.receiveMessageHandlerAddedHandler\n      );\n    }\n  };\n}\n","import {CardNumber} from \"./CardNumber\";\nimport {Cvv} from \"./Cvv\";\nimport {Expiration} from \"./Expiration\";\n\nexport default {\n    CardNumber: CardNumber,\n    Cvv: Cvv,\n    Expiration: Expiration\n}\n","import {Ajax} from \"./Ajax\";\nimport {Card} from \"./Card\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport Formatter from \"./Formatter\";\nimport {Frames} from \"./Frames\";\nimport {HPS} from \"./HPS\";\nimport {Messages} from \"./Messages\";\nimport {Styles} from \"./Styles\";\nimport {Util} from \"./Util\";\nimport Validator from \"./Validator\";\n\nexport default {\n    Ajax: Ajax,\n    Card: Card,\n    DOM: DOM,\n    Events: Events,\n    Formatter: Formatter,\n    Frames: Frames,\n    HPS: HPS,\n    Messages: Messages,\n    Styles: Styles,\n    Util: Util,\n    Validator: Validator\n}\n"],"names":["url","payload","this","Ajax","request","callback","script","document","createElement","callbackName","Math","round","random","window","data","undefined","body","removeChild","src","indexOf","appendChild","xhr","timeout","method","XMLHttpRequest","withCredentials","XDomainRequest","split","open","setRequestHeader","cb","e","clearTimeout","type","error","message","readyState","responseText","JSON","parse","onload","onerror","send","setTimeout","abort","cardTypes","code","format","length","regex","CardNumber","number","replace","Card","typeByNumber","matches","match","global","shift","join","Expiration","exp","final","month","del","year","pat","groups","Date","getFullYear","toString","slice","luhnCheck","Cvv","cvv","test","m","y","parseInt","DOM","hps","getElementById","setAttribute","field","name","frame","id","style","border","frameBorder","scrolling","formParent","fieldType","fieldName","fieldValue","input","elementid","htmlstyle","el","encodeEntities","currstyle","getAttribute","newstyle","text","textContent","docHeight","offsetHeight","Messages","post","action","height","value","css","elements","getElementsByTagName","createTextNode","json","attributes","children","i","j","key","jsonAttributes","attributesLength","isArray","arrLength","jsonChildren","childrenLength","json2css","focus","v","hi","charCodeAt","low","obj","Object","prototype","call","set","hasOwnProperty","push","Ev","node","eventName","addEventListener","documentElement","attachEvent","propertyName","createEvent","event","initEvent","dispatchEvent","removeEventListener","detachEvent","Events","target","listen","ignore","bubble","trigger","accumulateData","tokenizeIframe","setStyle","resizeFrame","appendStyle","setText","setPlaceholder","setFieldData","pkey","getFieldData","addStylesheet","setFocus","publicKey","card","numberElement","cvvElement","expElement","tokenResponse","response","parentNode","remove","formatter","ExpirationFormatter","cardExpSplit","expMonth","expYear","tokenize","cardCvv","cardExpMonth","cardExpYear","cardNumber","success","cardType","isEncrypted","trackNumber","temp","substr","digit","odd","sum","digits","reverse","currentTarget","srcElement","classList","className","c","formatted","CardNumberFormatter","setSelectionRange","cursor","selectionStart","charAt","keyCode","ctrlKey","preventDefault","returnValue","shiftKey","CardNumberValidator","validate","CvvValidator","ExpirationValidator","selector","addHandler","querySelector","restrictNumeric","restrictLength","deleteProperly","formatNumber","validateNumber","addType","formatExpiration","validateExpiration","validateCvv","Array","start","Styles","defaults","_method","buttonTarget","env","fields","formId","gatewayUrl","iframeTarget","ktb","object","onEvent","onTokenError","onTokenSuccess","pinBlock","targetType","tokenType","track","useDefaultStyles","urls","CERT","PROD","iframeCERT","iframePROD","intervalId","lastHash","pushIntervalStarted","current","targetNode","messageArr","targetUrl","re","mailbox","location","hash","decodeURIComponent","concat","cacheBust","source","stringify","encodeURIComponent","href","frames","postMessage","setInterval","pushMessages","sourceOrigin","clearInterval","removeReceiver","cvvContainer","fieldset","inputsAndSelects","ids","labelsAndLegend","selectLabels","selects","Frames","options","iframe_url","makeFieldsAndLink","makeFrame","child","contentWindow","clickHandler","receive","fieldFrame","resizeIFrame","Defaults","placeholder","styleString","cardNumberFieldFrame","onError","fieldsLength","baseUrl","fieldOptions","events","classes","Util","tokenizationType","typeByTrack","properties","destination","property","errorMessage","collection","params","throwError","payment_form","getFields","getCardType","addField","form","childElementCount","element","HeartlandTokenService","requestData","jsonp","buildRequest","_this","deserializeResponseData","JsonpRequest","serializeRequestData","getParams","encryptedcard","lastfour","last_four","card_type","exp_month","exp_year","parent","applyOptions","getUrlByEnv","addFormHandler","configureIframe","HPS","token_value","loadHandler","receiveMessageHandlerAddedHandler","frameHandleWith","configureFieldIframe","errorMsg","lineNumber","column","errorObj","configureField","monitorFieldEvents","elementtext","elementstyle","dispose","cardExpiration","removeHandler","Formatter","Validator"],"mappings":"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"}