{"version":3,"file":null,"sources":["../src/DOM.ts","../src/vars/cardTypes.ts","../src/Formatter/CardNumber.ts","../src/Formatter/Expiration.ts","../src/Validator/CardNumber.ts","../src/Validator/Cvv.ts","../src/Validator/Expiration.ts","../src/formatter/Expiration.ts","../src/Events.ts","../src/Card.ts","../src/vars/urls.ts","../src/Styles.ts","../src/Util.ts","../src/Ajax.ts","../src/Formatter/index.ts","../src/vars/defaults.ts","../src/vars/fields.ts","../src/Messages.ts","../src/Frames.ts","../src/HPS.ts","../src/Validator/index.ts","../src/index.ts"],"sourcesContent":["import {HPS} from \"./HPS\";\n\n/**\n * @namespace Heartland.DOM\n */\nexport class DOM {\n  /**\n   * Heartland.DOM.configureField\n   *\n   * Configures an input field in a single field iFrame.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static configureField(hps: HPS) {\n    document.getElementById('heartland-field').setAttribute('name', hps.field);\n  }\n\n  /**\n   * Heartland.DOM.makeFrame\n   *\n   * Creates a single iFrame element with the appropriate defaults.\n   *\n   * @param {string} name\n   * @returns {HTMLIframeElement}\n   */\n  public static makeFrame(name: string) {\n    var frame = document.createElement('iframe');\n    frame.id = 'heartland-frame-' + name;\n    frame.name = name;\n    frame.style.border = '0';\n    frame.frameBorder = '0';\n    frame.scrolling = 'no';\n    return frame;\n  }\n\n  /**\n   * Heartland.DOM.addField\n   *\n   * Adds a DOM `input` node to `formParent` with type `fieldType`, name\n   * `fieldName`, and value `fieldValue`.\n   *\n   * @param {string} formParent\n   * @param {string} fieldType\n   * @param {string} fieldName\n   * @param {string} fieldValue\n   */\n  public static addField(formParent: string, fieldType: string, fieldName: string, fieldValue: string) {\n    var input = document.createElement('input');\n\n    input.setAttribute('type', fieldType);\n    input.setAttribute('name', fieldName);\n    input.setAttribute('value', fieldValue);\n\n    document.getElementById(formParent).appendChild(input);\n  }\n\n  /**\n   * Heartland.DOM.setStyle\n   *\n   * Sets an element's style attribute within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {string} htmlstyle\n   */\n  public static setStyle(elementid: string, htmlstyle: string) {\n    var el = document.getElementById(elementid);\n    if (el) {\n      el.setAttribute('style', this.encodeEntities(htmlstyle));\n    }\n  }\n\n  /**\n   * Heartland.DOM.appendStyle\n   *\n   * Appends an element's style attribute within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {String} htmlstyle\n   */\n  public static appendStyle(elementid: string, htmlstyle: string) {\n    var el = document.getElementById(elementid);\n    if (el) {\n      var currstyle = el.getAttribute('style');\n      var newstyle = (currstyle ? currstyle : '') + htmlstyle;\n      el.setAttribute('style', this.encodeEntities(newstyle));\n    }\n  }\n\n  /**\n   * Heartland.DOM.setText\n   *\n   * Sets an element's inner text within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {string} text\n   */\n  public static setText(elementid: string, text: string) {\n    var el = document.getElementById(elementid);\n    if (el) {\n      el.textContent = this.encodeEntities(text);\n    }\n  }\n\n  /**\n   * Heartland.DOM.setPlaceholder\n   *\n   * Sets an element's placeholder attribute within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {string} text\n   */\n  public static setPlaceholder(elementid: string, text: string) {\n    var el = document.getElementById(elementid);\n    if (el) {\n      if (text === '•••• •••• •••• ••••' || text === '••••' || text === '•••'\n        || text === '···· ···· ···· ····') {\n        el.setAttribute('placeholder', text);\n      } else {\n        el.setAttribute('placeholder', this.encodeEntities(text));\n      }\n    }\n  }\n\n  /**\n   * Heartland.DOM.resizeFrame\n   *\n   * Alerts a parent window to resize the iframe.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static resizeFrame(hps: HPS) {\n    var docHeight = document.body.offsetHeight + 1; // off by one error\n    hps.Messages.post({ action: 'resize', height: docHeight }, 'parent');\n  }\n\n  /**\n   * Heartland.DOM.setFieldData\n   *\n   * Receives a field value from another frame prior to the tokenization process.\n   *\n   * @param {string} elementid\n   * @param {string} value\n   */\n  public static setFieldData(elementid: string, value: string) {\n    var el = document.getElementById(elementid);\n    if (!el && document.getElementById('heartland-field')) {\n      el = document.createElement('input');\n      el.setAttribute('id', this.encodeEntities(elementid));\n      el.setAttribute('type', 'hidden');\n      document.getElementById('heartland-field-wrapper').appendChild(el);\n    }\n\n    if (el) {\n      el.setAttribute('value', this.encodeEntities(value));\n    }\n  }\n\n  /**\n   * Heartland.DOM.getFieldData\n   *\n   * Retrieves a field value for another frame prior to the tokenization process.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} elementid\n   */\n  public static getFieldData(hps: HPS, elementid: string) {\n    var el: HTMLInputElement = <HTMLInputElement>document.getElementById(elementid);\n    if (el) {\n      hps.Messages.post({ action: 'passData', value: el.value }, 'parent');\n    }\n  }\n\n  /**\n   * Heartland.DOM.addStylesheet\n   *\n   * Creates a `style` node in the DOM with the given `css`.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} elementid\n   */\n  public static addStylesheet(css: string) {\n    var el = document.createElement('style');\n    var elements = document.getElementsByTagName('head');\n    el.type = 'text/css';\n    el.appendChild(document.createTextNode(css));\n    if (elements && elements[0]) {\n      elements[0].appendChild(el);\n    }\n  }\n\n  /**\n   * Heartland.DOM.json2css\n   *\n   * Converts a JSON node to text representing CSS.\n   *\n   * @param {string} json\n   * @returns {string}\n   */\n  public static json2css(json: Object): string {\n    var css = '';\n    var attributes: string[];\n    var children: Object[];\n    var i: number, j: number;\n    var key: any, value: any;\n\n    if (attributes = this.jsonAttributes(json)) {\n      var attributesLength = attributes.length;\n      for (i = 0; i < attributesLength; i++) {\n        key = attributes[i];\n        value = (<any>json)[key];\n        if (this.isArray(value)) {\n          var arrLength = value.length;\n          for (j = 0; j < arrLength; j++) {\n            css += key + ':' + value[j] + ';';\n          }\n        } else {\n          css += key + ':' + value + ';';\n        }\n      }\n    }\n\n    if (children = this.jsonChildren(json)) {\n      var childrenLength = children.length;\n      for (i = 0; i < childrenLength; i++) {\n        key = children[i];\n        value = (<any>json)[key];\n        css += key + '{' + this.json2css(value) + '}';\n      }\n    }\n\n    return css;\n  }\n\n  /**\n   * Heartland.DOM.setFocus\n   *\n   * Sets the focus on an iframe's field.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} elementid\n   */\n  public static setFocus() {\n    var el = document.getElementById('heartland-field');\n    if (el) {\n      el.focus();\n    }\n  }\n\n  /***********\n   * Helpers *\n   ***********/\n\n  /**\n   * Escapes all potentially dangerous characters, so that the\n   * resulting string can be safely inserted into attribute or\n   * element text.\n   *\n   * @param value\n   * @returns {string} escaped text\n   */\n  private static encodeEntities(value: string) {\n    return value.\n      replace(/&/g, '&amp;').\n      replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, function (v) {\n        var hi = v.charCodeAt(0);\n        var low = v.charCodeAt(1);\n        return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\n      }).\n      replace(/([^\\#-~| |!])/g, function (v) {\n        return '&#' + v.charCodeAt(0) + ';';\n      }).\n      replace(/</g, '&lt;').\n      replace(/>/g, '&gt;');\n  }\n\n  private static isArray(obj: any): boolean {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n  }\n\n  private static jsonAttributes(json: Object): string[] {\n    var set: string[] = [];\n    var i: string;\n    for (i in json) {\n      if (json.hasOwnProperty(i)\n        && (typeof (<any>json)[i] === 'string' || this.isArray((<any>json)[i]))) {\n        set.push(i);\n      }\n    }\n    return set;\n  }\n\n  private static jsonChildren(json: Object): Object[] {\n    var set: Object[] = [];\n    var i: string;\n    for (i in json) {\n      if (json.hasOwnProperty(i)\n        && (Object.prototype.toString.call((<any>json)[i]) === '[object Object]')) {\n        set.push(i);\n      }\n    }\n    return set;\n  }\n}\n","import {CardType} from \"../types/CardType\";\n\nexport var cardTypes: CardType[] = [\n  {\n    code: 'visa',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^4/\n  },\n  {\n    code: 'mastercard',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^(5[1-5]|2[2-7])/\n  },\n  {\n    code: 'amex',\n    format: /(\\d{1,4})(\\d{1,6})?(\\d{1,5})?/,\n    length: 15,\n    regex: /^3[47]/\n  },\n  {\n    code: 'diners',\n    format: /(\\d{1,4})(\\d{1,6})?(\\d{1,4})?/,\n    length: 14,\n    regex: /^3[0689]/\n  },\n  {\n    code: 'discover',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^6([045]|22)/\n  },\n  {\n    code: 'jcb',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^35/\n  }\n];\n","import {CardType} from \"../types/CardType\";\nimport {Formatter} from \"../types/Formatter\";\nimport {Card} from \"../Card\";\n\nexport class CardNumber implements Formatter {\n  format(number: string): string {\n    var type: CardType;\n    var matches: string[];\n\n    number = number.replace(/\\D/g, '');\n    type = Card.typeByNumber(number);\n\n    if (!type) { return number; }\n\n    matches = number.match(type.format);\n\n    if (!matches) { return number; }\n\n    if (!type.format.global) {\n      matches.shift();\n    }\n    return matches.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n}\n","import {Formatter} from \"../types/Formatter\";\n\nexport class Expiration implements Formatter {\n  format(exp: string, final = false): string {\n    var pat = /^\\D*(\\d{1,2})(\\D+)?(\\d{1,4})?/;\n    var groups = exp.match(pat);\n    var month: string;\n    var del: string;\n    var year: string;\n\n    if (!groups) {\n      return '';\n    }\n\n    month = groups[1] || '';\n    del = groups[2] || '';\n    year = groups[3] || '';\n\n    if (year.length > 0) {\n      del = ' / ';\n    } else if (month.length === 2 || del.length > 0) {\n      del = ' / ';\n    } else if (month.length === 1 && (month !== '0' && month !== '1')) {\n      del = ' / ';\n    }\n\n    if (month.length === 1 && del !== '') {\n      month = '0' + month;\n    }\n\n    if (final && year.length === 2) {\n      year = (new Date).getFullYear().toString().slice(0, 2) + year;\n    }\n\n    return month + del + year;\n  }\n}\n","import {CardType} from \"../types/CardType\";\nimport {Validator} from \"../types/Validator\";\nimport {Card} from \"../Card\";\n\nexport class CardNumber implements Validator {\n  validate(number: string): boolean {\n    var type: CardType;\n\n    if (!number) {\n      return false;\n    }\n\n    number = number.replace(/[-\\s]/g, '');\n    type = Card.typeByNumber(number);\n\n    if (!type) {\n      return false;\n    }\n    return Card.luhnCheck(number)\n      && number.length === type.length;\n  }\n}\n","import {Validator} from \"../types/Validator\";\n\nexport class Cvv implements Validator {\n  validate(cvv: string): boolean {\n    if (!cvv) {\n      return false;\n    }\n\n    cvv = cvv.replace(/^\\s+|\\s+$/g, '');\n\n    if (!/^\\d+$/.test(cvv)) {\n      return false;\n    }\n    return 3 <= cvv.length && cvv.length <= 4;\n  }\n}\n","import {Validator} from \"../types/Validator\";\n\nexport class Expiration implements Validator {\n  validate(exp: string): boolean {\n    var month: number;\n    var year: number;\n    var split: string[];\n    var m: string, y: string;\n\n    if (!exp) {\n      return false;\n    }\n\n    split = exp.split('/');\n    [m, y] = split;\n\n    if (!m || !y) {\n      return false;\n    }\n\n    m = m.replace(/^\\s+|\\s+$/g, '');\n    y = y.replace(/^\\s+|\\s+$/g, '');\n\n    if (!/^\\d+$/.test(m)) {\n      return false;\n    }\n    if (!/^\\d+$/.test(y)) {\n      return false;\n    }\n\n    if (y.length === 2) {\n      y = (new Date).getFullYear().toString().slice(0, 2) + y;\n    }\n\n    month = parseInt(m, 10);\n    year = parseInt(y, 10);\n\n    if (!(1 <= month && month <= 12)) {\n      return false;\n    }\n\n    // creates date as 1 day past end of\n    // expiration month since JS months\n    // are 0 indexed\n    return (new Date(year, month, 1)) > (new Date);\n  }\n}\n","import {Formatter} from \"../types/Formatter\";\n\nexport class Expiration implements Formatter {\n  format(exp: string, final = false): string {\n    var pat = /^\\D*(\\d{1,2})(\\D+)?(\\d{1,4})?/;\n    var groups = exp.match(pat);\n    var month: string;\n    var del: string;\n    var year: string;\n\n    if (!groups) {\n      return '';\n    }\n\n    month = groups[1] || '';\n    del = groups[2] || '';\n    year = groups[3] || '';\n\n    if (year.length > 0) {\n      del = ' / ';\n    } else if (month.length === 2 || del.length > 0) {\n      del = ' / ';\n    } else if (month.length === 1 && (month !== '0' && month !== '1')) {\n      del = ' / ';\n    }\n\n    if (month.length === 1 && del !== '') {\n      month = '0' + month;\n    }\n\n    if (final && year.length === 2) {\n      year = (new Date).getFullYear().toString().slice(0, 2) + year;\n    }\n\n    return month + del + year;\n  }\n}\n","import {DOM} from \"./DOM\";\nimport {HPS} from \"./HPS\";\nimport {CardData} from \"./types/CardData\";\nimport {TokenizationResponse} from \"./types/TokenizationResponse\";\nimport {Expiration as ExpirationFormatter} from \"./formatter/Expiration\";\n\nclass Ev {\n  public static listen(node: EventTarget, eventName: string, callback: EventListener) {\n    if (document.addEventListener) {\n      node.addEventListener(eventName, callback, false);\n    } else {\n      if (node === document) {\n        (<any>document.documentElement).attachEvent('onpropertychange', function (e: Event) {\n          if ((<any>e).propertyName === eventName) {\n            callback(e);\n          }\n        });\n      } else {\n        (<any>node).attachEvent('on' + eventName, callback);\n      }\n    }\n  }\n  public static trigger(node: EventTarget, eventName: string) {\n    if (document.createEvent) {\n      var event = document.createEvent('Event');\n      event.initEvent(eventName, true, true);\n      node.dispatchEvent(event);\n    } else {\n      (<any>document.documentElement)[eventName]++;\n    }\n  }\n  public static ignore(eventName: string, callback: EventListener) {\n    if (document.removeEventListener) {\n      document.removeEventListener(eventName, callback, false);\n    } else {\n      (<any>document.documentElement).detachEvent('onpropertychange', function (e: Event) {\n        if ((<any>e).propertyName === eventName) {\n          callback(e);\n        }\n      });\n    }\n  }\n}\n\n/**\n * @namespace Heartland.Events\n */\nexport class Events {\n  /**\n   * Heartland.Events.addHandler\n   *\n   * Adds an `event` handler for a given `target` element.\n   *\n   * @param {string | EventTarget} target\n   * @param {string} event\n   * @param {EventListener} callback\n   */\n  public static addHandler(target: string | EventTarget, event: string, callback: EventListener) {\n    var node: EventTarget;\n    if (typeof target === 'string') {\n      node = document.getElementById(<string>target);\n    } else {\n      node = target;\n    }\n\n    if (document.addEventListener) {\n      node.addEventListener(event, callback, false);\n    } else {\n      Ev.listen(node, event, callback);\n    }\n  }\n\n  /**\n   * Heartland.Events.removeHandler\n   *\n   * Removes an `event` handler for a given `target` element.\n   *\n   * @param {string | EventTarget} target\n   * @param {string} event\n   * @param {EventListener} callback\n   */\n  public static removeHandler(target: string | EventTarget, event: string, callback: EventListener) {\n    var node: EventTarget;\n    if (typeof target === 'string') {\n      node = document.getElementById(<string>target);\n    } else {\n      node = target;\n    }\n\n    if (document.removeEventListener) {\n      node.removeEventListener(event, callback, false);\n    } else {\n      Ev.ignore(event, callback);\n    }\n  }\n\n  /**\n   * Heartland.Events.trigger\n   *\n   * Fires off an `event` for a given `target` element.\n   *\n   * @param {string} name\n   * @param {any} target\n   * @param {any} data [optional]\n   */\n  public static trigger(name: string, target: any, data?: any, bubble = false) {\n    var event: any;\n\n    if (document.createEvent) {\n      event = document.createEvent('Event');\n      event.initEvent(name, true, true);\n      target.dispatchEvent(event);\n    } else {\n      Ev.trigger(target, name);\n    }\n  }\n\n  /**\n   * Heartland.Events.frameHandleWith\n   *\n   * Wraps `hps` state in a closure to provide a `Heartland.Messages.receive`\n   * callback handler for iFrame children.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static frameHandleWith(hps: HPS): (m: any) => void {\n    return function (m) {\n      var data = JSON.parse(m.data);\n      switch (data.action) {\n        case 'tokenize':\n          if (data.accumulateData) {\n            hps.Messages.post(\n              {\n                action: 'accumulateData'\n              },\n              'parent'\n            );\n            var el = document.createElement('input');\n            el.id = 'publicKey';\n            el.type = 'hidden';\n            el.value = data.message;\n            document\n              .getElementById('heartland-field-wrapper')\n              .appendChild(el);\n          } else {\n            this.tokenizeIframe(hps, data.message);\n          }\n          break;\n        case 'setStyle':\n          DOM.setStyle(data.id, data.style);\n          DOM.resizeFrame(hps);\n          break;\n        case 'appendStyle':\n          DOM.appendStyle(data.id, data.style);\n          DOM.resizeFrame(hps);\n          break;\n        case 'setText':\n          DOM.setText(data.id, data.text);\n          DOM.resizeFrame(hps);\n          break;\n        case 'setPlaceholder':\n          DOM.setPlaceholder(data.id, data.text);\n          break;\n        case 'setFieldData':\n          DOM.setFieldData(data.id, data.value);\n          if (document.getElementById('heartland-field') &&\n            document.getElementById('cardCvv') &&\n            document.getElementById('cardExpiration')) {\n            var pkey = document.getElementById('publicKey');\n            this.tokenizeIframe(hps, (pkey ? pkey.getAttribute('value') : ''));\n          }\n          break;\n        case 'getFieldData':\n          DOM.getFieldData(hps, data.id);\n          break;\n        case 'addStylesheet':\n          DOM.addStylesheet(data.data);\n          DOM.resizeFrame(hps);\n          break;\n        case 'setFocus':\n          DOM.setFocus();\n          break;\n      }\n    };\n  }\n\n  /**\n   * tokenizeIframe\n   *\n   * Tokenizes card data. Used in iframe integrations to tokenize on Heartland's\n   * servers.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} publicKey\n   */\n  public static tokenizeIframe(hps: HPS, publicKey: string) {\n    var card: CardData = {};\n    var numberElement = <HTMLInputElement>(document.getElementById('heartland-field')\n      || document.getElementById('heartland-card-number'));\n    var cvvElement = <HTMLInputElement>(document.getElementById('cardCvv')\n      || document.getElementById('heartland-cvv'));\n    var expElement = document.getElementById('cardExpiration');\n    var tokenResponse = (action: string) => {\n      return (response: TokenizationResponse) => {\n        hps.Messages.post({ action: action, response: response }, 'parent');\n        if (cvvElement) {\n          if (cvvElement.parentNode) {\n            cvvElement.parentNode.removeChild(cvvElement);\n          } else {\n            cvvElement.remove();\n          }\n        }\n        if (expElement) {\n          if (expElement.parentNode) {\n            expElement.parentNode.removeChild(expElement);\n          } else {\n            expElement.remove();\n          }\n        }\n      };\n    };\n\n    card.number = numberElement ? numberElement.value : '';\n    card.cvv = cvvElement ? cvvElement.value : '';\n    card.exp = expElement;\n\n    if (card.exp) {\n      var formatter = new ExpirationFormatter();\n      var cardExpSplit = formatter.format((<HTMLInputElement>card.exp).value, true).split('/');\n      card.expMonth = cardExpSplit[0];\n      card.expYear = cardExpSplit[1];\n      card.exp = undefined;\n    } else {\n      card.expMonth = (<HTMLInputElement>document.getElementById('heartland-expiration-month')).value;\n      card.expYear = (<HTMLInputElement>document.getElementById('heartland-expiration-year')).value;\n    }\n\n    hps.tokenize({\n      cardCvv: card.cvv ? card.cvv : '',\n      cardExpMonth: card.expMonth ? card.expMonth : '',\n      cardExpYear: card.expYear ? card.expYear : '',\n      cardNumber: card.number ? card.number : '',\n      error: tokenResponse('onTokenError'),\n      publicKey: publicKey ? publicKey : '',\n      success: tokenResponse('onTokenSuccess'),\n      type: 'pan'\n    });\n  }\n}\n\n","import {CardType} from \"./types/CardType\";\nimport {cardTypes} from \"./vars/cardTypes\";\nimport {CardNumber as CardNumberFormatter} from \"./Formatter/CardNumber\";\nimport {Expiration as ExpirationFormatter} from \"./Formatter/Expiration\";\nimport {CardNumber as CardNumberValidator} from \"./Validator/CardNumber\";\nimport {Cvv as CvvValidator} from \"./Validator/Cvv\";\nimport {Expiration as ExpirationValidator} from \"./Validator/Expiration\";\n\nimport {Events} from \"./Events\";\n\n/**\n * @namespace Heartland.Card\n */\nexport class Card {\n  /**\n   * Heartland.Card.typeByNumber\n   *\n   * Helper function to grab the CardType for a given card number.\n   *\n   * @param {string} number - The card number\n   * @returns {Heartland.CardType}\n   */\n  public static typeByNumber(number: string): CardType {\n    var cardType: CardType;\n    var i: any;\n\n    if (!number) { return null; }\n    if (number.replace(/^\\s+|\\s+$/gm, '').length < 4) { return null; }\n\n    for (i in cardTypes) {\n      cardType = cardTypes[i];\n      if (cardType && cardType.regex && cardType.regex.test(number)) {\n        break;\n      }\n    }\n\n    return cardType;\n  }\n\n  /**\n   * Heartland.Card.typeByTrack\n   *\n   * @param {string} data - track data\n   * @param {boolean} isEncrypted - (default: false)\n   * @param {string} trackNumber\n   *\n   * @returns CardType\n   */\n  public static typeByTrack(data: string, isEncrypted = false, trackNumber?: string) {\n    var number: string;\n\n    if (isEncrypted && trackNumber && trackNumber === '02') {\n      number = data.split('=')[0];\n    } else {\n      var temp = data.split('%');\n      if (temp[1]) {\n        temp = temp[1].split('^');\n        if (temp[0]) {\n          number = temp[0].toString().substr(1);\n        }\n      }\n    }\n\n    return this.typeByNumber(number);\n  }\n\n  /**\n   * Heartland.Card.luhnCheck\n   *\n   * Runs a mod 10 check on a given card number.\n   *\n   * @param {string} number - The card number\n   * @returns {boolean}\n   */\n  public static luhnCheck(number: string): boolean {\n    var odd = true;\n    var sum = 0;\n    var digits: string[];\n    var i = 0;\n    var length = 0;\n    var digit: number;\n\n    if (!number) {\n      return false;\n    }\n\n    digits = number.split('').reverse();\n    length = digits.length;\n\n    for (i; i < length; i++) {\n      digit = parseInt(digits[i], 10);\n      if (odd = !odd) {\n        digit *= 2;\n      }\n      if (digit > 9) {\n        digit -= 9;\n      }\n      sum += digit;\n    }\n\n    return sum % 10 === 0;\n  }\n\n  /**\n   * Heartland.Card.addType\n   *\n   * Adds a class to the target element with the card type\n   * inferred from the target's current value.\n   *\n   * @param {Event} e\n   */\n  public static addType(e: Event) {\n    var target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    var type = this.typeByNumber(target.value);\n    var classList = target.className.split(' ');\n    var length = classList.length;\n    var i = 0;\n    var c = '';\n\n    for (i; i < length; i++) {\n      c = classList[i];\n      if (c && c.indexOf('card-type-') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if (type) {\n      classList.push('card-type-' + type.code);\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.formatNumber\n   *\n   * Formats a target element's value based on the\n   * inferred card type's formatting regex.\n   *\n   * @param {Event} e\n   */\n  public static formatNumber(e: Event) {\n    var target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    var value = target.value;\n\n    if (value.length === 0) { return; }\n\n    var formatted = (new CardNumberFormatter).format(value);\n    target.value = formatted;\n\n    if (!target.setSelectionRange) { return; }\n\n    var cursor = target.selectionStart;\n\n    // copy and paste, space inserted on formatter\n    if (value.length < formatted.length) {\n      cursor += formatted.length - value.length;\n    }\n\n    // check if before new inserted digit is a space\n    if (value.charAt(cursor) === ' ' &&\n      formatted.charAt(cursor - 1) === ' ') {\n      cursor += 1;\n    }\n\n    target.setSelectionRange(cursor, cursor);\n  }\n\n  /**\n   * Heartland.Card.formatExpiration\n   *\n   * Formats a target element's value.\n   *\n   * @param {KeyboardEvent} e\n   */\n  public static formatExpiration(e: KeyboardEvent) {\n    var target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    var value = target.value;\n    // allow: delete, backspace\n    if ([46, 8].indexOf(e.keyCode) !== -1 ||\n      // allow: home, end, left, right\n      (e.keyCode >= 35 && e.keyCode <= 39)) {\n      return;\n    }\n    value = (new ExpirationFormatter).format(value, e.type === 'blur');\n    target.value = value;\n  }\n\n  /**\n   * Heartland.Card.restrictLength\n   *\n   * Restricts input in a target element to a\n   * certain length data.\n   *\n   * @param {number} length\n   *\n   * @returns {(e: KeyboardEvent) => ()}\n   */\n  public static restrictLength(length: number) {\n    return function (e: KeyboardEvent) {\n      var target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n      var value = target.value;\n      // allow: backspace, delete, tab, escape and enter\n      if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||\n        // allow: Ctrl+A\n        (e.keyCode === 65 && e.ctrlKey === true) ||\n        // allow: home, end, left, right\n        (e.keyCode >= 35 && e.keyCode <= 39)) {\n        // let it happen, don't do anything\n        return;\n      }\n      if (value.length >= length) {\n        e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n      }\n    };\n  }\n\n  /**\n   * Heartland.Card.restrictNumeric\n   *\n   * Restricts input in a target element to only\n   * numeric data.\n   *\n   * @param {KeyboardEvent} e\n   */\n  public static restrictNumeric(e: KeyboardEvent) {\n    // allow: backspace, delete, tab, escape and enter\n    if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||\n      // allow: Ctrl+A\n      (e.keyCode === 65 && e.ctrlKey === true) ||\n      // allow: home, end, left, right\n      (e.keyCode >= 35 && e.keyCode <= 39)) {\n      // let it happen, don't do anything\n      return;\n    }\n    // ensure that it is a number and stop the keypress\n    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {\n      e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n    }\n  }\n\n  /**\n   * Heartland.Card.deleteProperly\n   *\n   * Places cursor on the correct position to\n   * let the browser delete the digit instead\n   * of the space.\n   *\n   * @param {KeyboardEvent} e\n   */\n  public static deleteProperly(e: KeyboardEvent) {\n    var target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    var value = target.value;\n\n    if (!target.setSelectionRange) { return; }\n\n    var cursor = target.selectionStart;\n\n    // allow: delete, backspace\n    if ([46, 8].indexOf(e.keyCode) !== -1 &&\n      // if space to be deleted\n      (value.charAt(cursor - 1) === ' ')) {\n      // placing cursor before space to delete digit instead\n      target.setSelectionRange(cursor - 1, cursor - 1);\n    }\n  }\n\n  /**\n   * Heartland.Card.validateNumber\n   *\n   * Validates a target element's value based on the\n   * inferred card type's validation regex. Adds a\n   * class to the target element to note `valid` or\n   * `invalid`.\n   *\n   * @param {Event} e\n   */\n  public static validateNumber(e: Event) {\n    var target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    var value = target.value;\n    var classList = target.className.split(' ');\n    var length = classList.length;\n    var c = '';\n\n    for (var i = 0; i < length; i++) {\n      c = classList[i];\n      if (c.indexOf('valid') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if ((new CardNumberValidator).validate(value)) {\n      classList.push('valid');\n    } else {\n      classList.push('invalid');\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.validateCvv\n   *\n   * Validates a target element's value based on the\n   * possible CVV lengths. Adds a class to the target\n   * element to note `valid` or `invalid`.\n   *\n   * @param {Event} e\n   */\n  public static validateCvv(e: Event) {\n    var target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    var value = target.value;\n    var classList = target.className.split(' ');\n    var length = classList.length;\n    var c = '';\n\n    for (var i = 0; i < length; i++) {\n      c = classList[i];\n      if (c.indexOf('valid') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if ((new CvvValidator).validate(value)) {\n      classList.push('valid');\n    } else {\n      classList.push('invalid');\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.validateExpiration\n   *\n   * Validates a target element's value based on the\n   * current date. Adds a class to the target element\n   * to note `valid` or `invalid`.\n   *\n   * @param {Event} e\n   */\n  public static validateExpiration(e: Event) {\n    var target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    var value = target.value;\n    var classList = target.className.split(' ');\n    var length = classList.length;\n    var c = '';\n\n    for (var i = 0; i < length; i++) {\n      c = classList[i];\n      if (c.indexOf('valid') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if ((new ExpirationValidator).validate(value)) {\n      classList.push('valid');\n    } else {\n      classList.push('invalid');\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.attachNumberEvents\n   *\n   * @param {string} selector\n   */\n  public static attachNumberEvents(selector: string) {\n    Events.addHandler(document.querySelector(selector), 'keydown', this.restrictNumeric);\n    Events.addHandler(document.querySelector(selector), 'keydown', this.restrictLength(19));\n    Events.addHandler(document.querySelector(selector), 'keydown', this.deleteProperly);\n    Events.addHandler(document.querySelector(selector), 'input', this.formatNumber);\n    Events.addHandler(document.querySelector(selector), 'input', this.validateNumber);\n    Events.addHandler(document.querySelector(selector), 'input', this.addType);\n  }\n\n  /**\n   * Heartland.Card.attachExpirationEvents\n   *\n   * @param {string} selector\n   */\n  public static attachExpirationEvents(selector: string) {\n    Events.addHandler(document.querySelector(selector), 'keydown', this.restrictNumeric);\n    Events.addHandler(document.querySelector(selector), 'keydown', this.restrictLength(9));\n    Events.addHandler(document.querySelector(selector), 'keyup', this.formatExpiration);\n    Events.addHandler(document.querySelector(selector), 'blur', this.formatExpiration);\n    Events.addHandler(document.querySelector(selector), 'input', this.validateExpiration);\n    Events.addHandler(document.querySelector(selector), 'blur', this.validateExpiration);\n  }\n\n  /**\n   * Heartland.Card.attachCvvEvents\n   *\n   * @param {string} selector\n   */\n  public static attachCvvEvents(selector: string) {\n    Events.addHandler(document.querySelector(selector), 'keydown', this.restrictNumeric);\n    Events.addHandler(document.querySelector(selector), 'keydown', this.restrictLength(4));\n    Events.addHandler(document.querySelector(selector), 'input', this.validateCvv);\n  }\n}\n\nif (!Array.prototype.indexOf) {\n  Array.prototype.indexOf = function (obj, start) {\n    for (var i = (start || 0), j = this.length; i < j; i++) {\n      if (this[i] === obj) { return i; }\n    }\n    return -1;\n  };\n}\n","export var urls = {\n  CERT: 'https://cert.api2.heartlandportico.com/Hps.Exchange.PosGateway.Hpf.v1/api/token',\n  PROD: 'https://api.heartlandportico.com/SecureSubmit.v1/api/token',\n  iframeCERT: 'https://hps.github.io/token/2.1/',\n  iframePROD: 'https://api.heartlandportico.com/SecureSubmit.v1/token/2.1/'\n};\n","import {HPS} from \"./HPS\";\n\n/**\n * @namespace Heartland.Styles\n */\nexport module Styles {\n  /**\n   * Heartland.Styles.Defaults\n   *\n   * Collection of helper functions for applying default styles to a child\n   * window's fields. Serves as an example of these methods' use in merchant\n   * modifications. Each function expects a `Heartland.HPS` object to be passed\n   * as an argument.\n   */\n  export var Defaults = {\n    body: function (hps: HPS) {\n      hps.setStyle('heartland-body',\n        'margin: 0;' +\n        'font-family: Arial, \\'Helvetica Neue\\', Helvetica, sans-serif;' +\n        'color: #666;'\n      );\n    },\n    cvv: function (hps: HPS) {\n      hps.appendStyle('heartland-cvv', 'width: 110px;');\n    },\n    cvvContainer: function (hps: HPS) {\n      hps.setStyle('heartland-cvv-container',\n        'width: 110px;' +\n        'display: inline-block;' +\n        'float: left;'\n      );\n    },\n    fieldset: function (hps: HPS) {\n      hps.setStyle('heartland-expiration-date-container',\n        'border: 0;' +\n        'margin: 0 25px 0px 1px;' +\n        'padding: 0;' +\n        'width: 173px;' +\n        'display: inline-block;' +\n        'float:  left;'\n      );\n    },\n    inputsAndSelects: function (hps: HPS) {\n      var ids = [\n        'heartland-card-number',\n        'heartland-expiration-month',\n        'heartland-expiration-year',\n        'heartland-cvv'\n      ];\n      var i = 0, length = ids.length;\n      for (i; i < length; i++) {\n        hps.setStyle(ids[i],\n          'width: 309px;' +\n          'padding: 5px;' +\n          'font-size: 14px;' +\n          'margin: 3px 0px 15px 0px;' +\n          'border: 1px #ccc solid;' +\n          /* IE10 Consumer Preview */\n          'background-image: -ms-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* Mozilla Firefox */\n          'background-image: -moz-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* Opera */\n          'background-image: -o-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* Webkit (Safari/Chrome 10) */\n          'background-image: -webkit-gradient(linear, left bottom, left top, color-stop(0, #F7F7F7), color-stop(1, #EFEFEF));' +\n          /* Webkit (Chrome 11+) */\n          'background-image: -webkit-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* W3C Markup, IE10 Release Preview */\n          'background-image: linear-gradient(to top, #F7F7F7 0%, #EFEFEF 100%);'\n        );\n      }\n    },\n    labelsAndLegend: function (hps: HPS) {\n      var ids = [\n        'heartland-card-number-label',\n        'heartland-expiration-date-legend',\n        'heartland-expiration-month-label',\n        'heartland-expiration-year-label',\n        'heartland-cvv-label'\n      ];\n      var i = 0, length = ids.length;\n      for (i; i < length; i++) {\n        hps.setStyle(ids[i],\n          'font-size: 13px;' +\n          'text-transform: uppercase;' +\n          'font-weight: bold;' +\n          'display: block;' +\n          'width: 100%;' +\n          'clear: both;'\n        );\n      }\n    },\n    selectLabels: function (hps: HPS) {\n      var ids = ['heartland-expiration-month-label', 'heartland-expiration-year-label'];\n      var i = 0, length = ids.length;\n      for (i; i < length; i++) {\n        hps.setStyle(ids[i],\n          'position:absolute;' +\n          'width:1px;' +\n          'height:1px;' +\n          'padding:0;' +\n          'margin:-1px;' +\n          'overflow:hidden;' +\n          'clip:rect(0,0,0,0);' +\n          'border:0;'\n        );\n      }\n    },\n    selects: function (hps: HPS) {\n      var ids = ['heartland-expiration-month', 'heartland-expiration-year'];\n      var i = 0, length = ids.length;\n      for (i; i < length; i++) {\n        hps.appendStyle(ids[i],\n          'border: 0;' +\n          'outline: 1px solid #ccc;' +\n          'height: 28px;' +\n          'width: 80px;' +\n          '-webkit-appearance: none;' +\n          '-moz-appearance: none;' +\n          '-webkit-border-radius: 0px;' +\n          /* tslint:disable:max-line-length */\n          'background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzA5MTZFN0RFMDY2MTFFNEIyODZFMURFRTA3REUxMjciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzA5MTZFN0VFMDY2MTFFNEIyODZFMURFRTA3REUxMjciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDMDkxNkU3QkUwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDMDkxNkU3Q0UwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvMrdUAAAABiSURBVHjaYkxLS3vNwMAgwoAfvGUCEjkMhEE285kzZ65u2bLlJ5DjgkNRxUwgYPz//z+Yl56ePhNIpaEpAqnJADGYkASzgHgnEn8HyEoYB24i1FReILUPynUEmvYFJgcQYACYah+uDhpKGAAAAABJRU5ErkJggg==);' +\n          /* tslint:enable:max-line-length */\n          'background-position: 65px 12px;' +\n          'background-repeat: no-repeat;' +\n          'background-color:  #F7F7F7;' +\n          'float: left;' +\n          'margin-right: 6px'\n        );\n      }\n    }\n  };\n}\n","import {Ajax} from \"./Ajax\";\nimport {Card} from \"./Card\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport {CardData} from \"./types/CardData\";\nimport {CardType} from \"./types/CardType\";\nimport {Options} from \"./types/Options\";\nimport {TokenizationResponse} from \"./types/TokenizationResponse\";\nimport {urls} from \"./vars/urls\";\n\n/**\n * @namespace Heartland.Util\n */\nexport class Util {\n  /**\n   * Heartland.Util.getCardType\n   *\n   * Parses a credit card number to obtain the card type/brand.\n   *\n   * @param {string} tokenizationType\n   * @param {Heartland.Options} options\n   */\n  public static getCardType(tokenizationType: string, options: Options) {\n    var cardType: CardType;\n    var data = '';\n    var type = 'unknown';\n\n    switch (tokenizationType) {\n      case 'swipe':\n        data = options.track;\n        cardType = Card.typeByTrack(data);\n        break;\n      case 'encrypted':\n        data = options.track;\n        cardType = Card.typeByTrack(data, true, options.trackNumber);\n        break;\n      default:\n        data = options.cardNumber;\n        cardType = Card.typeByNumber(data);\n        break;\n    }\n\n    if (cardType) {\n      type = cardType.code;\n    }\n\n    return type;\n  }\n\n  /**\n   * Heartland.Util.applyOptions\n   *\n   * Creates a single object by merging a `source` (default) and `properties`\n   * obtained elsewhere, e.g. a function argument in `HPS`. Any properties in\n   * `properties` will overwrite matching properties in `source`.\n   *\n   * @param {Heartland.Options} source\n   * @param {Heartland.Options} properties\n   * @returns {Heartland.Options}\n   */\n  public static applyOptions(source: Options, properties: Options) {\n    var property: string;\n    var destination: Options = {};\n\n    if (!source) {\n      source = {};\n    }\n\n    for (property in source) {\n      if (source.hasOwnProperty(property)) {\n        (<any>destination)[property] = (<any>source)[property];\n      }\n    }\n\n    for (property in properties) {\n      if (properties.hasOwnProperty(property)) {\n        (<any>destination)[property] = (<any>properties)[property];\n      }\n    }\n\n    return destination;\n  }\n\n  /**\n   * Heartland.Util.throwError\n   *\n   * Allows a merchant-defined error handler to be used in cases where the\n   * tokenization process fails. If not provided, we throw the message as a\n   * JS runtime error.\n   *\n   * @param {Heartland.Options} options\n   * @param {string | Heartland.TokenizationResponse} errorMessage\n   */\n  public static throwError(options: Options, errorMessage: string | TokenizationResponse) {\n    if (typeof (options.error) === 'function') {\n      options.error(errorMessage);\n    } else {\n      throw errorMessage;\n    }\n  }\n\n  /**\n   * Heartland.Util.getItemByPropertyValue\n   *\n   * Enumerates over a `collection` to retreive an item whose `property` is\n   * a given `value`.\n   *\n   * @param {any} collection\n   * @param {string} property\n   * @param {any} value\n   * @returns {any}\n   */\n  public static getItemByPropertyValue(collection: any, property: string, value: any) {\n    var length = collection.length;\n    var i = 0;\n\n    for (i; i < length; i++) {\n      if (collection[i][property] === value) {\n        return collection[i];\n      }\n    }\n  }\n\n  /**\n   * Heartland.Util.getParams\n   *\n   * Builds param list for a particular `type` from expected properties in\n   * `data`.\n   *\n   * @param {string} type - The tokenization type\n   * @param {Heartland.Options} data\n   * @returns {string}\n   */\n  public static getParams(type: string, data: Options) {\n    var params: Array<string> = [];\n    switch (type) {\n      case 'pan':\n        params.push(\n          'token_type=supt',\n          'object=token',\n          '_method=post',\n          'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Bnumber%5D=' + data.cardNumber.replace(/\\s/g, ''),\n          'card%5Bexp_month%5D=' + data.cardExpMonth.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Bexp_year%5D=' + data.cardExpYear.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Bcvc%5D=' + data.cardCvv.replace(/^\\s+|\\s+$/g, '')\n        );\n        break;\n      case 'swipe':\n        params.push(\n          'token_type=supt',\n          'object=token',\n          '_method=post',\n          'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Btrack_method%5D=swipe',\n          'card%5Btrack%5D=' + encodeURIComponent(data.track.replace(/^\\s+|\\s+$/g, ''))\n        );\n        break;\n      case 'encrypted':\n        params.push(\n          'token_type=supt',\n          'object=token',\n          '_method=post',\n          'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''),\n          'encryptedcard%5Btrack_method%5D=swipe',\n          'encryptedcard%5Btrack%5D=' + encodeURIComponent(data.track.replace(/^\\s+|\\s+$/g, '')),\n          'encryptedcard%5Btrack_number%5D=' + encodeURIComponent(data.trackNumber.replace(/^\\s+|\\s+$/g, '')),\n          'encryptedcard%5Bktb%5D=' + encodeURIComponent(data.ktb.replace(/^\\s+|\\s+$/g, '')),\n          'encryptedcard%5Bpin_block%5D=' + encodeURIComponent(data.pinBlock.replace(/^\\s+|\\s+$/g, ''))\n        );\n        break;\n      default:\n        this.throwError(data, 'unknown params type');\n        break;\n    }\n    return '?' + params.join('&');\n  }\n\n  /**\n   * Heartland.Util.getUrlByEnv\n   *\n   * Selects the appropriate tokenization service URL for the\n   * active `publicKey`.\n   *\n   * @param {Heartland.Options} options\n   * @returns {string}\n   */\n  public static getUrlByEnv(options: Options) {\n    options.env = options.publicKey.split('_')[1];\n\n    if (options.env === 'cert') {\n      options.gatewayUrl = urls.CERT;\n    } else {\n      options.gatewayUrl = urls.PROD;\n    }\n\n    return options;\n  }\n\n  /**\n   * Heartland.Util.addFormHandler\n   *\n   * Creates and adds an event handler function for the submission for a given\n   * form (`options.form_id`).\n   *\n   * @param {Heartland.Options} options\n   * @listens submit\n   */\n  public static addFormHandler(options: Options) {\n    var payment_form = document.getElementById(options.formId);\n\n    var code = function (e: Event) {\n      if (e.preventDefault) {\n        e.preventDefault();\n      } else if (window.event) /* for ie */ {\n        window.event.returnValue = false;\n      }\n\n      var fields = this.getFields(options.formId);\n      var cardType = this.getCardType(fields.number, 'pan');\n\n      options.cardNumber = fields.number;\n      options.cardExpMonth = fields.expMonth;\n      options.cardExpYear = fields.expYear;\n      options.cardCvv = fields.cvv;\n      options.cardType = cardType;\n\n      Ajax.call('pan', options);\n    };\n\n    Events.addHandler(payment_form, 'submit', code);\n    DOM.addField(options.formId, 'hidden', 'publicKey', options.publicKey);\n  }\n\n  /**\n   * Heartland.Util.getFields\n   *\n   * Extracts card information from the fields with names `card_number`,\n   * `card_expiration_month`, `card_expiration_year`, and `card_cvc` and\n   * expects them to be present as children of `formParent`.\n   *\n   * @param {string} formParent\n   * @returns {Heartland.CardData}\n   */\n  public static getFields(formParent: string): CardData {\n    var form = document.getElementById(formParent);\n    var fields: CardData = {};\n    var i: number, element: HTMLInputElement;\n    var length = form.childElementCount;\n\n    for (i = 0; i < length; i++) {\n      element = <HTMLInputElement>form.children[i];\n      if (element.id === 'card_number') {\n        fields.number = element.value;\n      } else if (element.id === 'card_expiration_month') {\n        fields.expMonth = element.value;\n      } else if (element.id === 'card_expiration_year') {\n        fields.expYear = element.value;\n      } else if (element.id === 'card_cvc') {\n        fields.cvv = element.value;\n      }\n    }\n\n    return fields;\n  }\n}\n","import {DOM} from \"./DOM.ts\";\nimport {Util} from \"./Util.ts\";\nimport {Options} from \"./types/Options\";\nimport {TokenizationResponse} from \"./types/TokenizationResponse\";\n\n/**\n * @namespace Heartland.Ajax\n */\nexport class Ajax {\n  /**\n   * Heartland.Ajax.call\n   *\n   * Sets up a request to be passed to `Heartland.Ajax.jsonp`. On successful tokenization,\n   * `options.success` will be called with the tokenization data as the only\n   * argument passed.\n   *\n   * @param {string} type\n   * @param {Heartland.Options} options\n   */\n  public static call(type: string, options: Options) {\n    var cardType = Util.getCardType(type, options);\n    var params = Util.getParams(type, options);\n\n    this.jsonp(options.gatewayUrl + params, function (data) {\n      if (data.error) {\n        Util.throwError(options, data);\n      } else {\n        var card = data.card || data.encryptedcard;\n        var lastfour = card.number.slice(-4);\n\n        data.last_four = lastfour;\n        data.card_type = cardType;\n        data.exp_month = options.cardExpMonth;\n        data.exp_year = options.cardExpYear;\n\n        if (options.formId && options.formId.length > 0) {\n          DOM.addField(options.formId, 'hidden', 'token_value', data.token_value);\n          DOM.addField(options.formId, 'hidden', 'last_four', lastfour);\n          DOM.addField(options.formId, 'hidden', 'card_exp_year', options.cardExpYear);\n          DOM.addField(options.formId, 'hidden', 'card_exp_month', options.cardExpMonth);\n          DOM.addField(options.formId, 'hidden', 'card_type', cardType);\n        }\n\n        options.success(data);\n      }\n    });\n  }\n\n  /**\n   * Heartland.Ajax.jsonp\n   *\n   * Creates a new DOM node containing a created JSONP callback handler for an\n   * impending Ajax JSONP request. Removes need for `XMLHttpRequest`.\n   *\n   * @param {string} url\n   * @param {function} callback\n   */\n  private static jsonp(url: string, callback: (data: TokenizationResponse) => void) {\n    var script = document.createElement('script');\n    var callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());\n    (<any>window)[callbackName] = function (data: TokenizationResponse): void {\n      (<any>window)[callbackName] = undefined;\n      document.body.removeChild(script);\n      callback(data);\n    };\n\n    script.src = url + (url.indexOf('?') >= 0 ? '&' : '?') + 'callback=' + callbackName;\n    document.body.appendChild(script);\n  }\n}\n","import {CardNumber} from \"./CardNumber\";\nimport {Expiration} from \"./Expiration\";\n\nexport default {\n    CardNumber: CardNumber,\n    Expiration: Expiration\n}\n","import {Options} from \"../types/Options\";\n\nexport var defaults: Options = {\n  _method: 'post',\n  buttonTarget: '',\n  cardCvv: '',\n  cardExpMonth: '',\n  cardExpYear: '',\n  cardNumber: '',\n  cardType: '',\n  env: 'prod',\n  error: null,\n  fields: {},\n  formId: '',\n  gatewayUrl: '',\n  iframeTarget: '',\n  ktb: '',\n  object: 'token',\n  onEvent: null,\n  onTokenError: null,\n  onTokenSuccess: null,\n  pinBlock: '',\n  publicKey: '',\n  success: null,\n  targetType: '',\n  tokenType: 'supt',\n  track: '',\n  trackNumber: '',\n  type: 'pan',\n  useDefaultStyles: true\n};\n","export var fields = [\n  'cardNumber',\n  'cardCvv',\n  'cardExpiration',\n  'submit'\n];\n","import {Events} from \"./Events\";\nimport {HPS} from \"./HPS\";\n\n/**\n * Heartland.Messages\n *\n * Initializes a new object for wrapping `window.postMessage` and a fallback\n * method for legacy browsers.\n */\nexport class Messages {\n  hps: HPS;\n  intervalId: number;\n  lastHash: string;\n  pushIntervalStarted: boolean;\n  private callback: (m: any) => any;\n\n  /**\n   * Heartland.Messages (constructor)\n   *\n   * @constructor\n   * @param {Heartland.HPS} hps\n   * @returns {Heartland.Messages}\n   */\n  constructor(hps: HPS) {\n    this.hps = hps;\n    this.intervalId = null;\n    this.lastHash = '';\n    this.pushIntervalStarted = false;\n  }\n\n  /**\n   * Heartland.Messages.pushMessages\n   *\n   * For legacy browsers, a mailbox (buffer) must be used to ensure all messages\n   * are sent between parent and child windows. When ready, this function builds\n   * the final message, encodes it, sends it, and resets the mailbox to `[]`.\n   *\n   * @param {Heartland.HPS} hps\n   * @returns {function}\n   */\n  pushMessages(hps: HPS): () => void {\n    return function () {\n      var data: Array<any> = [];\n      var messageArr: Array<any> = [];\n      var message = '';\n      var i = 0, length = 0;\n      var targetUrl = '', url = '';\n      var current: any;\n      var targetNode: Window;\n      var re = /^#?\\d+&/;\n\n      length = hps.mailbox.length;\n      if (!length) {\n        return;\n      }\n\n      for (i = 0; i < length; i++) {\n        current = hps.mailbox.shift();\n        if (!targetUrl) {\n          targetUrl = current.targetUrl;\n          targetNode = current.targetNode;\n        }\n        messageArr.push(current.message);\n      }\n\n      current = null;\n      if (re.test(window.location.hash)) {\n        current = JSON.parse(decodeURIComponent(window.location.hash.replace(re, '')));\n        data.concat(current);\n      }\n\n      if (messageArr !== []) {\n        hps.cacheBust = hps.cacheBust || 1;\n        data.push({ data: messageArr, source: { name: hps.field || 'parent' } });\n        message = JSON.stringify(data);\n        url = targetUrl.replace(/#.*$/, '') + '#' +\n          (+new Date()) + (hps.cacheBust++) + '&' +\n          encodeURIComponent(message);\n        if (targetNode.location) {\n          targetNode.location.href = url;\n        } else {\n          (<any>targetNode).src = url;\n        }\n      }\n\n      messageArr.length = 0;\n      hps.mailbox.length = 0;\n    };\n  }\n\n  /**\n   * Heartland.Messages.post\n   *\n   * When present, wraps the built-in `window.postMessage`. When not present,\n   * pushes the message onto the mailbox for eventual sending, and on first use,\n   * starts the interval for `Messages.pushMessages`.\n   *\n   * @param {Object | string} message\n   * @param {string} target\n   */\n  post(message: Object | string, target: string): void {\n    var frame: any;\n    var targetNode: Window;\n    var targetUrl: string;\n\n    (<any>message).source = (<any>message).source || {};\n    (<any>message).source.name = window.name;\n\n    if (!this.hps.frames) {\n      return;\n    }\n\n    frame = (<any>this.hps.frames)[target] || (<any>this.hps)[target];\n\n    if (!frame) {\n      return;\n    }\n\n    targetUrl = (<any>this.hps.frames)[target].url;\n\n    try {\n      if (typeof frame.targetNode !== 'undefined') {\n        targetNode = frame.targetNode;\n      } else if (typeof frame.frame !== 'undefined') {\n        targetNode = frame.frame;\n      }\n    } catch (e) {\n      targetNode = frame;\n    }\n\n    if (window.postMessage) {\n      targetNode.postMessage(\n        JSON.stringify(message),\n        targetUrl\n      );\n    } else {\n      this.hps.mailbox = this.hps.mailbox || [];\n      this.hps.mailbox.push({\n        message: message,\n        targetNode: targetNode,\n        targetUrl: targetUrl\n      });\n      if (!this.pushIntervalStarted) {\n        setInterval(this.pushMessages(this.hps), 10);\n      }\n    }\n  }\n\n  /**\n   * Heartland.Messages.receive\n   *\n   * When present, wraps the built-in `window.postMesage`'s `message` or\n   * `onmessage` window events. When not present, uses a single interval to\n   * check for changes to `window.location.hash` when the other window sends a\n   * message and will decode the JSON and URI encoded hash.\n   *\n   * @param {Function} callback\n   * @param {string} sourceOrigin\n   */\n  receive(callback: Function, sourceOrigin: string): void {\n    if (window.postMessage) {\n      this.callback = function (m) {\n        // m.data = JSON.parse(m.data);\n        callback(m);\n      };\n      if (window.addEventListener) {\n        window.addEventListener('message', this.callback, !1);\n      } else {\n        (<any>window).attachEvent('onmessage', this.callback);\n      }\n    } else {\n      if (this.intervalId) {\n        clearInterval(this.intervalId);\n      }\n      this.intervalId = null;\n\n      if (callback) {\n        this.intervalId = setInterval(function () {\n          var hash = document.location.hash,\n            re = /^#?\\d+&/;\n          if (hash !== this.lastHash && re.test(hash)) {\n            var data = JSON.parse(decodeURIComponent(hash.replace(re, '')));\n            var i: any, j: any;\n            var m: any;\n            this.lastHash = hash;\n\n            for (i in data) {\n              m = data[i];\n              if (Object.prototype.toString.call(m.data) !== '[object Array]') {\n                callback(m);\n                continue;\n              }\n\n              for (j in m.data) {\n                callback({ data: m.data[j], source: m.source });\n              }\n            }\n          }\n        }, 100);\n      }\n    }\n    Events.trigger('receiveMessageHandlerAdded', document);\n  }\n\n  /**\n   * Heartland.Messages.removeReceiver\n   *\n   * Removes active `message` event handler function.\n   */\n  removeReceiver() {\n    if (window.addEventListener) {\n      window.removeEventListener('message', this.callback, !1);\n    } else {\n      (<any>window).detachEvent('onmessage', this.callback);\n    }\n  }\n\n  /**\n   * Heartland.Messages.dispose\n   *\n   * Removes active `message` event handler function and any\n   * active intervals.\n   */\n  dispose(): void {\n    this.removeReceiver();\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n    }\n  }\n}\n","import {defaults} from \"./vars/defaults\";\nimport {fields} from \"./vars/fields\";\nimport {urls} from \"./vars/urls\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport {HPS} from \"./HPS\";\nimport {Messages} from \"./Messages\";\nimport {Styles} from \"./Styles\";\n\n/**\n * @namespace Heartland.Frames\n */\nexport class Frames {\n  /**\n   * Heartland.Frames.configureIframe\n   *\n   * Prepares the pages iFrames for communication with the parent window.\n   *\n   * @param {Heartland.HPS} hps\n   * @listens click\n   * @listens message\n   */\n  public static configureIframe(hps: HPS) {\n    var frame: any;\n    var options = hps.options;\n    var target: HTMLElement;\n    var useDefaultStyles = true;\n    hps.Messages = hps.Messages || new Messages(hps);\n\n    if (options.env === 'cert') {\n      hps.iframe_url = urls.iframeCERT;\n    } else {\n      hps.iframe_url = urls.iframePROD;\n    }\n\n    if (options.fields !== defaults.fields) {\n      Frames.makeFieldsAndLink(hps);\n    }\n\n    if (options.fields === defaults.fields && options.iframeTarget) {\n      target = document.getElementById(options.iframeTarget);\n      if (options.targetType === 'myframe') {\n        frame = target;\n        hps.iframe_url = frame.src;\n      } else {\n        frame = DOM.makeFrame('heartland-frame-securesubmit');\n        target.appendChild(frame);\n      }\n\n      hps.iframe_url = hps.iframe_url + '#' + encodeURIComponent(document.location.href.split('#')[0]);\n      frame.src = hps.iframe_url;\n\n      hps.frames.child = {\n        frame: window.postMessage ? frame.contentWindow : frame,\n        name: 'child',\n        url: hps.iframe_url\n      };\n    }\n\n    if (options.useDefaultStyles === false) {\n      useDefaultStyles = false;\n    }\n\n    if (options.buttonTarget) {\n      hps.clickHandler = function (e) {\n        e.preventDefault();\n        hps.Messages.post(\n          {\n            accumulateData: !!hps.frames.cardNumber,\n            action: 'tokenize',\n            message: options.publicKey\n          },\n          hps.frames.cardNumber ? 'cardNumber' : 'child'\n        );\n        return false;\n      };\n      Events.addHandler(options.buttonTarget, 'click', hps.clickHandler);\n    }\n\n    hps.Messages.receive(function (m: MessageEvent) {\n      var data = JSON.parse(m.data);\n      var fieldFrame: any;\n\n      try {\n        fieldFrame = (<any>hps.frames)[data.source.name === 'heartland-frame-securesubmit' ? 'parent' : data.source.name];\n      } catch (e) { return; }\n\n      switch (data.action) {\n        case 'requestTokenize':\n          hps.Messages.post(\n            {\n              accumulateData: !!hps.frames.cardNumber,\n              action: 'tokenize',\n              message: options.publicKey\n            },\n            hps.frames.cardNumber ? 'cardNumber' : 'child'\n          );\n          break;\n        case 'onTokenSuccess':\n          options.onTokenSuccess(data.response);\n          break;\n        case 'onTokenError':\n          options.onTokenError(data.response);\n          break;\n        case 'resize':\n          if (fieldFrame) {\n            hps.resizeIFrame(fieldFrame.frame, data.height);\n          } else {\n            hps.resizeIFrame(frame, data.height);\n          }\n\n          break;\n        case 'receiveMessageHandlerAdded':\n          if (!options.fields && useDefaultStyles) {\n            Styles.Defaults.body(hps);\n            Styles.Defaults.labelsAndLegend(hps);\n            Styles.Defaults.inputsAndSelects(hps);\n            Styles.Defaults.fieldset(hps);\n            Styles.Defaults.selects(hps);\n            Styles.Defaults.selectLabels(hps);\n            Styles.Defaults.cvvContainer(hps);\n            Styles.Defaults.cvv(hps);\n          }\n\n          if (fieldFrame && fieldFrame.options.placeholder) {\n            hps.Messages.post(\n              {\n                action: 'setPlaceholder',\n                id: 'heartland-field',\n                text: fieldFrame.options.placeholder\n              },\n              fieldFrame.name\n            );\n          }\n\n          if (options.style) {\n            var css = options.styleString\n              || (options.styleString = DOM.json2css(options.style));\n            hps.Messages.post(\n              {\n                action: 'addStylesheet',\n                data: css\n              },\n              fieldFrame.name\n            );\n          }\n\n          Events.trigger('securesubmitIframeReady', document);\n          break;\n        case 'accumulateData':\n          var i: string;\n          var field: any;\n\n          for (i in hps.frames) {\n            if ('submit' === i || 'cardNumber' === i) {\n              continue;\n            }\n            field = (<any>hps.frames)[i];\n            hps.Messages.post(\n              {\n                action: 'getFieldData',\n                id: 'heartland-field'\n              },\n              field.name\n            );\n          }\n          break;\n        case 'passData':\n          var cardNumberFieldFrame = hps.frames.cardNumber;\n          if (!cardNumberFieldFrame) {\n            break;\n          }\n\n          hps.Messages.post(\n            {\n              action: 'setFieldData',\n              id: fieldFrame.name,\n              value: data.value\n            },\n            cardNumberFieldFrame.name\n          );\n          break;\n        case 'fieldEvent':\n          if (!options.onEvent) {\n            break;\n          }\n          options.onEvent(data.event);\n          break;\n        case 'error':\n          if (!options.onError) {\n            break;\n          }\n          options.onError(data);\n          break;\n      }\n    }, '*');\n\n\n    // monitorFieldEvents(hps, )\n  }\n\n  /**\n   * Heartland.Frames.makeFieldsAndLink\n   *\n   * Creates a set of single field iFrames and stores a reference to\n   * them in the parent window's state.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static makeFieldsAndLink(hps: HPS) {\n    var options = hps.options;\n    var fieldsLength = fields.length;\n    var baseUrl = hps.iframe_url.replace('index.html', '');\n\n    for (var i = 0; i < fieldsLength; i++) {\n      var field = fields[i];\n      var fieldOptions = options.fields[field];\n\n      if (!fieldOptions) { return; }\n\n      var frame = DOM.makeFrame(field);\n      var url = baseUrl;\n      if (field === 'submit') {\n        url = url + 'button.html';\n      } else {\n        url = url + 'field.html';\n      }\n      url = url + '#' + field + ':' + encodeURIComponent(document.location.href.split('#')[0]);\n      frame.src = url;\n\n      document\n        .getElementById(fieldOptions.target)\n        .appendChild(frame);\n\n      (<any>hps.frames)[field] = {\n        frame: frame,\n        name: field,\n        options: fieldOptions,\n        target: fieldOptions.target,\n        targetNode: window.postMessage ? frame.contentWindow : frame,\n        url: url\n      };\n    }\n  }\n\n  /**\n   * Heartland.Frames.monitorFieldEvents\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string | EventTarget} target\n   */\n  public static monitorFieldEvents(hps: HPS, target: string | EventTarget) {\n    var events = ['click', 'blur', 'focus', 'change', 'keypress', 'keydown', 'keyup'];\n    var i = 0, length = events.length;\n    var event: string;\n\n    for (i; i < length; i++) {\n      event = events[i];\n      Events.addHandler(target, event, function (e: Event) {\n        var field = document.getElementById('heartland-field');\n        var classes: string[] = [];\n        var data: any = {};\n\n        if (field.className !== '') {\n          classes = field.className.split(' ');\n        }\n\n        if ((<any>e).keyCode) {\n          data.keyCode = (<any>e).keyCode;\n        }\n\n        hps.Messages.post(\n          {\n            action: 'fieldEvent',\n            event: {\n              classes: classes,\n              data: data,\n              source: window.name,\n              type: e.type\n            }\n          },\n          'parent'\n        );\n      });\n    }\n  }\n}\n","import {defaults} from \"./vars/defaults\";\n\nimport {Ajax} from \"./Ajax\";\nimport {Card} from \"./Card\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport {Frames} from \"./Frames\";\nimport {Messages} from \"./Messages\";\nimport {Util} from \"./Util\";\n\nimport {Options} from \"./types/Options\";\n\ninterface Frame {\n  frame?: Window;\n  name?: string;\n  options?: any;\n  target?: string;\n  targetNode?: EventTarget;\n  url?: string;\n}\n\ninterface FrameCollection {\n  cardNumber?: Frame;\n  cardExpiration?: Frame;\n  cardCvv?: Frame;\n  submit?: Frame;\n  child?: Frame;\n  parent?: Frame;\n}\n\n/**\n * Heartland.HPS\n *\n * Initializes options and adds the default form handler if a `formId` is\n * passed as an option. This expects the default fields (see `getFields`) to\n * be present as children of `formId`.\n */\nexport class HPS {\n  options: Options;\n  frames: FrameCollection;\n  iframe_url: string;\n  Messages: Messages;\n  mailbox: any; // [];\n  cacheBust: number;\n  parent: Window;\n  field: string;\n  clickHandler: (e: Event) => void;\n  loadHandler: () => void;\n  receiveMessageHandlerAddedHandler: () => void;\n\n  /**\n   * Heartland.HPS (constructor)\n   *\n   * @constructor\n   * @param {Heartland.Options} options [optional]\n   * @returns {Heartland.HPS}\n   */\n  constructor(options?: Options) {\n    if (!options && window.parent) {\n      return;\n    }\n\n    this.options = Util.applyOptions(defaults, options);\n    this.options = Util.getUrlByEnv(this.options);\n\n    if (this.options.formId.length > 0) {\n      Util.addFormHandler(this.options);\n    }\n\n    this.frames = {};\n    if (this.options.type === 'iframe') {\n      this.iframe_url = '';\n\n      this.Messages = new Messages(this);\n      this.mailbox = [];\n      this.cacheBust = 1;\n      Frames.configureIframe(this);\n    }\n\n    return this;\n  }\n\n  /**\n   * Heartland.HPS.tokenize\n   *\n   * Tokenizes card data. Used in manual integrations where the merchant's\n   * credit card fields cannot/do not match the names expected in the default\n   * form handler (see `getFields`).\n   *\n   * @param {Heartland.Options} options [optional]\n   */\n  tokenize(options?: Options): void {\n    options = options || {};\n    if (options) {\n      this.options = Util.applyOptions(this.options, options);\n      this.options = Util.getUrlByEnv(this.options);\n    }\n    if (this.options.type === 'iframe') {\n      this.Messages.post(\n        {\n          action: 'tokenize',\n          message: this.options.publicKey\n        },\n        'child'\n      );\n      return;\n    }\n    Ajax.call(this.options.type, this.options);\n  };\n\n  /**\n   * Heartland.HPS.configureInternalIframe\n   *\n   * Sets up a child iframe window to prepare it for communication with the\n   * parent and for tokenization.\n   *\n   * @param {Heartland.Options} options\n   */\n  configureInternalIframe(options: Options): void {\n    this.Messages = new Messages(this);\n    this.parent = window.parent;\n    this.frames = this.frames || {};\n    this.frames.parent = {\n      frame: window.parent,\n      name: 'parent',\n      url: decodeURIComponent(document.location.hash.replace(/^#/, ''))\n    };\n\n    this.loadHandler = (function (hps: HPS) {\n      return function () {\n        DOM.resizeFrame(hps);\n      };\n    } (this));\n\n    this.receiveMessageHandlerAddedHandler = (function (hps: HPS) {\n      return function () {\n        hps.Messages.post({ action: 'receiveMessageHandlerAdded' }, 'parent');\n      };\n    } (this));\n\n    Events.addHandler(window, 'load', this.loadHandler);\n    Events.addHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n\n    this.Messages.receive(Events.frameHandleWith(this), '*');\n  };\n\n  /**\n   * Heartland.HPS.configureButtonFieldIframe\n   *\n   * Same as `Heartland.HPS.configureFieldIframe` excet the added click event\n   * handler for the button.\n   *\n   * @param {Heartland.Options} options\n   */\n  configureButtonFieldIframe(options: Options): void {\n    this.configureFieldIframe(options);\n    Events.addHandler('heartland-field', 'click', (function (hps: HPS) {\n      return function (e: Event) {\n        e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n        hps.Messages.post({ action: 'requestTokenize' }, 'parent');\n      };\n    } (this)));\n  }\n\n  /**\n   * Heartland.HPS.configureFieldIframe\n   *\n   * Sets up a child iframe window to prepare it for communication with the\n   * parent and for tokenization.\n   *\n   * @param {Heartland.Options} options\n   */\n  configureFieldIframe(options: Options): void {\n    var hash = document.location.hash.replace(/^#/, '');\n    var split = hash.split(':');\n    this.Messages = new Messages(this);\n    this.field = split.shift();\n    this.parent = window.parent;\n    this.frames = this.frames || {};\n    this.frames.parent = {\n      frame: window.parent,\n      name: 'parent',\n      url: decodeURIComponent(split.join(':').replace(/^:/, ''))\n    };\n\n    window.onerror = (function (hps: HPS) {\n      return function (errorMsg: string, url: string, lineNumber: number, column: number, errorObj: any) {\n        hps.Messages.post({\n          action: 'error',\n          data: {\n            column: column,\n            errorMsg: errorMsg,\n            lineNumber: lineNumber,\n            url: url\n          }\n        }, 'parent');\n        return true;\n      };\n    } (this));\n\n    this.loadHandler = (function (hps: HPS) {\n      return function () {\n        DOM.resizeFrame(hps);\n        DOM.configureField(hps);\n        var method = 'attach' + window.name.replace('card', '') + 'Events';\n        if ((<any>Card)[method]) {\n          (<any>Card)[method]('#heartland-field');\n        }\n      };\n    } (this));\n\n    this.receiveMessageHandlerAddedHandler = (function (hps: HPS) {\n      return function () {\n        hps.Messages.post({ action: 'receiveMessageHandlerAdded' }, 'parent');\n      };\n    } (this));\n\n    Events.addHandler(window, 'load', this.loadHandler);\n    Events.addHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n    Frames.monitorFieldEvents(this, 'heartland-field');\n\n    this.Messages.receive(Events.frameHandleWith(this), '*');\n  };\n\n  /**\n   * Heartland.HPS.resizeIFrame\n   *\n   * Called automatically when the child iframe window alerts the parent to\n   * resize.\n   *\n   * @param {HTMLIFrameElement} frame\n   * @param {string} height\n   */\n  resizeIFrame(frame: HTMLIFrameElement, height: string): void {\n    if (!frame) { return; }\n    frame.style.height = (parseInt(height, 10)) + 'px';\n  };\n\n  /**\n   * Heartland.HPS.setText\n   *\n   * Public API for setting an element's inner text.\n   *\n   * @param {string} elementid\n   * @param {string} elementtext\n   */\n  setText(elementid: string, elementtext: string): void {\n    this.Messages.post({ action: 'setText', id: elementid, text: elementtext }, 'child');\n  };\n\n  /**\n   * Heartland.HPS.setStyle\n   *\n   * Public API for setting an element's style.\n   *\n   * @param {string} elementid\n   * @param {string} elementstyle\n   */\n  setStyle(elementid: string, elementstyle: string): void {\n    this.Messages.post({ action: 'setStyle', id: elementid, style: elementstyle }, 'child');\n  };\n\n  /**\n   * Heartland.HPS.appendStyle\n   *\n   * Public API for appending to an element's style.\n   *\n   * @param {string} elementid\n   * @param {string} elementstyle\n   */\n  appendStyle(elementid: string, elementstyle: string): void {\n    this.Messages.post({ action: 'appendStyle', id: elementid, style: elementstyle }, 'child');\n  };\n\n  /**\n   * Heartland.HPS.setFocus\n   *\n   * Public API for appending to an element's style.\n   *\n   * @param {string} elementid\n   */\n  setFocus(elementid: string): void {\n    this.Messages.post({ action: 'setFocus' }, elementid);\n  };\n\n  /**\n   * Heartland.HPS.dispose\n   *\n   * Removes all iframes and event listeners from the DOM.\n   */\n  dispose(): void {\n    this.Messages.dispose();\n    this.Messages = null;\n    if (this.frames.cardNumber && this.frames.cardNumber.targetNode) {\n      (<any>this.frames.cardNumber.frame).remove();\n    }\n    if (this.frames.cardExpiration && this.frames.cardExpiration.frame) {\n      (<any>this.frames.cardExpiration.frame).remove();\n    }\n    if (this.frames.cardCvv && this.frames.cardCvv.frame) {\n      (<any>this.frames.cardCvv.frame).remove();\n    }\n    if (this.frames.child && this.frames.child.frame) {\n      (<any>this.frames.child.frame).remove();\n    }\n    if (this.clickHandler) {\n      Events.removeHandler(\n        this.options.buttonTarget,\n        'click',\n        this.clickHandler\n      );\n    }\n    if (this.loadHandler) {\n      Events.removeHandler(\n        window,\n        'load',\n        this.loadHandler\n      );\n    }\n    if (this.receiveMessageHandlerAddedHandler) {\n      Events.removeHandler(\n        document,\n        'receiveMessageHandlerAdded',\n        this.receiveMessageHandlerAddedHandler\n      );\n    }\n  };\n}\n","import {CardNumber} from \"./CardNumber\";\nimport {Cvv} from \"./Cvv\";\nimport {Expiration} from \"./Expiration\";\n\nexport default {\n    CardNumber: CardNumber,\n    Cvv: Cvv,\n    Expiration: Expiration\n}\n","import {Ajax} from \"./Ajax\";\nimport {Card} from \"./Card\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport Formatter from \"./Formatter\";\nimport {Frames} from \"./Frames\";\nimport {HPS} from \"./HPS\";\nimport {Messages} from \"./Messages\";\nimport {Styles} from \"./Styles\";\nimport {Util} from \"./Util\";\nimport Validator from \"./Validator\";\n\nexport default {\n    Ajax: Ajax,\n    Card: Card,\n    DOM: DOM,\n    Events: Events,\n    Formatter: Formatter,\n    Frames: Frames,\n    HPS: HPS,\n    Messages: Messages,\n    Styles: Styles,\n    Util: Util,\n    Validator: Validator\n}\n"],"names":["DOM","hps","document","getElementById","setAttribute","field","name","frame","createElement","id","style","border","frameBorder","scrolling","formParent","fieldType","fieldName","fieldValue","input","appendChild","elementid","htmlstyle","el","this","encodeEntities","currstyle","getAttribute","newstyle","text","textContent","docHeight","body","offsetHeight","Messages","post","action","height","value","css","elements","getElementsByTagName","type","createTextNode","json","attributes","children","i","j","key","jsonAttributes","attributesLength","length","isArray","arrLength","jsonChildren","childrenLength","json2css","focus","replace","v","hi","charCodeAt","low","obj","Object","prototype","toString","call","set","hasOwnProperty","push","cardTypes","code","format","regex","CardNumber","number","matches","Card","typeByNumber","match","global","shift","join","Expiration","exp","final","month","del","year","pat","groups","Date","getFullYear","slice","luhnCheck","Cvv","cvv","test","split","m","y","parseInt","Ev","node","eventName","callback","addEventListener","documentElement","attachEvent","e","propertyName","createEvent","event","initEvent","dispatchEvent","removeEventListener","detachEvent","Events","target","listen","ignore","data","bubble","trigger","JSON","parse","accumulateData","message","tokenizeIframe","setStyle","resizeFrame","appendStyle","setText","setPlaceholder","setFieldData","pkey","getFieldData","addStylesheet","setFocus","publicKey","card","numberElement","cvvElement","expElement","tokenResponse","response","parentNode","removeChild","remove","formatter","ExpirationFormatter","cardExpSplit","expMonth","expYear","undefined","tokenize","cardCvv","cardExpMonth","cardExpYear","cardNumber","error","success","cardType","isEncrypted","trackNumber","temp","substr","digits","digit","odd","sum","reverse","currentTarget","srcElement","classList","className","c","indexOf","formatted","CardNumberFormatter","setSelectionRange","cursor","selectionStart","charAt","keyCode","ctrlKey","preventDefault","returnValue","shiftKey","CardNumberValidator","validate","CvvValidator","ExpirationValidator","selector","addHandler","querySelector","restrictNumeric","restrictLength","deleteProperly","formatNumber","validateNumber","addType","formatExpiration","validateExpiration","validateCvv","Array","start","Styles","urls","CERT","PROD","iframeCERT","iframePROD","Util","tokenizationType","options","track","typeByTrack","source","properties","property","destination","errorMessage","collection","params","encodeURIComponent","ktb","pinBlock","throwError","env","gatewayUrl","payment_form","formId","window","fields","getFields","getCardType","Ajax","addField","element","form","childElementCount","getParams","jsonp","encryptedcard","lastfour","last_four","card_type","exp_month","exp_year","token_value","url","script","callbackName","Math","round","random","src","defaults","_method","buttonTarget","iframeTarget","object","onEvent","onTokenError","onTokenSuccess","targetType","tokenType","useDefaultStyles","intervalId","lastHash","pushIntervalStarted","current","targetNode","messageArr","targetUrl","re","mailbox","location","hash","decodeURIComponent","concat","cacheBust","stringify","href","frames","postMessage","setInterval","pushMessages","sourceOrigin","clearInterval","removeReceiver","cvvContainer","fieldset","inputsAndSelects","ids","labelsAndLegend","selectLabels","selects","Frames","iframe_url","makeFieldsAndLink","makeFrame","child","contentWindow","clickHandler","receive","fieldFrame","resizeIFrame","Defaults","placeholder","styleString","cardNumberFieldFrame","onError","fieldsLength","baseUrl","fieldOptions","events","classes","parent","applyOptions","getUrlByEnv","addFormHandler","configureIframe","HPS","loadHandler","receiveMessageHandlerAddedHandler","frameHandleWith","configureFieldIframe","onerror","errorMsg","lineNumber","column","errorObj","configureField","method","monitorFieldEvents","elementtext","elementstyle","dispose","cardExpiration","removeHandler","Formatter","Validator"],"mappings":"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"}