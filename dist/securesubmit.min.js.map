{"version":3,"file":null,"sources":["../src/DOM.ts","../src/vars/cardTypes.ts","../src/Formatter/CardNumber.ts","../src/Formatter/Expiration.ts","../src/Validator/CardNumber.ts","../src/Validator/Cvv.ts","../src/Validator/Expiration.ts","../src/formatter/Expiration.ts","../src/Events.ts","../src/Card.ts","../src/vars/urls.ts","../src/Styles.ts","../src/Util.ts","../src/Ajax.ts","../src/Formatter/index.ts","../src/vars/defaults.ts","../src/vars/fields.ts","../src/Messages.ts","../src/Frames.ts","../src/HPS.ts","../src/Validator/index.ts","../src/index.ts"],"sourcesContent":["import {HPS} from \"./HPS\";\n\n/**\n * @namespace Heartland.DOM\n */\nexport class DOM {\n  /**\n   * Heartland.DOM.configureField\n   *\n   * Configures an input field in a single field iFrame.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static configureField(hps: HPS) {\n    document.getElementById('heartland-field').setAttribute('name', hps.field);\n  }\n\n  /**\n   * Heartland.DOM.makeFrame\n   *\n   * Creates a single iFrame element with the appropriate defaults.\n   *\n   * @param {string} name\n   * @returns {HTMLIframeElement}\n   */\n  public static makeFrame(name: string) {\n    const frame = document.createElement('iframe');\n    frame.id = 'heartland-frame-' + name;\n    frame.name = name;\n    frame.style.border = '0';\n    frame.frameBorder = '0';\n    frame.scrolling = 'no';\n    return frame;\n  }\n\n  /**\n   * Heartland.DOM.addField\n   *\n   * Adds a DOM `input` node to `formParent` with type `fieldType`, name\n   * `fieldName`, and value `fieldValue`.\n   *\n   * @param {string} formParent\n   * @param {string} fieldType\n   * @param {string} fieldName\n   * @param {string} fieldValue\n   */\n  public static addField(formParent: string, fieldType: string, fieldName: string, fieldValue: string) {\n    const input = document.createElement('input');\n\n    input.setAttribute('type', fieldType);\n    input.setAttribute('name', fieldName);\n    input.setAttribute('value', fieldValue);\n\n    document.getElementById(formParent).appendChild(input);\n  }\n\n  /**\n   * Heartland.DOM.setStyle\n   *\n   * Sets an element's style attribute within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {string} htmlstyle\n   */\n  public static setStyle(elementid: string, htmlstyle: string) {\n    const el = document.getElementById(elementid);\n    if (el) {\n      el.setAttribute('style', DOM.encodeEntities(htmlstyle));\n    }\n  }\n\n  /**\n   * Heartland.DOM.appendStyle\n   *\n   * Appends an element's style attribute within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {String} htmlstyle\n   */\n  public static appendStyle(elementid: string, htmlstyle: string) {\n    const el = document.getElementById(elementid);\n    if (el) {\n      const currstyle = el.getAttribute('style');\n      const newstyle = (currstyle ? currstyle : '') + htmlstyle;\n      el.setAttribute('style', DOM.encodeEntities(newstyle));\n    }\n  }\n\n  /**\n   * Heartland.DOM.setText\n   *\n   * Sets an element's inner text within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {string} text\n   */\n  public static setText(elementid: string, text: string) {\n    const el = document.getElementById(elementid);\n    if (el) {\n      el.textContent = DOM.encodeEntities(text);\n    }\n  }\n\n  /**\n   * Heartland.DOM.setPlaceholder\n   *\n   * Sets an element's placeholder attribute within a child iframe window.\n   *\n   * @param {string} elementid\n   * @param {string} text\n   */\n  public static setPlaceholder(elementid: string, text: string) {\n    const el = document.getElementById(elementid);\n    if (el) {\n      if (text === '•••• •••• •••• ••••' || text === '••••' || text === '•••'\n        || text === '···· ···· ···· ····') {\n        el.setAttribute('placeholder', text);\n      } else {\n        el.setAttribute('placeholder', DOM.encodeEntities(text));\n      }\n    }\n  }\n\n  /**\n   * Heartland.DOM.resizeFrame\n   *\n   * Alerts a parent window to resize the iframe.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static resizeFrame(hps: HPS) {\n    const docHeight = document.body.offsetHeight + 1; // off by one error\n    hps.Messages.post({ action: 'resize', height: docHeight }, 'parent');\n  }\n\n  /**\n   * Heartland.DOM.setFieldData\n   *\n   * Receives a field value from another frame prior to the tokenization process.\n   *\n   * @param {string} elementid\n   * @param {string} value\n   */\n  public static setFieldData(elementid: string, value: string) {\n    let el = document.getElementById(elementid);\n    if (!el && document.getElementById('heartland-field')) {\n      el = document.createElement('input');\n      el.setAttribute('id', DOM.encodeEntities(elementid));\n      el.setAttribute('type', 'hidden');\n      document.getElementById('heartland-field-wrapper').appendChild(el);\n    }\n\n    if (el) {\n      el.setAttribute('value', DOM.encodeEntities(value));\n    }\n  }\n\n  /**\n   * Heartland.DOM.getFieldData\n   *\n   * Retrieves a field value for another frame prior to the tokenization process.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} elementid\n   */\n  public static getFieldData(hps: HPS, elementid: string) {\n    const el: HTMLInputElement = <HTMLInputElement>document.getElementById(elementid);\n    if (el) {\n      hps.Messages.post({ action: 'passData', value: el.value }, 'parent');\n    }\n  }\n\n  /**\n   * Heartland.DOM.addStylesheet\n   *\n   * Creates a `style` node in the DOM with the given `css`.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} elementid\n   */\n  public static addStylesheet(css: string) {\n    const el = document.createElement('style');\n    const elements = document.getElementsByTagName('head');\n    el.type = 'text/css';\n    el.appendChild(document.createTextNode(css));\n    if (elements && elements[0]) {\n      elements[0].appendChild(el);\n    }\n  }\n\n  /**\n   * Heartland.DOM.json2css\n   *\n   * Converts a JSON node to text representing CSS.\n   *\n   * @param {string} json\n   * @returns {string}\n   */\n  public static json2css(json: Object): string {\n    let css = '';\n    let attributes: string[];\n    let children: Object[];\n    let i: number, j: number;\n    let key: any, value: any;\n\n    if (attributes = DOM.jsonAttributes(json)) {\n      const attributesLength = attributes.length;\n      for (i = 0; i < attributesLength; i++) {\n        key = attributes[i];\n        value = (<any>json)[key];\n        if (DOM.isArray(value)) {\n          const arrLength = value.length;\n          for (j = 0; j < arrLength; j++) {\n            css += key + ':' + value[j] + ';';\n          }\n        } else {\n          css += key + ':' + value + ';';\n        }\n      }\n    }\n\n    if (children = DOM.jsonChildren(json)) {\n      const childrenLength = children.length;\n      for (i = 0; i < childrenLength; i++) {\n        key = children[i];\n        value = (<any>json)[key];\n        css += key + '{' + DOM.json2css(value) + '}';\n      }\n    }\n\n    return css;\n  }\n\n  /**\n   * Heartland.DOM.setFocus\n   *\n   * Sets the focus on an iframe's field.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} elementid\n   */\n  public static setFocus() {\n    const el = document.getElementById('heartland-field');\n    if (el) {\n      el.focus();\n    }\n  }\n\n  /***********\n   * Helpers *\n   ***********/\n\n  /**\n   * Escapes all potentially dangerous characters, so that the\n   * resulting string can be safely inserted into attribute or\n   * element text.\n   *\n   * @param value\n   * @returns {string} escaped text\n   */\n  private static encodeEntities(value: string) {\n    return value.\n      replace(/&/g, '&amp;').\n      replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, function (v) {\n        const hi = v.charCodeAt(0);\n        const low = v.charCodeAt(1);\n        return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\n      }).\n      replace(/([^\\#-~| |!])/g, function (v) {\n        return '&#' + v.charCodeAt(0) + ';';\n      }).\n      replace(/</g, '&lt;').\n      replace(/>/g, '&gt;');\n  }\n\n  private static isArray(obj: any): boolean {\n    return Object.prototype.toString.call(obj) === '[object Array]';\n  }\n\n  private static jsonAttributes(json: Object): string[] {\n    const set: string[] = [];\n    for (const i in json) {\n      if (json.hasOwnProperty(i)\n        && (typeof (<any>json)[i] === 'string' || DOM.isArray((<any>json)[i]))) {\n        set.push(i);\n      }\n    }\n    return set;\n  }\n\n  private static jsonChildren(json: Object): Object[] {\n    const set: Object[] = [];\n    for (const i in json) {\n      if (json.hasOwnProperty(i)\n        && (Object.prototype.toString.call((<any>json)[i]) === '[object Object]')) {\n        set.push(i);\n      }\n    }\n    return set;\n  }\n}\n","import {CardType} from \"../types/CardType\";\n\nexport const cardTypes: CardType[] = [\n  {\n    code: 'visa',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^4/\n  },\n  {\n    code: 'mastercard',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^(5[1-5]|2[2-7])/\n  },\n  {\n    code: 'amex',\n    format: /(\\d{1,4})(\\d{1,6})?(\\d{1,5})?/,\n    length: 15,\n    regex: /^3[47]/\n  },\n  {\n    code: 'diners',\n    format: /(\\d{1,4})(\\d{1,6})?(\\d{1,4})?/,\n    length: 14,\n    regex: /^3[0689]/\n  },\n  {\n    code: 'discover',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^6([045]|22)/\n  },\n  {\n    code: 'jcb',\n    format: /(\\d{1,4})/g,\n    length: 16,\n    regex: /^35/\n  }\n];\n","import {Formatter} from \"../types/Formatter\";\nimport {Card} from \"../Card\";\n\nexport class CardNumber implements Formatter {\n  format(number: string): string {\n    number = number.replace(/\\D/g, '');\n    const type = Card.typeByNumber(number);\n\n    if (!type) { return number; }\n\n    const matches = number.match(type.format);\n\n    if (!matches) { return number; }\n\n    if (!type.format.global) {\n      matches.shift();\n    }\n    return matches.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n}\n","import {Formatter} from \"../types/Formatter\";\n\nexport class Expiration implements Formatter {\n  format(exp: string, final = false): string {\n    const pat = /^\\D*(\\d{1,2})(\\D+)?(\\d{1,4})?/;\n    const groups = exp.match(pat);\n    let month: string;\n    let del: string;\n    let year: string;\n\n    if (!groups) {\n      return '';\n    }\n\n    month = groups[1] || '';\n    del = groups[2] || '';\n    year = groups[3] || '';\n\n    if (year.length > 0) {\n      del = ' / ';\n    } else if (month.length === 2 || del.length > 0) {\n      del = ' / ';\n    } else if (month.length === 1 && (month !== '0' && month !== '1')) {\n      del = ' / ';\n    }\n\n    if (month.length === 1 && del !== '') {\n      month = '0' + month;\n    }\n\n    if (final && year.length === 2) {\n      year = (new Date).getFullYear().toString().slice(0, 2) + year;\n    }\n\n    return month + del + year;\n  }\n}\n","import {Validator} from \"../types/Validator\";\nimport {Card} from \"../Card\";\n\nexport class CardNumber implements Validator {\n  validate(number: string): boolean {\n    if (!number) {\n      return false;\n    }\n\n    number = number.replace(/[-\\s]/g, '');\n    const type = Card.typeByNumber(number);\n\n    if (!type) {\n      return false;\n    }\n    return Card.luhnCheck(number)\n      && number.length === type.length;\n  }\n}\n","import {Validator} from \"../types/Validator\";\n\nexport class Cvv implements Validator {\n  validate(cvv: string): boolean {\n    if (!cvv) {\n      return false;\n    }\n\n    cvv = cvv.replace(/^\\s+|\\s+$/g, '');\n\n    if (!/^\\d+$/.test(cvv)) {\n      return false;\n    }\n    return 3 <= cvv.length && cvv.length <= 4;\n  }\n}\n","import {Validator} from \"../types/Validator\";\n\nexport class Expiration implements Validator {\n  validate(exp: string): boolean {\n    let m: string, y: string;\n\n    if (!exp) {\n      return false;\n    }\n\n    const split = exp.split('/');\n    [m, y] = split;\n\n    if (!m || !y) {\n      return false;\n    }\n\n    m = m.replace(/^\\s+|\\s+$/g, '');\n    y = y.replace(/^\\s+|\\s+$/g, '');\n\n    if (!/^\\d+$/.test(m)) {\n      return false;\n    }\n    if (!/^\\d+$/.test(y)) {\n      return false;\n    }\n\n    if (y.length === 2) {\n      y = (new Date).getFullYear().toString().slice(0, 2) + y;\n    }\n\n    const month = parseInt(m, 10);\n    const year = parseInt(y, 10);\n\n    if (!(1 <= month && month <= 12)) {\n      return false;\n    }\n\n    // creates date as 1 day past end of\n    // expiration month since JS months\n    // are 0 indexed\n    return (new Date(year, month, 1)) > (new Date);\n  }\n}\n","import {Formatter} from \"../types/Formatter\";\n\nexport class Expiration implements Formatter {\n  format(exp: string, final = false): string {\n    const pat = /^\\D*(\\d{1,2})(\\D+)?(\\d{1,4})?/;\n    const groups = exp.match(pat);\n    let month: string;\n    let del: string;\n    let year: string;\n\n    if (!groups) {\n      return '';\n    }\n\n    month = groups[1] || '';\n    del = groups[2] || '';\n    year = groups[3] || '';\n\n    if (year.length > 0) {\n      del = ' / ';\n    } else if (month.length === 2 || del.length > 0) {\n      del = ' / ';\n    } else if (month.length === 1 && (month !== '0' && month !== '1')) {\n      del = ' / ';\n    }\n\n    if (month.length === 1 && del !== '') {\n      month = '0' + month;\n    }\n\n    if (final && year.length === 2) {\n      year = (new Date).getFullYear().toString().slice(0, 2) + year;\n    }\n\n    return month + del + year;\n  }\n}\n","import {DOM} from \"./DOM\";\nimport {HPS} from \"./HPS\";\nimport {CardData} from \"./types/CardData\";\nimport {TokenizationResponse} from \"./types/TokenizationResponse\";\nimport {Expiration as ExpirationFormatter} from \"./formatter/Expiration\";\n\nclass Ev {\n  public static listen(node: EventTarget, eventName: string, callback: EventListener) {\n    if (document.addEventListener) {\n      node.addEventListener(eventName, callback, false);\n    } else {\n      if (node === document) {\n        (<any>document.documentElement).attachEvent('onpropertychange', function (e: Event) {\n          if ((<any>e).propertyName === eventName) {\n            callback(e);\n          }\n        });\n      } else {\n        (<any>node).attachEvent('on' + eventName, callback);\n      }\n    }\n  }\n  public static trigger(node: EventTarget, eventName: string) {\n    if (document.createEvent) {\n      const event = document.createEvent('Event');\n      event.initEvent(eventName, true, true);\n      node.dispatchEvent(event);\n    } else {\n      (<any>document.documentElement)[eventName]++;\n    }\n  }\n  public static ignore(eventName: string, callback: EventListener) {\n    if (document.removeEventListener) {\n      document.removeEventListener(eventName, callback, false);\n    } else {\n      (<any>document.documentElement).detachEvent('onpropertychange', function (e: Event) {\n        if ((<any>e).propertyName === eventName) {\n          callback(e);\n        }\n      });\n    }\n  }\n}\n\n/**\n * @namespace Heartland.Events\n */\nexport class Events {\n  /**\n   * Heartland.Events.addHandler\n   *\n   * Adds an `event` handler for a given `target` element.\n   *\n   * @param {string | EventTarget} target\n   * @param {string} event\n   * @param {EventListener} callback\n   */\n  public static addHandler(target: string | EventTarget, event: string, callback: EventListener) {\n    let node: EventTarget;\n    if (typeof target === 'string') {\n      node = document.getElementById(<string>target);\n    } else {\n      node = target;\n    }\n\n    if (document.addEventListener) {\n      node.addEventListener(event, callback, false);\n    } else {\n      Ev.listen(node, event, callback);\n    }\n  }\n\n  /**\n   * Heartland.Events.removeHandler\n   *\n   * Removes an `event` handler for a given `target` element.\n   *\n   * @param {string | EventTarget} target\n   * @param {string} event\n   * @param {EventListener} callback\n   */\n  public static removeHandler(target: string | EventTarget, event: string, callback: EventListener) {\n    let node: EventTarget;\n    if (typeof target === 'string') {\n      node = document.getElementById(<string>target);\n    } else {\n      node = target;\n    }\n\n    if (document.removeEventListener) {\n      node.removeEventListener(event, callback, false);\n    } else {\n      Ev.ignore(event, callback);\n    }\n  }\n\n  /**\n   * Heartland.Events.trigger\n   *\n   * Fires off an `event` for a given `target` element.\n   *\n   * @param {string} name\n   * @param {any} target\n   * @param {any} data [optional]\n   */\n  public static trigger(name: string, target: any, data?: any, bubble = false) {\n    if (document.createEvent) {\n      const event = document.createEvent('Event');\n      event.initEvent(name, true, true);\n      target.dispatchEvent(event);\n    } else {\n      Ev.trigger(target, name);\n    }\n  }\n\n  /**\n   * Heartland.Events.frameHandleWith\n   *\n   * Wraps `hps` state in a closure to provide a `Heartland.Messages.receive`\n   * callback handler for iFrame children.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static frameHandleWith(hps: HPS): (m: any) => void {\n    return function (data) {\n      switch (data.action) {\n        case 'tokenize':\n          if (data.accumulateData) {\n            hps.Messages.post(\n              {\n                action: 'accumulateData'\n              },\n              'parent'\n            );\n            const el = document.createElement('input');\n            el.id = 'publicKey';\n            el.type = 'hidden';\n            el.value = data.message;\n            document\n              .getElementById('heartland-field-wrapper')\n              .appendChild(el);\n          } else {\n            Events.tokenizeIframe(hps, data.message);\n          }\n          break;\n        case 'setStyle':\n          DOM.setStyle(data.id, data.style);\n          DOM.resizeFrame(hps);\n          break;\n        case 'appendStyle':\n          DOM.appendStyle(data.id, data.style);\n          DOM.resizeFrame(hps);\n          break;\n        case 'setText':\n          DOM.setText(data.id, data.text);\n          DOM.resizeFrame(hps);\n          break;\n        case 'setPlaceholder':\n          DOM.setPlaceholder(data.id, data.text);\n          break;\n        case 'setFieldData':\n          DOM.setFieldData(data.id, data.value);\n          if (document.getElementById('heartland-field') &&\n            document.getElementById('cardCvv') &&\n            document.getElementById('cardExpiration')) {\n            const pkey = document.getElementById('publicKey');\n            Events.tokenizeIframe(hps, (pkey ? pkey.getAttribute('value') : ''));\n          }\n          break;\n        case 'getFieldData':\n          DOM.getFieldData(hps, data.id);\n          break;\n        case 'addStylesheet':\n          DOM.addStylesheet(data.data);\n          DOM.resizeFrame(hps);\n          break;\n        case 'setFocus':\n          DOM.setFocus();\n          break;\n      }\n    };\n  }\n\n  /**\n   * tokenizeIframe\n   *\n   * Tokenizes card data. Used in iframe integrations to tokenize on Heartland's\n   * servers.\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string} publicKey\n   */\n  public static tokenizeIframe(hps: HPS, publicKey: string) {\n    const card: CardData = {};\n    const numberElement = <HTMLInputElement>(document.getElementById('heartland-field')\n      || document.getElementById('heartland-card-number'));\n    const cvvElement = <HTMLInputElement>(document.getElementById('cardCvv')\n      || document.getElementById('heartland-cvv'));\n    const expElement = document.getElementById('cardExpiration');\n    const tokenResponse = (action: string) => {\n      return (response: TokenizationResponse) => {\n        hps.Messages.post({ action: action, response: response }, 'parent');\n        if (cvvElement) {\n          if (cvvElement.parentNode) {\n            cvvElement.parentNode.removeChild(cvvElement);\n          } else {\n            cvvElement.remove();\n          }\n        }\n        if (expElement) {\n          if (expElement.parentNode) {\n            expElement.parentNode.removeChild(expElement);\n          } else {\n            expElement.remove();\n          }\n        }\n      };\n    };\n\n    card.number = numberElement ? numberElement.value : '';\n    card.cvv = cvvElement ? cvvElement.value : '';\n    card.exp = expElement;\n\n    if (card.exp) {\n      const formatter = new ExpirationFormatter();\n      const cardExpSplit = formatter.format((<HTMLInputElement>card.exp).value, true).split('/');\n      card.expMonth = cardExpSplit[0];\n      card.expYear = cardExpSplit[1];\n      card.exp = undefined;\n    } else {\n      card.expMonth = (<HTMLInputElement>document.getElementById('heartland-expiration-month')).value;\n      card.expYear = (<HTMLInputElement>document.getElementById('heartland-expiration-year')).value;\n    }\n\n    hps.tokenize({\n      cardCvv: card.cvv ? card.cvv : '',\n      cardExpMonth: card.expMonth ? card.expMonth : '',\n      cardExpYear: card.expYear ? card.expYear : '',\n      cardNumber: card.number ? card.number : '',\n      error: tokenResponse('onTokenError'),\n      publicKey: publicKey ? publicKey : '',\n      success: tokenResponse('onTokenSuccess'),\n      type: 'pan'\n    });\n  }\n}\n","import {CardType} from \"./types/CardType\";\nimport {cardTypes} from \"./vars/cardTypes\";\nimport {CardNumber as CardNumberFormatter} from \"./Formatter/CardNumber\";\nimport {Expiration as ExpirationFormatter} from \"./Formatter/Expiration\";\nimport {CardNumber as CardNumberValidator} from \"./Validator/CardNumber\";\nimport {Cvv as CvvValidator} from \"./Validator/Cvv\";\nimport {Expiration as ExpirationValidator} from \"./Validator/Expiration\";\nimport {Events} from \"./Events\";\n\n/**\n * @namespace Heartland.Card\n */\nexport class Card {\n  /**\n   * Heartland.Card.typeByNumber\n   *\n   * Helper function to grab the CardType for a given card number.\n   *\n   * @param {string} number - The card number\n   * @returns {Heartland.CardType}\n   */\n  public static typeByNumber(number: string): CardType {\n    let cardType: CardType;\n    let i: any;\n\n    if (!number) { return null; }\n    if (number.replace(/^\\s+|\\s+$/gm, '').length < 4) { return null; }\n\n    for (i in cardTypes) {\n      cardType = cardTypes[i];\n      if (cardType && cardType.regex && cardType.regex.test(number)) {\n        break;\n      }\n    }\n\n    return cardType;\n  }\n\n  /**\n   * Heartland.Card.typeByTrack\n   *\n   * @param {string} data - track data\n   * @param {boolean} isEncrypted - (default: false)\n   * @param {string} trackNumber\n   *\n   * @returns CardType\n   */\n  public static typeByTrack(data: string, isEncrypted = false, trackNumber?: string) {\n    let number: string;\n\n    if (isEncrypted && trackNumber && trackNumber === '02') {\n      number = data.split('=')[0];\n    } else {\n      let temp = data.split('%');\n      if (temp[1]) {\n        temp = temp[1].split('^');\n        if (temp[0]) {\n          number = temp[0].toString().substr(1);\n        }\n      }\n    }\n\n    return Card.typeByNumber(number);\n  }\n\n  /**\n   * Heartland.Card.luhnCheck\n   *\n   * Runs a mod 10 check on a given card number.\n   *\n   * @param {string} number - The card number\n   * @returns {boolean}\n   */\n  public static luhnCheck(number: string): boolean {\n    let odd = true;\n    let i = 0;\n    let sum = 0;\n    let digit: number;\n\n    if (!number) {\n      return false;\n    }\n\n    const digits = number.split('').reverse();\n    const length = digits.length;\n\n    for (i; i < length; i++) {\n      digit = parseInt(digits[i], 10);\n      if (odd = !odd) {\n        digit *= 2;\n      }\n      if (digit > 9) {\n        digit -= 9;\n      }\n      sum += digit;\n    }\n\n    return sum % 10 === 0;\n  }\n\n  /**\n   * Heartland.Card.addType\n   *\n   * Adds a class to the target element with the card type\n   * inferred from the target's current value.\n   *\n   * @param {Event} e\n   */\n  public static addType(e: Event) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const type = Card.typeByNumber(target.value);\n    const classList = target.className.split(' ');\n    const length = classList.length;\n    let i = 0;\n    let c = '';\n\n    for (i; i < length; i++) {\n      c = classList[i];\n      if (c && c.indexOf('card-type-') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if (type) {\n      classList.push('card-type-' + type.code);\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.formatNumber\n   *\n   * Formats a target element's value based on the\n   * inferred card type's formatting regex.\n   *\n   * @param {Event} e\n   */\n  public static formatNumber(e: Event) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n\n    if (value.length === 0) { return; }\n\n    const formatted = (new CardNumberFormatter).format(value);\n    target.value = formatted;\n\n    if (!target.setSelectionRange) { return; }\n\n    let cursor = target.selectionStart;\n\n    // copy and paste, space inserted on formatter\n    if (value.length < formatted.length) {\n      cursor += formatted.length - value.length;\n    }\n\n    // check if before new inserted digit is a space\n    if (value.charAt(cursor) === ' ' &&\n      formatted.charAt(cursor - 1) === ' ') {\n      cursor += 1;\n    }\n\n    target.setSelectionRange(cursor, cursor);\n  }\n\n  /**\n   * Heartland.Card.formatExpiration\n   *\n   * Formats a target element's value.\n   *\n   * @param {KeyboardEvent} e\n   */\n  public static formatExpiration(e: KeyboardEvent) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n    // allow: delete, backspace\n    if ([46, 8].indexOf(e.keyCode) !== -1 ||\n      // allow: home, end, left, right\n      (e.keyCode >= 35 && e.keyCode <= 39)) {\n      return;\n    }\n    target.value = (new ExpirationFormatter)\n      .format(value, e.type === 'blur');\n  }\n\n  /**\n   * Heartland.Card.restrictLength\n   *\n   * Restricts input in a target element to a\n   * certain length data.\n   *\n   * @param {number} length\n   *\n   * @returns {(e: KeyboardEvent) => ()}\n   */\n  public static restrictLength(length: number) {\n    return function (e: KeyboardEvent) {\n      const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n      const value = target.value;\n      // allow: backspace, delete, tab, escape and enter\n      if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||\n        // allow: Ctrl+A\n        (e.keyCode === 65 && e.ctrlKey === true) ||\n        // allow: home, end, left, right\n        (e.keyCode >= 35 && e.keyCode <= 39)) {\n        // let it happen, don't do anything\n        return;\n      }\n      if (value.length >= length) {\n        e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n      }\n    };\n  }\n\n  /**\n   * Heartland.Card.restrictNumeric\n   *\n   * Restricts input in a target element to only\n   * numeric data.\n   *\n   * @param {KeyboardEvent} e\n   */\n  public static restrictNumeric(e: KeyboardEvent) {\n    // allow: backspace, delete, tab, escape and enter\n    if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||\n      // allow: Ctrl+A\n      (e.keyCode === 65 && e.ctrlKey === true) ||\n      // allow: home, end, left, right\n      (e.keyCode >= 35 && e.keyCode <= 39) ||\n      // allow: weird Android/Chrome issue\n      (e.keyCode === 229)) {\n      // let it happen, don't do anything\n      return;\n    }\n    // ensure that it is a number and stop the keypress\n    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {\n      e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n    }\n  }\n\n  /**\n   * Heartland.Card.deleteProperly\n   *\n   * Places cursor on the correct position to\n   * let the browser delete the digit instead\n   * of the space.\n   *\n   * @param {KeyboardEvent} e\n   */\n  public static deleteProperly(e: KeyboardEvent) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n\n    if (!target.setSelectionRange) { return; }\n\n    const cursor = target.selectionStart;\n\n    // allow: delete, backspace\n    if ([46, 8].indexOf(e.keyCode) !== -1 &&\n      // if space to be deleted\n      (value.charAt(cursor - 1) === ' ')) {\n      // placing cursor before space to delete digit instead\n      target.setSelectionRange(cursor - 1, cursor - 1);\n    }\n  }\n\n  /**\n   * Heartland.Card.validateNumber\n   *\n   * Validates a target element's value based on the\n   * inferred card type's validation regex. Adds a\n   * class to the target element to note `valid` or\n   * `invalid`.\n   *\n   * @param {Event} e\n   */\n  public static validateNumber(e: Event) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n    const classList = target.className.split(' ');\n    const length = classList.length;\n    let c = '';\n\n    for (let i = 0; i < length; i++) {\n      c = classList[i];\n      if (c.indexOf('valid') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if ((new CardNumberValidator).validate(value)) {\n      classList.push('valid');\n    } else {\n      classList.push('invalid');\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.validateCvv\n   *\n   * Validates a target element's value based on the\n   * possible CVV lengths. Adds a class to the target\n   * element to note `valid` or `invalid`.\n   *\n   * @param {Event} e\n   */\n  public static validateCvv(e: Event) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n    const classList = target.className.split(' ');\n    const length = classList.length;\n    let c = '';\n\n    for (let i = 0; i < length; i++) {\n      c = classList[i];\n      if (c.indexOf('valid') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if ((new CvvValidator).validate(value)) {\n      classList.push('valid');\n    } else {\n      classList.push('invalid');\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.validateExpiration\n   *\n   * Validates a target element's value based on the\n   * current date. Adds a class to the target element\n   * to note `valid` or `invalid`.\n   *\n   * @param {Event} e\n   */\n  public static validateExpiration(e: Event) {\n    const target = <HTMLInputElement>(e.currentTarget ? e.currentTarget : e.srcElement);\n    const value = target.value;\n    const classList = target.className.split(' ');\n    const length = classList.length;\n    let c = '';\n\n    for (let i = 0; i < length; i++) {\n      c = classList[i];\n      if (c.indexOf('valid') !== -1) {\n        delete classList[i];\n      }\n    }\n\n    if ((new ExpirationValidator).validate(value)) {\n      classList.push('valid');\n    } else {\n      classList.push('invalid');\n    }\n\n    target.className = classList.join(' ').replace(/^\\s+|\\s+$/gm, '');\n  }\n\n  /**\n   * Heartland.Card.attachNumberEvents\n   *\n   * @param {string} selector\n   */\n  public static attachNumberEvents(selector: string) {\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(19));\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.deleteProperly);\n    Events.addHandler(document.querySelector(selector), 'input', Card.formatNumber);\n    Events.addHandler(document.querySelector(selector), 'input', Card.validateNumber);\n    Events.addHandler(document.querySelector(selector), 'input', Card.addType);\n  }\n\n  /**\n   * Heartland.Card.attachExpirationEvents\n   *\n   * @param {string} selector\n   */\n  public static attachExpirationEvents(selector: string) {\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(9));\n    Events.addHandler(document.querySelector(selector), 'keyup', Card.formatExpiration);\n    Events.addHandler(document.querySelector(selector), 'blur', Card.formatExpiration);\n    Events.addHandler(document.querySelector(selector), 'input', Card.validateExpiration);\n    Events.addHandler(document.querySelector(selector), 'blur', Card.validateExpiration);\n  }\n\n  /**\n   * Heartland.Card.attachCvvEvents\n   *\n   * @param {string} selector\n   */\n  public static attachCvvEvents(selector: string) {\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictNumeric);\n    Events.addHandler(document.querySelector(selector), 'keydown', Card.restrictLength(4));\n    Events.addHandler(document.querySelector(selector), 'input', Card.validateCvv);\n  }\n}\n\nif (!Array.prototype.indexOf) {\n  Array.prototype.indexOf = function (obj, start) {\n    for (let i = (start || 0), j = this.length; i < j; i++) {\n      if (this[i] === obj) { return i; }\n    }\n    return -1;\n  };\n}\n","export const urls = {\n  CERT: 'https://cert.api2.heartlandportico.com/Hps.Exchange.PosGateway.Hpf.v1/api/token',\n  PROD: 'https://api.heartlandportico.com/SecureSubmit.v1/api/token',\n  iframeCERT: 'https://hps.github.io/token/2.1/',\n  iframePROD: 'https://api.heartlandportico.com/SecureSubmit.v1/token/2.1/'\n};\n","import {HPS} from \"./HPS\";\n\n/**\n * @namespace Heartland.Styles\n */\nexport module Styles {\n  /**\n   * Heartland.Styles.Defaults\n   *\n   * Collection of helper functions for applying default styles to a child\n   * window's fields. Serves as an example of these methods' use in merchant\n   * modifications. Each function expects a `Heartland.HPS` object to be passed\n   * as an argument.\n   */\n  export const Defaults = {\n    body: function (hps: HPS) {\n      hps.setStyle('heartland-body',\n        'margin: 0;' +\n        'font-family: Arial, \\'Helvetica Neue\\', Helvetica, sans-serif;' +\n        'color: #666;'\n      );\n    },\n    cvv: function (hps: HPS) {\n      hps.appendStyle('heartland-cvv', 'width: 110px;');\n    },\n    cvvContainer: function (hps: HPS) {\n      hps.setStyle('heartland-cvv-container',\n        'width: 110px;' +\n        'display: inline-block;' +\n        'float: left;'\n      );\n    },\n    fieldset: function (hps: HPS) {\n      hps.setStyle('heartland-expiration-date-container',\n        'border: 0;' +\n        'margin: 0 25px 0px 1px;' +\n        'padding: 0;' +\n        'width: 173px;' +\n        'display: inline-block;' +\n        'float:  left;'\n      );\n    },\n    inputsAndSelects: function (hps: HPS) {\n      const ids = [\n        'heartland-card-number',\n        'heartland-expiration-month',\n        'heartland-expiration-year',\n        'heartland-cvv'\n      ];\n      const length = ids.length;\n      let i = 0;\n      for (i; i < length; i++) {\n        hps.setStyle(ids[i],\n          'width: 309px;' +\n          'padding: 5px;' +\n          'font-size: 14px;' +\n          'margin: 3px 0px 15px 0px;' +\n          'border: 1px #ccc solid;' +\n          /* IE10 Consumer Preview */\n          'background-image: -ms-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* Mozilla Firefox */\n          'background-image: -moz-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* Opera */\n          'background-image: -o-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* Webkit (Safari/Chrome 10) */\n          'background-image: -webkit-gradient(linear, left bottom, left top, color-stop(0, #F7F7F7), color-stop(1, #EFEFEF));' +\n          /* Webkit (Chrome 11+) */\n          'background-image: -webkit-linear-gradient(bottom, #F7F7F7 0%, #EFEFEF 100%);' +\n          /* W3C Markup, IE10 Release Preview */\n          'background-image: linear-gradient(to top, #F7F7F7 0%, #EFEFEF 100%);'\n        );\n      }\n    },\n    labelsAndLegend: function (hps: HPS) {\n      const ids = [\n        'heartland-card-number-label',\n        'heartland-expiration-date-legend',\n        'heartland-expiration-month-label',\n        'heartland-expiration-year-label',\n        'heartland-cvv-label'\n      ];\n      const length = ids.length;\n      let i = 0;\n      for (i; i < length; i++) {\n        hps.setStyle(ids[i],\n          'font-size: 13px;' +\n          'text-transform: uppercase;' +\n          'font-weight: bold;' +\n          'display: block;' +\n          'width: 100%;' +\n          'clear: both;'\n        );\n      }\n    },\n    selectLabels: function (hps: HPS) {\n      const ids = ['heartland-expiration-month-label', 'heartland-expiration-year-label'];\n      const length = ids.length;\n      let i = 0;\n      for (i; i < length; i++) {\n        hps.setStyle(ids[i],\n          'position:absolute;' +\n          'width:1px;' +\n          'height:1px;' +\n          'padding:0;' +\n          'margin:-1px;' +\n          'overflow:hidden;' +\n          'clip:rect(0,0,0,0);' +\n          'border:0;'\n        );\n      }\n    },\n    selects: function (hps: HPS) {\n      const ids = ['heartland-expiration-month', 'heartland-expiration-year'];\n      const length = ids.length;\n      let i = 0;\n      for (i; i < length; i++) {\n        hps.appendStyle(ids[i],\n          'border: 0;' +\n          'outline: 1px solid #ccc;' +\n          'height: 28px;' +\n          'width: 80px;' +\n          '-webkit-appearance: none;' +\n          '-moz-appearance: none;' +\n          '-webkit-border-radius: 0px;' +\n          /* tslint:disable:max-line-length */\n          'background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDE0IDc5LjE1Njc5NywgMjAxNC8wOC8yMC0wOTo1MzowMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzA5MTZFN0RFMDY2MTFFNEIyODZFMURFRTA3REUxMjciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzA5MTZFN0VFMDY2MTFFNEIyODZFMURFRTA3REUxMjciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDMDkxNkU3QkUwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDMDkxNkU3Q0UwNjYxMUU0QjI4NkUxREVFMDdERTEyNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvMrdUAAAABiSURBVHjaYkxLS3vNwMAgwoAfvGUCEjkMhEE285kzZ65u2bLlJ5DjgkNRxUwgYPz//z+Yl56ePhNIpaEpAqnJADGYkASzgHgnEn8HyEoYB24i1FReILUPynUEmvYFJgcQYACYah+uDhpKGAAAAABJRU5ErkJggg==);' +\n          /* tslint:enable:max-line-length */\n          'background-position: 65px 12px;' +\n          'background-repeat: no-repeat;' +\n          'background-color:  #F7F7F7;' +\n          'float: left;' +\n          'margin-right: 6px'\n        );\n      }\n    }\n  };\n}\n","import {Ajax} from \"./Ajax\";\nimport {Card} from \"./Card\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport {CardData} from \"./types/CardData\";\nimport {CardType} from \"./types/CardType\";\nimport {Options} from \"./types/Options\";\nimport {TokenizationResponse} from \"./types/TokenizationResponse\";\nimport {urls} from \"./vars/urls\";\n\n/**\n * @namespace Heartland.Util\n */\nexport class Util {\n  /**\n   * Heartland.Util.getCardType\n   *\n   * Parses a credit card number to obtain the card type/brand.\n   *\n   * @param {string} tokenizationType\n   * @param {Heartland.Options} options\n   */\n  public static getCardType(tokenizationType: string, options: Options) {\n    let cardType: CardType;\n    let data = '';\n    let type = 'unknown';\n\n    switch (tokenizationType) {\n      case 'swipe':\n        data = options.track;\n        cardType = Card.typeByTrack(data);\n        break;\n      case 'encrypted':\n        data = options.track;\n        cardType = Card.typeByTrack(data, true, options.trackNumber);\n        break;\n      default:\n        data = options.cardNumber;\n        cardType = Card.typeByNumber(data);\n        break;\n    }\n\n    if (cardType) {\n      type = cardType.code;\n    }\n\n    return type;\n  }\n\n  /**\n   * Heartland.Util.applyOptions\n   *\n   * Creates a single object by merging a `source` (default) and `properties`\n   * obtained elsewhere, e.g. a function argument in `HPS`. Any properties in\n   * `properties` will overwrite matching properties in `source`.\n   *\n   * @param {Heartland.Options} source\n   * @param {Heartland.Options} properties\n   * @returns {Heartland.Options}\n   */\n  public static applyOptions(source: Options, properties: Options) {\n    const destination: Options = {};\n\n    if (!source) {\n      source = {};\n    }\n\n    for (const property in source) {\n      if (source.hasOwnProperty(property)) {\n        (<any>destination)[property] = (<any>source)[property];\n      }\n    }\n\n    for (const property in properties) {\n      if (properties.hasOwnProperty(property)) {\n        (<any>destination)[property] = (<any>properties)[property];\n      }\n    }\n\n    return destination;\n  }\n\n  /**\n   * Heartland.Util.throwError\n   *\n   * Allows a merchant-defined error handler to be used in cases where the\n   * tokenization process fails. If not provided, we throw the message as a\n   * JS runtime error.\n   *\n   * @param {Heartland.Options} options\n   * @param {string | Heartland.TokenizationResponse} errorMessage\n   */\n  public static throwError(options: Options, errorMessage: string | TokenizationResponse) {\n    if (typeof (options.error) === 'function') {\n      options.error(errorMessage);\n    } else {\n      throw errorMessage;\n    }\n  }\n\n  /**\n   * Heartland.Util.getItemByPropertyValue\n   *\n   * Enumerates over a `collection` to retreive an item whose `property` is\n   * a given `value`.\n   *\n   * @param {any} collection\n   * @param {string} property\n   * @param {any} value\n   * @returns {any}\n   */\n  public static getItemByPropertyValue(collection: any, property: string, value: any) {\n    const length = collection.length;\n    let i = 0;\n\n    for (i; i < length; i++) {\n      if (collection[i][property] === value) {\n        return collection[i];\n      }\n    }\n  }\n\n  /**\n   * Heartland.Util.getParams\n   *\n   * Builds param list for a particular `type` from expected properties in\n   * `data`.\n   *\n   * @param {string} type - The tokenization type\n   * @param {Heartland.Options} data\n   * @returns {string}\n   */\n  public static getParams(type: string, data: Options) {\n    const params: Array<string> = [];\n    switch (type) {\n      case 'pan':\n        params.push(\n          'token_type=supt',\n          'object=token',\n          '_method=post',\n          'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Bnumber%5D=' + data.cardNumber.replace(/\\s/g, ''),\n          'card%5Bexp_month%5D=' + data.cardExpMonth.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Bexp_year%5D=' + data.cardExpYear.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Bcvc%5D=' + data.cardCvv.replace(/^\\s+|\\s+$/g, '')\n        );\n        break;\n      case 'swipe':\n        params.push(\n          'token_type=supt',\n          'object=token',\n          '_method=post',\n          'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''),\n          'card%5Btrack_method%5D=swipe',\n          'card%5Btrack%5D=' + encodeURIComponent(data.track.replace(/^\\s+|\\s+$/g, ''))\n        );\n        break;\n      case 'encrypted':\n        params.push(\n          'token_type=supt',\n          'object=token',\n          '_method=post',\n          'api_key=' + data.publicKey.replace(/^\\s+|\\s+$/g, ''),\n          'encryptedcard%5Btrack_method%5D=swipe',\n          'encryptedcard%5Btrack%5D=' + encodeURIComponent(data.track.replace(/^\\s+|\\s+$/g, '')),\n          'encryptedcard%5Btrack_number%5D=' + encodeURIComponent(data.trackNumber.replace(/^\\s+|\\s+$/g, '')),\n          'encryptedcard%5Bktb%5D=' + encodeURIComponent(data.ktb.replace(/^\\s+|\\s+$/g, '')),\n          'encryptedcard%5Bpin_block%5D=' + encodeURIComponent(data.pinBlock.replace(/^\\s+|\\s+$/g, ''))\n        );\n        break;\n      default:\n        Util.throwError(data, 'unknown params type');\n        break;\n    }\n    return params.join('&');\n  }\n\n  /**\n   * Heartland.Util.getUrlByEnv\n   *\n   * Selects the appropriate tokenization service URL for the\n   * active `publicKey`.\n   *\n   * @param {Heartland.Options} options\n   * @returns {string}\n   */\n  public static getUrlByEnv(options: Options) {\n    options.env = options.publicKey.split('_')[1];\n\n    if (options.env === 'cert') {\n      options.gatewayUrl = urls.CERT;\n    } else {\n      options.gatewayUrl = urls.PROD;\n    }\n\n    return options;\n  }\n\n  /**\n   * Heartland.Util.addFormHandler\n   *\n   * Creates and adds an event handler function for the submission for a given\n   * form (`options.form_id`).\n   *\n   * @param {Heartland.Options} options\n   * @listens submit\n   */\n  public static addFormHandler(options: Options) {\n    const payment_form = document.getElementById(options.formId);\n\n    const code = function (e: Event) {\n      if (e.preventDefault) {\n        e.preventDefault();\n      } else if (window.event) /* for ie */ {\n        window.event.returnValue = false;\n      }\n\n      const fields = Util.getFields(options.formId);\n      const cardType = Util.getCardType(fields.number, 'pan');\n\n      options.cardNumber = fields.number;\n      options.cardExpMonth = fields.expMonth;\n      options.cardExpYear = fields.expYear;\n      options.cardCvv = fields.cvv;\n      options.cardType = cardType;\n\n      Ajax.call('pan', options);\n    };\n\n    Events.addHandler(payment_form, 'submit', code);\n    DOM.addField(options.formId, 'hidden', 'publicKey', options.publicKey);\n  }\n\n  /**\n   * Heartland.Util.getFields\n   *\n   * Extracts card information from the fields with names `card_number`,\n   * `card_expiration_month`, `card_expiration_year`, and `card_cvc` and\n   * expects them to be present as children of `formParent`.\n   *\n   * @param {string} formParent\n   * @returns {Heartland.CardData}\n   */\n  public static getFields(formParent: string): CardData {\n    const form = document.getElementById(formParent);\n    const fields: CardData = {};\n    let i: number;\n    const length = form.childElementCount;\n\n    for (i = 0; i < length; i++) {\n      const element = <HTMLInputElement>form.children[i];\n      if (element.id === 'card_number') {\n        fields.number = element.value;\n      } else if (element.id === 'card_expiration_month') {\n        fields.expMonth = element.value;\n      } else if (element.id === 'card_expiration_year') {\n        fields.expYear = element.value;\n      } else if (element.id === 'card_cvc') {\n        fields.cvv = element.value;\n      }\n    }\n\n    return fields;\n  }\n}\n","import {DOM} from \"./DOM.ts\";\nimport {Util} from \"./Util.ts\";\nimport {Options} from \"./types/Options\";\nimport {TokenizationResponse} from \"./types/TokenizationResponse\";\n\ninterface Request {\n    url?: string;\n    payload?: string;\n}\n\n/**\n * @namespace Heartland.Ajax\n */\nexport class Ajax {\n  /**\n   * Heartland.Ajax.call\n   *\n   * Sets up a request to be passed to `Heartland.Ajax.jsonp`. On successful tokenization,\n   * `options.success` will be called with the tokenization data as the only\n   * argument passed.\n   *\n   * @param {string} type\n   * @param {Heartland.Options} options\n   */\n  public static call(type: string, options: Options) {\n    const cardType = Util.getCardType(type, options);\n    const params = Util.getParams(type, options);\n    const request: Request = {\n        payload: params,\n        url: options.gatewayUrl\n    };\n\n    Ajax.jsonp(request, function (data) {\n      if (data.error) {\n        Util.throwError(options, data);\n      } else {\n        const card = data.card || data.encryptedcard;\n        const lastfour = card.number.slice(-4);\n\n        data.last_four = lastfour;\n        data.card_type = cardType;\n        data.exp_month = options.cardExpMonth;\n        data.exp_year = options.cardExpYear;\n\n        if (options.formId && options.formId.length > 0) {\n          DOM.addField(options.formId, 'hidden', 'token_value', data.token_value);\n          DOM.addField(options.formId, 'hidden', 'last_four', lastfour);\n          DOM.addField(options.formId, 'hidden', 'card_exp_year', options.cardExpYear);\n          DOM.addField(options.formId, 'hidden', 'card_exp_month', options.cardExpMonth);\n          DOM.addField(options.formId, 'hidden', 'card_type', cardType);\n        }\n\n        options.success(data);\n      }\n    });\n  }\n\n  /**\n   * Heartland.Ajax.jsonp\n   *\n   * Creates a new DOM node containing a created JSONP callback handler for an\n   * impending Ajax JSONP request. Removes need for `XMLHttpRequest`.\n   *\n   * @param {string} url\n   * @param {function} callback\n   */\n  private static jsonp(request: Request, callback: (data: TokenizationResponse) => void) {\n    const script = document.createElement('script');\n    const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());\n    (<any>window)[callbackName] = function (data: TokenizationResponse): void {\n      (<any>window)[callbackName] = undefined;\n      document.body.removeChild(script);\n      callback(data);\n    };\n\n    script.src = request.url + (request.url.indexOf('?') >= 0 ? '&' : '?') + 'callback=' + callbackName\n        + '&' + request.payload;\n    document.body.appendChild(script);\n  }\n\n  /**\n   * Heartland.Ajax.cors\n   *\n   * Creates a new XMLHttpRequest object for a POST request to the given `url`.\n   *\n   * @param {string} url\n   * @param {function} callback\n   */\n  private static cors(request: Request, payload: string, callback: (data: TokenizationResponse) => void) {\n    let xhr: any;\n    let method = 'POST';\n    let timeout: number;\n\n    if ((new XMLHttpRequest()).withCredentials === undefined) {\n      xhr = new (<any>window).XDomainRequest();\n      method = 'GET';\n      request.url = request.url.split('?')[0];\n      request.url = request.url + '?' + request.payload;\n      payload = null;\n      xhr.open(method, request.url);\n    } else {\n      xhr = new XMLHttpRequest();\n      xhr.open(method, request.url);\n      xhr.setRequestHeader(\n        'Content-Type',\n        'application/x-www-form-urlencoded'\n      );\n    }\n    const cb = function (e: Event) {\n      clearTimeout(timeout);\n\n      if (e.type === 'error') {\n        callback({error: {message: 'communication error'}});\n        return;\n      }\n\n      if (xhr.readyState === 4 || (xhr.readyState !== 4 && xhr.responseText !== '')) {\n        const data = JSON.parse(xhr.responseText);\n        callback(data);\n      } else {\n        callback({error: {message: 'no data'}});\n      }\n    };\n\n    xhr.onload = cb;\n    xhr.onerror = cb;\n    xhr.send(payload);\n    timeout = setTimeout(function () {\n      xhr.abort();\n      callback({error: {message: 'timeout'}});\n    }, 5000);\n  }\n}\n","import {CardNumber} from \"./CardNumber\";\nimport {Expiration} from \"./Expiration\";\n\nexport default {\n    CardNumber: CardNumber,\n    Expiration: Expiration\n}\n","import {Options} from \"../types/Options\";\n\nexport const defaults: Options = {\n  _method: 'post',\n  buttonTarget: '',\n  cardCvv: '',\n  cardExpMonth: '',\n  cardExpYear: '',\n  cardNumber: '',\n  cardType: '',\n  env: 'prod',\n  error: null,\n  fields: {},\n  formId: '',\n  gatewayUrl: '',\n  iframeTarget: '',\n  ktb: '',\n  object: 'token',\n  onEvent: null,\n  onTokenError: null,\n  onTokenSuccess: null,\n  pinBlock: '',\n  publicKey: '',\n  success: null,\n  targetType: '',\n  tokenType: 'supt',\n  track: '',\n  trackNumber: '',\n  type: 'pan',\n  useDefaultStyles: true\n};\n","export const fields = [\n  'cardNumber',\n  'cardCvv',\n  'cardExpiration',\n  'submit'\n];\n","import {Events} from \"./Events\";\nimport {HPS} from \"./HPS\";\n\n/**\n * Heartland.Messages\n *\n * Initializes a new object for wrapping `window.postMessage` and a fallback\n * method for legacy browsers.\n */\nexport class Messages {\n  hps: HPS;\n  intervalId: number;\n  lastHash: string;\n  pushIntervalStarted: boolean;\n  private callback: (m: any) => any;\n\n  /**\n   * Heartland.Messages (constructor)\n   *\n   * @constructor\n   * @param {Heartland.HPS} hps\n   * @returns {Heartland.Messages}\n   */\n  constructor(hps: HPS) {\n    this.hps = hps;\n    this.intervalId = null;\n    this.lastHash = '';\n    this.pushIntervalStarted = false;\n  }\n\n  /**\n   * Heartland.Messages.pushMessages\n   *\n   * For legacy browsers, a mailbox (buffer) must be used to ensure all messages\n   * are sent between parent and child windows. When ready, this function builds\n   * the final message, encodes it, sends it, and resets the mailbox to `[]`.\n   *\n   * @param {Heartland.HPS} hps\n   * @returns {function}\n   */\n  pushMessages(hps: HPS): () => void {\n    return function () {\n      const data: Array<any> = [];\n      const messageArr: Array<any> = [];\n      let i = 0;\n      let targetUrl = '';\n      let current: any;\n      let targetNode: Window;\n      const re = /^#?\\d+&/;\n\n      const length = hps.mailbox.length;\n      if (!length) {\n        return;\n      }\n\n      for (i = 0; i < length; i++) {\n        current = hps.mailbox.shift();\n        if (!targetUrl) {\n          targetUrl = current.targetUrl;\n          targetNode = current.targetNode;\n        }\n        messageArr.push(current.message);\n      }\n\n      current = null;\n      if (re.test(window.location.hash)) {\n        current = JSON.parse(decodeURIComponent(window.location.hash.replace(re, '')));\n        data.concat(current);\n      }\n\n      if (messageArr !== []) {\n        hps.cacheBust = hps.cacheBust || 1;\n        data.push({ data: messageArr, source: { name: hps.field || 'parent' } });\n        const message = JSON.stringify(data);\n        const url = targetUrl.replace(/#.*$/, '') + '#' +\n          (+new Date()) + (hps.cacheBust++) + '&' +\n          encodeURIComponent(message);\n        if (targetNode.location) {\n          targetNode.location.href = url;\n        } else {\n          (<any>targetNode).src = url;\n        }\n      }\n\n      messageArr.length = 0;\n      hps.mailbox.length = 0;\n    };\n  }\n\n  /**\n   * Heartland.Messages.post\n   *\n   * When present, wraps the built-in `window.postMessage`. When not present,\n   * pushes the message onto the mailbox for eventual sending, and on first use,\n   * starts the interval for `Messages.pushMessages`.\n   *\n   * @param {Object | string} message\n   * @param {string} target\n   */\n  post(message: Object | string, target: string): void {\n    let  targetNode: Window;\n\n    (<any>message).source = (<any>message).source || {};\n    (<any>message).source.name = window.name;\n\n    if (!this.hps.frames) {\n      return;\n    }\n\n    const frame = (<any>this.hps.frames)[target] || (<any>this.hps)[target];\n\n    if (!frame) {\n      return;\n    }\n\n    const targetUrl = (<any>this.hps.frames)[target].url;\n\n    try {\n      if (typeof frame.targetNode !== 'undefined') {\n        targetNode = frame.targetNode;\n      } else if (typeof frame.frame !== 'undefined') {\n        targetNode = frame.frame;\n      }\n    } catch (e) {\n      targetNode = frame;\n    }\n\n    if (window.postMessage) {\n      targetNode.postMessage(\n        JSON.stringify(message),\n        targetUrl\n      );\n    } else {\n      this.hps.mailbox = this.hps.mailbox || [];\n      this.hps.mailbox.push({\n        message: message,\n        targetNode: targetNode,\n        targetUrl: targetUrl\n      });\n      if (!this.pushIntervalStarted) {\n        setInterval(this.pushMessages(this.hps), 10);\n      }\n    }\n  }\n\n  /**\n   * Heartland.Messages.receive\n   *\n   * When present, wraps the built-in `window.postMesage`'s `message` or\n   * `onmessage` window events. When not present, uses a single interval to\n   * check for changes to `window.location.hash` when the other window sends a\n   * message and will decode the JSON and URI encoded hash.\n   *\n   * @param {Function} callback\n   * @param {string} sourceOrigin\n   */\n  receive(callback: Function, sourceOrigin: string): void {\n    if (window.postMessage) {\n      this.callback = function (m) {\n        callback(JSON.parse(m.data));\n      };\n      if (window.addEventListener) {\n        window.addEventListener('message', this.callback, !1);\n      } else {\n        (<any>window).attachEvent('onmessage', this.callback);\n      }\n    } else {\n      if (this.intervalId) {\n        clearInterval(this.intervalId);\n      }\n      this.intervalId = null;\n\n      if (callback) {\n        this.intervalId = setInterval(function () {\n          const hash = document.location.hash,\n            re = /^#?\\d+&/;\n          if (hash !== this.lastHash && re.test(hash)) {\n            const data = JSON.parse(decodeURIComponent(hash.replace(re, '')));\n            this.lastHash = hash;\n\n            for (const i in data) {\n              const m = data[i];\n              if (Object.prototype.toString.call(m.data) !== '[object Array]') {\n                callback(m);\n                continue;\n              }\n\n              for (const j in m.data) {\n                callback({ data: m.data[j], source: m.source });\n              }\n            }\n          }\n        }, 100);\n      }\n    }\n    Events.trigger('receiveMessageHandlerAdded', document);\n  }\n\n  /**\n   * Heartland.Messages.removeReceiver\n   *\n   * Removes active `message` event handler function.\n   */\n  removeReceiver() {\n    if (window.addEventListener) {\n      window.removeEventListener('message', this.callback, !1);\n    } else {\n      (<any>window).detachEvent('onmessage', this.callback);\n    }\n  }\n\n  /**\n   * Heartland.Messages.dispose\n   *\n   * Removes active `message` event handler function and any\n   * active intervals.\n   */\n  dispose(): void {\n    this.removeReceiver();\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n    }\n  }\n}\n","import {defaults} from \"./vars/defaults\";\nimport {fields} from \"./vars/fields\";\nimport {urls} from \"./vars/urls\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport {HPS} from \"./HPS\";\nimport {Messages} from \"./Messages\";\nimport {Styles} from \"./Styles\";\n\n/**\n * @namespace Heartland.Frames\n */\nexport class Frames {\n  /**\n   * Heartland.Frames.configureIframe\n   *\n   * Prepares the pages iFrames for communication with the parent window.\n   *\n   * @param {Heartland.HPS} hps\n   * @listens click\n   * @listens message\n   */\n  public static configureIframe(hps: HPS) {\n    let frame: any;\n    let options = hps.options;\n    let target: HTMLElement;\n    let useDefaultStyles = true;\n    hps.Messages = hps.Messages || new Messages(hps);\n\n    if (options.env === 'cert') {\n      hps.iframe_url = urls.iframeCERT;\n    } else {\n      hps.iframe_url = urls.iframePROD;\n    }\n\n    if (options.fields !== defaults.fields) {\n      Frames.makeFieldsAndLink(hps);\n    }\n\n    if (options.fields === defaults.fields && options.iframeTarget) {\n      target = document.getElementById(options.iframeTarget);\n      if (options.targetType === 'myframe') {\n        frame = target;\n        hps.iframe_url = frame.src;\n      } else {\n        frame = DOM.makeFrame('heartland-frame-securesubmit');\n        target.appendChild(frame);\n      }\n\n      hps.iframe_url = hps.iframe_url + '#' + encodeURIComponent(document.location.href.split('#')[0]);\n      frame.src = hps.iframe_url;\n\n      hps.frames.child = {\n        frame: window.postMessage ? frame.contentWindow : frame,\n        name: 'child',\n        url: hps.iframe_url\n      };\n    }\n\n    if (options.useDefaultStyles === false) {\n      useDefaultStyles = false;\n    }\n\n    if (options.buttonTarget) {\n      hps.clickHandler = function (e) {\n        e.preventDefault();\n        hps.Messages.post(\n          {\n            accumulateData: !!hps.frames.cardNumber,\n            action: 'tokenize',\n            message: options.publicKey\n          },\n          hps.frames.cardNumber ? 'cardNumber' : 'child'\n        );\n        return false;\n      };\n      Events.addHandler(options.buttonTarget, 'click', hps.clickHandler);\n    }\n\n    hps.Messages.receive(function (data: any) {\n      let fieldFrame: any;\n\n      try {\n        fieldFrame = (<any>hps.frames)[data.source.name === 'heartland-frame-securesubmit' ? 'parent' : data.source.name];\n      } catch (e) { return; }\n\n      switch (data.action) {\n        case 'requestTokenize':\n          hps.Messages.post(\n            {\n              accumulateData: !!hps.frames.cardNumber,\n              action: 'tokenize',\n              message: options.publicKey\n            },\n            hps.frames.cardNumber ? 'cardNumber' : 'child'\n          );\n          break;\n        case 'onTokenSuccess':\n          options.onTokenSuccess(data.response);\n          break;\n        case 'onTokenError':\n          options.onTokenError(data.response);\n          break;\n        case 'resize':\n          if (fieldFrame) {\n            hps.resizeIFrame(fieldFrame.frame, data.height);\n          } else {\n            hps.resizeIFrame(frame, data.height);\n          }\n\n          break;\n        case 'receiveMessageHandlerAdded':\n          if (!options.fields && useDefaultStyles) {\n            Styles.Defaults.body(hps);\n            Styles.Defaults.labelsAndLegend(hps);\n            Styles.Defaults.inputsAndSelects(hps);\n            Styles.Defaults.fieldset(hps);\n            Styles.Defaults.selects(hps);\n            Styles.Defaults.selectLabels(hps);\n            Styles.Defaults.cvvContainer(hps);\n            Styles.Defaults.cvv(hps);\n          }\n\n          if (fieldFrame && fieldFrame.options.placeholder) {\n            hps.Messages.post(\n              {\n                action: 'setPlaceholder',\n                id: 'heartland-field',\n                text: fieldFrame.options.placeholder\n              },\n              fieldFrame.name\n            );\n          }\n\n          if (options.style) {\n            const css = options.styleString\n              || (options.styleString = DOM.json2css(options.style));\n            hps.Messages.post(\n              {\n                action: 'addStylesheet',\n                data: css\n              },\n              fieldFrame.name\n            );\n          }\n\n          Events.trigger('securesubmitIframeReady', document);\n          break;\n        case 'accumulateData':\n          for (const i in hps.frames) {\n            if ('submit' === i || 'cardNumber' === i) {\n              continue;\n            }\n            const field = (<any>hps.frames)[i];\n            hps.Messages.post(\n              {\n                action: 'getFieldData',\n                id: 'heartland-field'\n              },\n              field.name\n            );\n          }\n          break;\n        case 'passData':\n          const cardNumberFieldFrame = hps.frames.cardNumber;\n          if (!cardNumberFieldFrame) {\n            break;\n          }\n\n          hps.Messages.post(\n            {\n              action: 'setFieldData',\n              id: fieldFrame.name,\n              value: data.value\n            },\n            cardNumberFieldFrame.name\n          );\n          break;\n        case 'fieldEvent':\n          if (!options.onEvent) {\n            break;\n          }\n          options.onEvent(data.event);\n          break;\n        case 'error':\n          if (!options.onError) {\n            break;\n          }\n          options.onError(data);\n          break;\n      }\n    }, '*');\n\n\n    // monitorFieldEvents(hps, )\n  }\n\n  /**\n   * Heartland.Frames.makeFieldsAndLink\n   *\n   * Creates a set of single field iFrames and stores a reference to\n   * them in the parent window's state.\n   *\n   * @param {Heartland.HPS} hps\n   */\n  public static makeFieldsAndLink(hps: HPS) {\n    const options = hps.options;\n    const fieldsLength = fields.length;\n    const baseUrl = hps.iframe_url.replace('index.html', '');\n\n    for (let i = 0; i < fieldsLength; i++) {\n      const field = fields[i];\n      const fieldOptions = options.fields[field];\n\n      if (!fieldOptions) { return; }\n\n      const frame = DOM.makeFrame(field);\n      let url = baseUrl;\n      if (field === 'submit') {\n        url = url + 'button.html';\n      } else {\n        url = url + 'field.html';\n      }\n      url = url + '#' + field + ':' + encodeURIComponent(document.location.href.split('#')[0]);\n      frame.src = url;\n\n      document\n        .getElementById(fieldOptions.target)\n        .appendChild(frame);\n\n      (<any>hps.frames)[field] = {\n        frame: frame,\n        name: field,\n        options: fieldOptions,\n        target: fieldOptions.target,\n        targetNode: window.postMessage ? frame.contentWindow : frame,\n        url: url\n      };\n    }\n  }\n\n  /**\n   * Heartland.Frames.monitorFieldEvents\n   *\n   * @param {Heartland.HPS} hps\n   * @param {string | EventTarget} target\n   */\n  public static monitorFieldEvents(hps: HPS, target: string | EventTarget) {\n    const events = ['click', 'blur', 'focus', 'change', 'keypress', 'keydown', 'keyup'];\n    let i = 0, length = events.length;\n\n    for (i; i < length; i++) {\n      const event = events[i];\n      Events.addHandler(target, event, function (e: Event) {\n        const field = document.getElementById('heartland-field');\n        let classes: string[] = [];\n        const data: any = {};\n\n        if (field.className !== '') {\n          classes = field.className.split(' ');\n        }\n\n        if ((<any>e).keyCode) {\n          data.keyCode = (<any>e).keyCode;\n        }\n\n        hps.Messages.post(\n          {\n            action: 'fieldEvent',\n            event: {\n              classes: classes,\n              data: data,\n              source: window.name,\n              type: e.type\n            }\n          },\n          'parent'\n        );\n      });\n    }\n  }\n}\n","import {defaults} from \"./vars/defaults\";\n\nimport {Ajax} from \"./Ajax\";\nimport {Card} from \"./Card\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport {Frames} from \"./Frames\";\nimport {Messages} from \"./Messages\";\nimport {Util} from \"./Util\";\n\nimport {Options} from \"./types/Options\";\n\ninterface Frame {\n  frame?: Window;\n  name?: string;\n  options?: any;\n  target?: string;\n  targetNode?: EventTarget;\n  url?: string;\n}\n\ninterface FrameCollection {\n  cardNumber?: Frame;\n  cardExpiration?: Frame;\n  cardCvv?: Frame;\n  submit?: Frame;\n  child?: Frame;\n  parent?: Frame;\n}\n\n/**\n * Heartland.HPS\n *\n * Initializes options and adds the default form handler if a `formId` is\n * passed as an option. This expects the default fields (see `getFields`) to\n * be present as children of `formId`.\n */\nexport class HPS {\n  options: Options;\n  frames: FrameCollection;\n  iframe_url: string;\n  Messages: Messages;\n  mailbox: any; // [];\n  cacheBust: number;\n  parent: Window;\n  field: string;\n  clickHandler: (e: Event) => void;\n  loadHandler: () => void;\n  receiveMessageHandlerAddedHandler: () => void;\n\n  /**\n   * Heartland.HPS (constructor)\n   *\n   * @constructor\n   * @param {Heartland.Options} options [optional]\n   * @returns {Heartland.HPS}\n   */\n  constructor(options?: Options) {\n    if (!options && window.parent) {\n      return;\n    }\n\n    this.options = Util.applyOptions(defaults, options);\n    this.options = Util.getUrlByEnv(this.options);\n\n    if (this.options.formId.length > 0) {\n      Util.addFormHandler(this.options);\n    }\n\n    this.frames = {};\n    if (this.options.type === 'iframe') {\n      this.iframe_url = '';\n\n      this.Messages = new Messages(this);\n      this.mailbox = [];\n      this.cacheBust = 1;\n      Frames.configureIframe(this);\n    }\n\n    return this;\n  }\n\n  /**\n   * Heartland.HPS.tokenize\n   *\n   * Tokenizes card data. Used in manual integrations where the merchant's\n   * credit card fields cannot/do not match the names expected in the default\n   * form handler (see `getFields`).\n   *\n   * @param {Heartland.Options} options [optional]\n   */\n  tokenize(options?: Options): void {\n    options = options || {};\n    if (options) {\n      this.options = Util.applyOptions(this.options, options);\n      this.options = Util.getUrlByEnv(this.options);\n    }\n    if (this.options.type === 'iframe') {\n      this.Messages.post(\n        {\n          action: 'tokenize',\n          message: this.options.publicKey\n        },\n        'child'\n      );\n      return;\n    }\n    Ajax.call(this.options.type, this.options);\n  };\n\n  /**\n   * Heartland.HPS.configureInternalIframe\n   *\n   * Sets up a child iframe window to prepare it for communication with the\n   * parent and for tokenization.\n   *\n   * @param {Heartland.Options} options\n   */\n  configureInternalIframe(options: Options): void {\n    this.Messages = new Messages(this);\n    this.parent = window.parent;\n    this.frames = this.frames || {};\n    this.frames.parent = {\n      frame: window.parent,\n      name: 'parent',\n      url: decodeURIComponent(document.location.hash.replace(/^#/, ''))\n    };\n\n    this.loadHandler = (function (hps: HPS) {\n      return function () {\n        DOM.resizeFrame(hps);\n      };\n    } (this));\n\n    this.receiveMessageHandlerAddedHandler = (function (hps: HPS) {\n      return function () {\n        hps.Messages.post({ action: 'receiveMessageHandlerAdded' }, 'parent');\n      };\n    } (this));\n\n    Events.addHandler(window, 'load', this.loadHandler);\n    Events.addHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n\n    this.Messages.receive(Events.frameHandleWith(this), '*');\n  };\n\n  /**\n   * Heartland.HPS.configureButtonFieldIframe\n   *\n   * Same as `Heartland.HPS.configureFieldIframe` excet the added click event\n   * handler for the button.\n   *\n   * @param {Heartland.Options} options\n   */\n  configureButtonFieldIframe(options: Options): void {\n    this.configureFieldIframe(options);\n    Events.addHandler('heartland-field', 'click', (function (hps: HPS) {\n      return function (e: Event) {\n        e.preventDefault ? e.preventDefault() : (e.returnValue = false);\n        hps.Messages.post({ action: 'requestTokenize' }, 'parent');\n      };\n    } (this)));\n  }\n\n  /**\n   * Heartland.HPS.configureFieldIframe\n   *\n   * Sets up a child iframe window to prepare it for communication with the\n   * parent and for tokenization.\n   *\n   * @param {Heartland.Options} options\n   */\n  configureFieldIframe(options: Options): void {\n    const hash = document.location.hash.replace(/^#/, '');\n    const split = hash.split(':');\n    this.Messages = new Messages(this);\n    this.field = split.shift();\n    this.parent = window.parent;\n    this.frames = this.frames || {};\n    this.frames.parent = {\n      frame: window.parent,\n      name: 'parent',\n      url: decodeURIComponent(split.join(':').replace(/^:/, ''))\n    };\n\n    window.onerror = (function (hps: HPS) {\n      return function (errorMsg: string, url: string, lineNumber: number, column: number, errorObj: any) {\n        hps.Messages.post({\n          action: 'error',\n          data: {\n            column: column,\n            errorMsg: errorMsg,\n            lineNumber: lineNumber,\n            url: url\n          }\n        }, 'parent');\n        return true;\n      };\n    } (this));\n\n    this.loadHandler = (function (hps: HPS) {\n      return function () {\n        DOM.resizeFrame(hps);\n        DOM.configureField(hps);\n        const method = 'attach' + window.name.replace('card', '') + 'Events';\n        if ((<any>Card)[method]) {\n          (<any>Card)[method]('#heartland-field');\n        }\n      };\n    } (this));\n\n    this.receiveMessageHandlerAddedHandler = (function (hps: HPS) {\n      return function () {\n        hps.Messages.post({ action: 'receiveMessageHandlerAdded' }, 'parent');\n      };\n    } (this));\n\n    Events.addHandler(window, 'load', this.loadHandler);\n    Events.addHandler(document, 'receiveMessageHandlerAdded', this.receiveMessageHandlerAddedHandler);\n    Frames.monitorFieldEvents(this, 'heartland-field');\n\n    this.Messages.receive(Events.frameHandleWith(this), '*');\n  };\n\n  /**\n   * Heartland.HPS.resizeIFrame\n   *\n   * Called automatically when the child iframe window alerts the parent to\n   * resize.\n   *\n   * @param {HTMLIFrameElement} frame\n   * @param {string} height\n   */\n  resizeIFrame(frame: HTMLIFrameElement, height: string): void {\n    if (!frame) { return; }\n    frame.style.height = (parseInt(height, 10)) + 'px';\n  };\n\n  /**\n   * Heartland.HPS.setText\n   *\n   * Public API for setting an element's inner text.\n   *\n   * @param {string} elementid\n   * @param {string} elementtext\n   */\n  setText(elementid: string, elementtext: string): void {\n    this.Messages.post({ action: 'setText', id: elementid, text: elementtext }, 'child');\n  };\n\n  /**\n   * Heartland.HPS.setStyle\n   *\n   * Public API for setting an element's style.\n   *\n   * @param {string} elementid\n   * @param {string} elementstyle\n   */\n  setStyle(elementid: string, elementstyle: string): void {\n    this.Messages.post({ action: 'setStyle', id: elementid, style: elementstyle }, 'child');\n  };\n\n  /**\n   * Heartland.HPS.appendStyle\n   *\n   * Public API for appending to an element's style.\n   *\n   * @param {string} elementid\n   * @param {string} elementstyle\n   */\n  appendStyle(elementid: string, elementstyle: string): void {\n    this.Messages.post({ action: 'appendStyle', id: elementid, style: elementstyle }, 'child');\n  };\n\n  /**\n   * Heartland.HPS.setFocus\n   *\n   * Public API for appending to an element's style.\n   *\n   * @param {string} elementid\n   */\n  setFocus(elementid: string): void {\n    this.Messages.post({ action: 'setFocus' }, elementid);\n  };\n\n  /**\n   * Heartland.HPS.dispose\n   *\n   * Removes all iframes and event listeners from the DOM.\n   */\n  dispose(): void {\n    this.Messages.dispose();\n    this.Messages = null;\n    if (this.frames.cardNumber && this.frames.cardNumber.targetNode) {\n      (<any>this.frames.cardNumber.frame).remove();\n    }\n    if (this.frames.cardExpiration && this.frames.cardExpiration.frame) {\n      (<any>this.frames.cardExpiration.frame).remove();\n    }\n    if (this.frames.cardCvv && this.frames.cardCvv.frame) {\n      (<any>this.frames.cardCvv.frame).remove();\n    }\n    if (this.frames.child && this.frames.child.frame) {\n      (<any>this.frames.child.frame).remove();\n    }\n    if (this.clickHandler) {\n      Events.removeHandler(\n        this.options.buttonTarget,\n        'click',\n        this.clickHandler\n      );\n    }\n    if (this.loadHandler) {\n      Events.removeHandler(\n        window,\n        'load',\n        this.loadHandler\n      );\n    }\n    if (this.receiveMessageHandlerAddedHandler) {\n      Events.removeHandler(\n        document,\n        'receiveMessageHandlerAdded',\n        this.receiveMessageHandlerAddedHandler\n      );\n    }\n  };\n}\n","import {CardNumber} from \"./CardNumber\";\nimport {Cvv} from \"./Cvv\";\nimport {Expiration} from \"./Expiration\";\n\nexport default {\n    CardNumber: CardNumber,\n    Cvv: Cvv,\n    Expiration: Expiration\n}\n","import {Ajax} from \"./Ajax\";\nimport {Card} from \"./Card\";\nimport {DOM} from \"./DOM\";\nimport {Events} from \"./Events\";\nimport Formatter from \"./Formatter\";\nimport {Frames} from \"./Frames\";\nimport {HPS} from \"./HPS\";\nimport {Messages} from \"./Messages\";\nimport {Styles} from \"./Styles\";\nimport {Util} from \"./Util\";\nimport Validator from \"./Validator\";\n\nexport default {\n    Ajax: Ajax,\n    Card: Card,\n    DOM: DOM,\n    Events: Events,\n    Formatter: Formatter,\n    Frames: Frames,\n    HPS: HPS,\n    Messages: Messages,\n    Styles: Styles,\n    Util: Util,\n    Validator: Validator\n}\n"],"names":["DOM","hps","document","getElementById","setAttribute","field","name","frame","createElement","id","style","border","frameBorder","scrolling","formParent","fieldType","fieldName","fieldValue","input","appendChild","elementid","htmlstyle","el","encodeEntities","currstyle","getAttribute","newstyle","text","textContent","docHeight","body","offsetHeight","Messages","post","action","height","value","css","elements","getElementsByTagName","type","createTextNode","json","attributes","children","i","j","key","jsonAttributes","attributesLength","length","isArray","arrLength","jsonChildren","childrenLength","json2css","focus","replace","v","hi","charCodeAt","low","obj","Object","prototype","toString","call","set","hasOwnProperty","push","cardTypes","code","format","regex","CardNumber","number","Card","typeByNumber","matches","match","global","shift","join","Expiration","exp","final","month","del","year","pat","groups","Date","getFullYear","slice","luhnCheck","Cvv","cvv","test","m","y","split","parseInt","Ev","node","eventName","callback","addEventListener","documentElement","attachEvent","e","propertyName","createEvent","event","initEvent","dispatchEvent","removeEventListener","detachEvent","Events","target","listen","ignore","data","bubble","trigger","accumulateData","message","tokenizeIframe","setStyle","resizeFrame","appendStyle","setText","setPlaceholder","setFieldData","pkey","getFieldData","addStylesheet","setFocus","publicKey","card","numberElement","cvvElement","expElement","tokenResponse","response","parentNode","removeChild","remove","formatter","ExpirationFormatter","cardExpSplit","expMonth","expYear","undefined","tokenize","cardCvv","cardExpMonth","cardExpYear","cardNumber","error","success","cardType","isEncrypted","trackNumber","temp","substr","digit","odd","sum","digits","reverse","currentTarget","srcElement","classList","className","c","indexOf","formatted","CardNumberFormatter","setSelectionRange","cursor","selectionStart","charAt","keyCode","ctrlKey","preventDefault","returnValue","shiftKey","CardNumberValidator","validate","CvvValidator","ExpirationValidator","selector","addHandler","querySelector","restrictNumeric","restrictLength","deleteProperly","formatNumber","validateNumber","addType","formatExpiration","validateExpiration","validateCvv","Array","start","this","Styles","urls","CERT","PROD","iframeCERT","iframePROD","Util","tokenizationType","options","track","typeByTrack","source","properties","destination","property","errorMessage","collection","params","encodeURIComponent","ktb","pinBlock","throwError","env","gatewayUrl","payment_form","formId","window","fields","getFields","getCardType","Ajax","addField","form","childElementCount","element","getParams","request","payload","url","jsonp","encryptedcard","lastfour","last_four","card_type","exp_month","exp_year","token_value","script","callbackName","Math","round","random","src","xhr","timeout","method","XMLHttpRequest","withCredentials","XDomainRequest","open","setRequestHeader","cb","clearTimeout","readyState","responseText","JSON","parse","onload","onerror","send","setTimeout","abort","defaults","_method","buttonTarget","iframeTarget","object","onEvent","onTokenError","onTokenSuccess","targetType","tokenType","useDefaultStyles","intervalId","lastHash","pushIntervalStarted","current","targetNode","messageArr","targetUrl","re","mailbox","location","hash","decodeURIComponent","concat","cacheBust","stringify","href","frames","postMessage","setInterval","pushMessages","sourceOrigin","clearInterval","removeReceiver","cvvContainer","fieldset","inputsAndSelects","ids","labelsAndLegend","selectLabels","selects","Frames","iframe_url","makeFieldsAndLink","makeFrame","child","contentWindow","clickHandler","receive","fieldFrame","resizeIFrame","Defaults","placeholder","styleString","cardNumberFieldFrame","onError","fieldsLength","baseUrl","fieldOptions","events","classes","parent","applyOptions","getUrlByEnv","addFormHandler","configureIframe","HPS","loadHandler","receiveMessageHandlerAddedHandler","frameHandleWith","configureFieldIframe","errorMsg","lineNumber","column","errorObj","configureField","monitorFieldEvents","elementtext","elementstyle","dispose","cardExpiration","removeHandler","Formatter","Validator"],"mappings":"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"}